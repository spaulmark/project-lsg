{"version":3,"sources":["images/src sync nonrecursive /.png","images/src/Archbishop Geofri.png","images/src/Atziri.png","images/src/Avarius.png","images/src/Baran.png","images/src/Brutus.png","images/src/Doedre.png","images/src/Dominus.png","images/src/Eleron.png","images/src/Hillock.png","images/src/Izaro.png","images/src/Kitava.png","images/src/Kuduku.png","images/src/Lunaris.png","images/src/Malachai.png","images/src/Piety.png","images/src/Rhys.png","images/src/Shavronne.png","images/src/Solaris.png","images/src/The Elder.png","images/src/The Shaper.png","images/src/Veritania.png","utils/utilities.ts","utils/relationshipMap.ts","model/color.ts","utils/ai/classifyRelationship.ts","images/tribe.ts","utils/likeMap.ts","images/RelationshipMapper.ts","components/playerPortrait/houseguestPortraitController.ts","components/playerPortrait/houseguestPortrait.tsx","components/playerPortrait/selectedPortrait.ts","components/layout/box.tsx","components/playerPortrait/houseguestToPortrait.tsx","components/tooltip/tooltip.tsx","components/playerPortrait/portraits.tsx","components/memoryWall/tribeContainer.tsx","components/memoryWall/selectedTribe.ts","components/memoryWall/memoryWall.tsx","components/layout/text.ts","components/playerPortrait/subtitle.tsx","model/portraitDisplayMode.ts","components/viewsBar/viewBarTag.tsx","components/viewsBar/viewBar.tsx","components/memoryWallScreen/memoryWallScreen.tsx","subjects/subjects.tsx","utils/BbRandomGenerator.ts","model/gameState.ts","model/logging/episodelog.ts","components/episode/episodeFactory.ts","components/episode/bigBrotherEpisode.tsx","components/episode/bigBrotherFinale.tsx","components/layout/centered.tsx","components/mainPage/fullscreenButton.tsx","components/episode/scenes/votingTable.tsx","components/episode/gameOver.tsx","model/season.ts","components/sidebar/sidebarController.ts","components/sidebar/sidebar.tsx","utils/base64.ts","images/decoder.ts","components/topbar/topBarController.ts","images/initialProfiles.ts","components/topbar/topBar.tsx","components/mainPage/mainContentArea.tsx","components/mainPage/mainPage.tsx","components/mainPage/mainPageController.ts","theme/theme.ts","theme/globalTheme.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["map","./Archbishop Geofri.png","./Atziri.png","./Avarius.png","./Baran.png","./Brutus.png","./Doedre.png","./Dominus.png","./Eleron.png","./Hillock.png","./Izaro.png","./Kitava.png","./Kuduku.png","./Lunaris.png","./Malachai.png","./Piety.png","./Rhys.png","./Shavronne.png","./Solaris.png","./The Elder.png","./The Shaper.png","./Veritania.png","webpackContext","req","id","webpackContextResolve","__webpack_require__","e","Error","code","keys","Object","resolve","module","exports","p","roundTwoDigits","number","Math","round","newDiscreteRelationshipMap","size","exclude","result","i","undefined","componentToHex","c","hex","toString","length","RelationshipType","ThreatLevel","Rgb","r","g","b","classCallCheck","this","createClass","key","value","concat","interpolateColor","min","max","percent","toHex","RelationshipTypeToSymbol","NEUTRAL","FRIEND","ENEMY","PAWN","QUEEN","HUNTER","TARGET","DUPE","DECEIVER","ThreatLevelToSymbol","THREAT","WEAK","RelationshipTypeToPopularity","ClassifyDiscreteRelationship","true","Friend","false","Dupe","Pawn","Deceiver","Enemy","Hunter","Queen","Target","Neutral","f","a","classifyRelationship","heroPopularity","villainPopularity","heroRelationship","villainRelationship","benefitsHero","benefitsVillain","tribeId","t","name","color","nullTribe","sizeOf","l","calculatePopularity","hg","n","likedBy","dislikedBy","calculatePowerRanking","thinksImThreat","thinksImWeak","threats","weaks","twoN","calcPowerRank","RelationshipMapper","houseguests","_this","cache","tribeIDs","Set","nonEvictedIDs","forEach","toUpperCase","isEvicted","push","get","_this2","dropYourBuffs","evict","unevict","hero","h","v","tribe","popularity","powerRanking","_this3","myTribeId","toDelete","indexOf","neutral","utr","splice","groups","newR","likeKey","dislikeKey","hToV","getRelationship","villain","disabled","addToLikeMap","deleteFromLikeMap","updatePopularities","nonEvictedHouseguests","skeleton","members","_this4","filter","includes","has","add","setRelationship","like","j","friends","dislike","selectedColor","HouseguestPortraitController","view","subs","refreshTribeFilter","selectedTribe","selectedPlayer","getSelectedPlayer","updateLikeCounts","props","selectedPlayer$","next","refreshData","data","state","setState","getPopularity","relationships","getPowerRanking","powerRankings","goToDefaultState","displayMode","backgroundColor","subscribe","selectedTribe$","displayMode$","sub","unsubscribe","newState","hasSameTribe","_","objectSpread","defaultState","isNullOrUndefined","relationshipType","x","Subtitle","styled","small","_templateObject","MemoryWallPortrait","div","_templateObject2","_ref","theme","portraitBorder","Evicted","_templateObject3","Jury","_templateObject4","Normal","img","_templateObject5","Grayscale","_templateObject6","Sepia","_templateObject7","HouseguestPortrait","_React$Component","possibleConstructorReturn","getPrototypeOf","call","controller","assertThisInitialized","inherits","player","superiors","subtitle","Img","imageClass","getImageClass","generateSubtitle","detailed","Portrait","react_default","createElement","onClick","style","src","imageURL","height","React","Component","ShadowBox","box_templateObject","_ref2","overlay","StyledBox","box_templateObject2","_ref3","bodyArea","DividerBox","className","children","Box","houseguestToPortrait","houseguest","houseguestPortrait_HouseguestPortrait","assign","Text","tooltip_templateObject","Tooltip","visible","Popover_default","position","isOpen","content","text","onMouseEnter","onMouseLeave","Portraits","rows","memoryWallPortrait","tooltip","tooltip_Tooltip","centered","TribeContainer","getHoverable","normal","hilite","bg","charAt","substring","parseInt","col","pow","textColor","selected","tribeContainer_templateObject","Hoverable","tribeName","textAlign","select","bind","hgs","MemoryWall","houseguestsByTribe","groupBy","tribes","tribeContainer_TribeContainer","margin","maxWidth","HasText","text_templateObject","input","text_templateObject2","emptySubtitle","addCompsLine","compWins","lineHeight","hohWins","povWins","nominations","friendOrEnemyTitle","titles","threatLevelCountTitle","count","enemies","friendCountText","Threat","enemyCountText","Weak","friendEnemyCountTitle","Relationship","popularityMinColor","popularityMaxColor","popularityMode","minColor","maxColor","extremePopularity","xSquared","extremeValues","arguments","_addCountTitle","discreteTitle","countTitle","txt","addCountTitle","powerMinColor","powerMaxColor","powerMode","statePopularity","deltaPop","deltaPopularity","arrow","addPopularityLine","ViewBarTag","mode","background","toRgba","cursor","ViewsBox","viewBar_templateObject","ViewsBar","viewBarTag_ViewBarTag","MemoryWallScreen","cast","players$","mainContentStream$","BehaviorSubject","memoryWallScreen_MemoryWallScreen","episodes$","switchEpisode$","Subject","switchSceneRelative","cast$","isFullscreen$","theme$","BbRandomGenerator","seed","rng","prand","xorshift128plus","_this$rng$next","_this$rng$next2","slicedToArray","_prand$uniformIntDist","uniformIntDistribution","_prand$uniformIntDist2","_this$rng$next3","_this$rng$next4","getById","gameState","houseguestCache","MutableGameState","init","remainingPlayers","phase","previousHOH","log","copy","cloneDeep","EpisodeLog","nominationsPreVeto","vetoWinner","winner","runnerUp","nominationsPostVeto","evicted","votes","votesInMajority","outOf","soleVoter","EpisodeFactory","episodeType","BigBrotherVanilla","canPlayWith","eliminates","arrowsEnabled","hasViewsbar","BigBrotherFinale","centered_templateObject","centered_templateObject2","fullscreenButton_templateObject","EndgameTableCell","td","votingTable_templateObject","tableCellBorder","table","votingTable_templateObject2","votingTable_templateObject3","grayCell","votingTable_templateObject4","_ref4","lightGrayCell","votingTable_templateObject5","_ref5","evictedCell","votingTable_templateObject6","_ref6","winnerCell","votingTable_templateObject7","_ref7","runnerUpCell","_templateObject8","_ref8","nomineeCell","_templateObject9","_ref9","hohCell","tr","_templateObject10","GameOver","Season","factory","type","nextEpisode","players","SidebarController","subscriptions","season","scenes","selectedEpisode","delta","selectedScene","renderedScenes","targetScene","episode","lastEpisode","episodes","switchToScene","currentGameState","newPlayerCount","nextEpisodeType","whichEpisodeType","renderEpisode","onNewEpisode","_switchToScene","asyncToGenerator","regenerator_default","mark","_callee","wrap","_context","prev","scene","render","index","stop","_x","apply","event","keyCode","_handleKeyDown","Sidebar","document","addEventListener","handleKeyDown","destroy","minWidth","display","getEpisodes","title","episodeKey","breakKey","getHighlight","getSelectedEpisode","Base64","digits","split","digitsMap","Map","set","fromInt","int32","toInt","digitsStr","m","decodeToRelationshipMapper","c1","reset","trim","_c$split","_c$split2","evictees","codeToHouseguest","decodeEvictees","hash","slice","chex","test","tribemates","decodeTribes","decodedR","decodedP","decode","fromTernary","decodeRelationships","alert","s","padStart","ternaryToRelationship","entries","0","1","2","lookedUp","TopbarController","onSubmit","inputCode","newMap","rMapper","initialProfiles","context","profiles","evictedHouseguests","jurors","item","replace","toLowerCase","setupProfiles","importAll","require","Topbar","handleChange","target","marginTop","onChange","MainContentAreaWrapper","mainContentArea_templateObject","MainContentArea","contentStream","prevProps","prevState","window","scrollTo","MainPage","fullscreen","inject","hideOnFullscreen","wrapperStyle","overflow","sidebar_Sidebar","topBar_Topbar","overflowX","mainContentArea_MainContentArea","MainPageController","page","darkTheme","toggleBorder","gradient","link","GlobalStyles","createGlobalStyle","globalTheme_templateObject","App","styled_components_browser_esm","Fragment","mainPage_MainPage","Boolean","location","hostname","match","ReactDOM","src_App","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"6JAAA,IAAAA,EAAA,CACAC,0BAAA,GACAC,eAAA,GACAC,gBAAA,GACAC,cAAA,GACAC,eAAA,GACAC,eAAA,GACAC,gBAAA,GACAC,eAAA,GACAC,gBAAA,GACAC,cAAA,GACAC,eAAA,GACAC,eAAA,GACAC,gBAAA,GACAC,iBAAA,GACAC,cAAA,GACAC,aAAA,GACAC,kBAAA,GACAC,gBAAA,GACAC,kBAAA,GACAC,mBAAA,GACAC,kBAAA,IAIA,SAAAC,EAAAC,GACA,IAAAC,EAAAC,EAAAF,GACA,OAAAG,EAAAF,GAEA,SAAAC,EAAAF,GACA,IAAAC,EAAAxB,EAAAuB,GACA,KAAAC,EAAA,IACA,IAAAG,EAAA,IAAAC,MAAA,uBAAAL,EAAA,KAEA,MADAI,EAAAE,KAAA,mBACAF,EAEA,OAAAH,EAEAF,EAAAQ,KAAA,WACA,OAAAC,OAAAD,KAAA9B,IAEAsB,EAAAU,QAAAP,EACAQ,EAAAC,QAAAZ,EACAA,EAAAE,GAAA,oBC3CAS,EAAAC,QAAiBR,EAAAS,EAAuB,+DCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,oDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,qDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,mDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,oDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,oDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,qDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,oDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,qDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,mDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,oDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,oDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,qDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,sDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,mDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,kDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,uDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,qDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,uDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,wDCAxCF,EAAAC,QAAiBR,EAAAS,EAAuB,oNCajC,SAASC,EAAeC,GAC3B,OAAKA,EAGEC,KAAKC,MAAe,IAATF,GAFP,ECIR,SAASG,EACdC,EACAC,GAGA,IADA,IAAMC,EAAkC,GAC/BC,EAAI,EAAGA,EAAIH,EAAMG,IACpBA,IAAMF,IAASC,EAAOC,QAAKC,GAEjC,OAAOF,wDC3BT,SAASG,EAAeC,GACtB,IAAIC,EAAMV,KAAKC,MAAMQ,GAAGE,SAAS,IACjC,OAAqB,GAAdD,EAAIE,OAAc,IAAMF,EAAMA,EAGhC,ICLKG,EAYAC,EDPCC,EAAb,WAeE,SAAAA,EAAYC,EAAWC,EAAWC,GAAYzB,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAL,GAAAK,KAdvCJ,OAcsC,EAAAI,KAbtCH,OAasC,EAAAG,KAZtCF,OAYsC,EAC3CE,KAAKJ,EAAIA,EACTI,KAAKH,EAAIA,EACTG,KAAKF,EAAIA,EAlBb,OAAAzB,OAAA4B,EAAA,EAAA5B,CAAAsB,EAAA,EAAAO,IAAA,QAAAC,MAAA,WAKI,MACE,IACAf,EAAeY,KAAKJ,GACpBR,EAAeY,KAAKH,GACpBT,EAAeY,KAAKF,KAT1B,CAAAI,IAAA,SAAAC,MAAA,WAaI,cAAAC,OAAeJ,KAAKJ,EAApB,MAAAQ,OAA0BJ,KAAKH,EAA/B,MAAAO,OAAqCJ,KAAKF,EAA1C,YAbJH,EAAA,GAgDO,SAASU,EAAiBC,EAAUC,EAAUC,GACnD,OAAO,IAAIb,EACTW,EAAIV,EAAIY,GAAWD,EAAIX,EAAIU,EAAIV,GAC/BU,EAAIT,EAAIW,GAAWD,EAAIV,EAAIS,EAAIT,GAC/BS,EAAIR,EAAIU,GAAWD,EAAIT,EAAIQ,EAAIR,IAC/BW,kBC1DQhB,oLAYAC,mEAML,IAAMgB,EAA2B,CACtCC,QAAS,IACTC,OAAQ,SACRC,MAAO,eACPC,KAAM,iBACNC,MAAO,gBACPC,OAAQ,uBACRC,OAAQ,sBACRC,KAAM,qCACNC,SAAU,sCAGCC,EAAsB,CACjCC,OAAQ,eACRC,KAAM,eACNX,QAAS,KAGEY,EAA+B,CAC1CZ,QAAS,EACTC,OAAQ,EACRC,OAAQ,EACRC,KAAM,IACNC,MAAO,IACPC,QAAS,IACTC,QAAS,IACTC,KAAM,IACNC,UAAW,KAGAK,EAET,CACFC,KAAM,CACJA,KAAMhC,EAAiBiC,OACvBC,MAAOlC,EAAiBmC,KACxBzC,UAAWM,EAAiBoC,MAE9BF,MAAO,CACLF,KAAMhC,EAAiBqC,SACvBH,MAAOlC,EAAiBsC,MACxB5C,UAAWM,EAAiBuC,QAE9B7C,UAAW,CACTsC,KAAMhC,EAAiBwC,MACvBN,MAAOlC,EAAiByC,OACxB/C,UAAWM,EAAiB0C,UAIhC,SAASC,EAAEC,GACT,OAAU,IAANA,EAAmB,QACR,IAANA,EAAoB,QACjB,YAGP,SAASC,EACdC,EACAC,EACAC,EACAC,GAEA,GAC8B,kBAArBD,GACwB,kBAAxBC,EAEP,OAAOlB,EAA6BY,EAAEK,IACpCL,EAAEM,IAIN,IAAMC,EAAeF,EAAoBF,EACnCK,EAAkBH,EAAoBD,EAC5C,OAAIG,GAAgBC,EACXnD,EAAiBiC,OACfiB,IAAiBC,EACnBnD,EAAiBoC,MACdc,GAAgBC,EACnBnD,EAAiBwC,MAEnBxC,EAAiBsC,MC5FnB,SAASc,EAAQC,GACtB,YAAU3D,IAAN2D,EAAwB,GAC5B,GAAA1C,OAAU0C,EAAEC,MAAZ3C,OAAmB0C,EAAEE,OAGhB,IAAMC,EAAmB,CAAEF,KAAM,GAAIC,MAAO,GAAIjE,KAAM,GCJtD,SAASmE,EAAOC,GACrB,OAAO9E,OAAOD,KAAK+E,GAAG3D,OCQjB,SAAS4D,EACdC,EACAC,GAEA,KAAIA,EAAI,GAAR,CACA,IAAMC,EAAUL,EAAOG,EAAGE,SACpBC,EAAaN,EAAOG,EAAGG,YACzBvE,EAA6B,EAGjC,OAFAA,GAAUsE,EAAUC,GAAcF,EACtB,IAAZC,GAAgC,IAAfC,IAAqBvE,OAASE,GACxCF,GAGF,SAASwE,EACdJ,EACAC,GAEA,KAAIA,EAAI,GAAR,CACA,IAAMI,EAAiBR,EAAOG,EAAGK,gBAC3BC,EAAeT,EAAOG,EAAGM,cAC3B1E,EAA6B,EAGjC,OAFAA,EA3BF,SAAuB2E,EAAiBC,EAAeP,GACrD,GAAU,IAANA,EAAS,OAAO,EACpB,IAAMQ,EAAO,EAAIR,EACjB,MAAO,GAAMM,EAAUE,EAAOD,EAAQC,EAwB7BC,CAAcL,EAAgBC,EAAcL,GAClC,IAAnBI,GAAyC,IAAjBC,IAAuB1E,OAASE,GACjDF,GAqBF,IAAM+E,EAAb,WAUE,SAAAA,EAAmBC,GAAuC,IAAAC,EAAAlE,KAExD,GAFwD3B,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAgE,GAAAhE,KATnDiE,YAAwC,GASWjE,KARlDmE,MAEJ,GAMsDnE,KALlDoE,SAAwB,IAAIC,IAKsBrE,KAD1DsE,cAA0B,GAExBtE,KAAKiE,YAAcA,EACfA,EAAYzE,OAAS,KACvB,MAAM,IAAItB,MAAM,sCAElB+F,EAAYM,QAAQ,SAAClB,GACnBa,EAAKC,MAAMd,EAAGN,KAAKyB,eAAiBnB,GACnCA,EAAGoB,WAAaP,EAAKI,cAAcI,KAAKrB,EAAGvF,MAjBlD,OAAAO,OAAA4B,EAAA,EAAA5B,CAAA2F,EAAA,EAAA9D,IAAA,wBAAAyE,IAAA,WAOI,OAAO3E,KAAKsE,cAAc9E,WAP9BnB,OAAA4B,EAAA,EAAA5B,CAAA2F,EAAA,EAAA9D,IAAA,UAAAC,MAAA,SAqBiBrC,GACb,QAA6BqB,IAAzBa,KAAKiE,YAAYnG,GAAmB,MAAMI,MAAM,cACpD,OAAO8B,KAAKiE,YAAYnG,KAvB5B,CAAAoC,IAAA,QAAAC,MAAA,WA0BiB,IAAAyE,EAAA5E,KACbA,KAAK6E,gBACL7E,KAAKiE,YAAYM,QAAQ,SAAClB,GACxBuB,EAAKE,MAAMzB,EAAGN,MACd6B,EAAKG,QAAQ1B,EAAGN,UA9BtB,CAAA7C,IAAA,MAAAC,MAAA,SAkCc6E,GACV,OAAOhF,KAAKmE,MAAMa,EAAKR,iBAnC3B,CAAAtE,IAAA,kBAAAC,MAAA,SAqC0B8E,EAAWC,EAAW5I,GAC5C,OAAO0D,KAAK2E,IAAIM,GAAG3I,GAAK0D,KAAK2E,IAAIO,GAAGpH,MAtCxC,CAAAoC,IAAA,gBAAAC,MAAA,WA0CIH,KAAKoE,SAAW,IAAIC,IACpBrE,KAAKiE,YAAYM,QAAQ,SAAClB,GACxBA,EAAG8B,WAAQhG,MA5CjB,CAAAe,IAAA,qBAAAC,MAAA,SAgD6BkD,EAAuBC,GAChDD,EAAG+B,WAAahC,EAAoBC,EAAIC,GACxCD,EAAGgC,aAAe5B,EAAsBJ,EAAIC,KAlDhD,CAAApD,IAAA,QAAAC,MAAA,SAqDe8E,GAAW,IAAAK,EAAAtF,KAChBgF,EAAOhF,KAAK2E,IAAIM,GAChBM,EAAY1C,EAAQmC,EAAKG,OACzBK,EAAWxF,KAAKsE,cAAcmB,QAAQT,EAAKlH,IAC7CkH,EAAKP,YACTO,EAAKP,WAAY,EACjBzE,KAAKsE,cAAcC,QAAQ,SAACzG,GAC1BwH,EAAKI,QAAQT,EAAGK,EAAKrB,YAAYnG,GAAIiF,MACrCuC,EAAKI,QAAQJ,EAAKrB,YAAYnG,GAAIiF,KAAMkC,GACxCK,EAAKK,IAAIV,EAAGK,EAAKrB,YAAYnG,GAAIiF,MACjCuC,EAAKK,IAAIL,EAAKrB,YAAYnG,GAAIiF,KAAMkC,GACpC,IAAME,EAAQG,EAAKrB,YAAYnG,GAAIqH,MACnCA,GAAStC,EAAQsC,KAAWI,GAAaJ,EAAMpG,SAEjDiB,KAAKsE,cAAcsB,OAAOJ,EAAU,MAnExC,CAAAtF,IAAA,UAAAC,MAAA,SAsEiB8E,GACb,IAAMD,EAAOhF,KAAK2E,IAAIM,GACjBD,EAAKP,YACVO,EAAKP,WAAY,EACjBzE,KAAKsE,cAAcI,KAAKM,EAAKlH,OA1EjC,CAAAoC,IAAA,eAAAC,MAAA,SA6EuBgD,EAAY8B,GAC/B9B,EAAE8B,EAAEnH,IAAM,CAAE+E,QAASA,EAAQoC,EAAEE,OAAQU,OAAQ,IAAIxB,OA9EvD,CAAAnE,IAAA,oBAAAC,MAAA,SAiF4BgD,EAAY8B,UAC7B9B,EAAE8B,EAAEnH,MAlFf,CAAAoC,IAAA,kBAAAC,MAAA,SAsFI8E,EACAC,EACAY,EACAC,EACAC,EACA1J,GAEA,IAAM2J,EAAOjG,KAAKkG,gBAAgBjB,EAAGC,EAAG5I,GAClC0I,EAAOhF,KAAK2E,IAAIM,GAChBkB,EAAUnG,KAAK2E,IAAIO,GAEvBe,IAASH,IACPd,EAAKP,WACLO,EAAKoB,UACLD,EAAQC,UACRD,EAAQ1B,iBACCtF,IAAT2G,SAIS3G,IAAT8G,EACFjG,KAAKqG,aAAaF,EAAQL,EAAOC,EAAUC,GAAahB,QACtC7F,IAAT2G,EACT9F,KAAKsG,kBAAkBH,EAAQF,EAAOF,EAAUC,GAAahB,IAE7DhF,KAAKqG,aAAaF,EAAQL,EAAOC,EAAUC,GAAahB,GACxDhF,KAAKsG,kBAAkBH,EAAQL,EAAOE,EAAaD,GAAUf,IAG/DA,EAAK1I,GAAK6J,EAAQrI,IAAMgI,EACxB9F,KAAKuG,mBAAmBJ,EAASnG,KAAKwG,sBAAwB,MApHlE,CAAAtG,IAAA,QAAAC,MAAA,SAsHesG,EAA2CC,GAAmB,IAAAC,EAAA3G,KACnEmF,EAAQ,CACZpG,KAAM2H,EAAQE,OAAO,SAACvD,GAAD,OAASsD,EAAKhC,IAAItB,GAAIoB,YAAWjF,OACtDuD,KAAM0D,EAAS1D,KACfC,MAAOyD,EAASzD,OAElB,GAAImC,EAAMpC,KAAK8D,SAAS,MAAQ1B,EAAMpC,KAAK8D,SAAS,KAClD,MAAM,IAAI3I,MAAM,qCAElB,GAAI8B,KAAKoE,SAAS0C,IAAIjE,EAAQsC,IAC5B,MAAM,IAAIjH,MAAJ,SAAAkC,OAAmByC,EAAQsC,GAA3B,oBAERnF,KAAKoE,SAAS2C,IAAIlE,EAAQsC,IAC1BuB,EAAQnC,QAAQ,SAAClB,GACfsD,EAAKhC,IAAItB,GAAI8B,MAAQA,MApI3B,CAAAjF,IAAA,OAAAC,MAAA,SAuIc6E,EAAcmB,GACxBnG,KAAKgH,gBACHhC,EACAmB,GACA,EACA,UACA,aACA,mBA9IN,CAAAjG,IAAA,UAAAC,MAAA,SAiJiB6E,EAAcmB,GAC3BnG,KAAKgH,gBACHhC,EACAmB,GACA,EACA,UACA,aACA,mBAxJN,CAAAjG,IAAA,UAAAC,MAAA,SA2JiB6E,EAAcmB,GAC3BnG,KAAKgH,gBACHhC,EACAmB,OACAhH,EACA,UACA,aACA,mBAlKN,CAAAe,IAAA,UAAAC,MAAA,SAqKiB6E,EAAcmB,GAC3BnG,KAAKiH,KAAKjC,EAAMmB,GAChBnG,KAAKiH,KAAKd,EAASnB,KAvKvB,CAAA9E,IAAA,SAAAC,MAAA,SAyKgB8E,EAAWC,GACvBlF,KAAKgH,gBACH/B,EACAC,GACA,EACA,iBACA,eACA,mBAhLN,CAAAhF,IAAA,OAAAC,MAAA,SAmLc8E,EAAWC,GACrBlF,KAAKgH,gBACH/B,EACAC,GACA,EACA,iBACA,eACA,mBA1LN,CAAAhF,IAAA,MAAAC,MAAA,SA6La8E,EAAWC,GACpBlF,KAAKgH,gBACH/B,EACAC,OACA/F,EACA,iBACA,eACA,mBApMN,CAAAe,IAAA,WAAAC,MAAA,SAuMkBuG,GACd,IAAK,IAAIxH,EAAI,EAAGA,EAAIwH,EAAQlH,OAAQN,IAClC,IAAK,IAAIgI,EAAIhI,EAAI,EAAGgI,EAAIR,EAAQlH,OAAQ0H,IACtClH,KAAKmH,QAAQT,EAAQxH,GAAIwH,EAAQQ,MA1MzC,CAAAhH,IAAA,UAAAC,MAAA,SA8MiB6E,EAAcmB,GAC3BnG,KAAKoH,QAAQpC,EAAMmB,GACnBnG,KAAKoH,QAAQjB,EAASnB,OAhN1BhB,EAAA,GClCMqD,EAAgB,IAAI1H,EAAI,GAAI,IAAK,KAE1B2H,EAAb,WAGE,SAAAA,EAAYC,GAA0B,IAAArD,EAAAlE,KAAA3B,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAsH,GAAAtH,KAF9BwH,KAAuB,GAEOxH,KAD9BuH,UAC8B,EAAAvH,KAqD9ByH,mBAAqB,SAACC,GAE5B,GAAKA,EAAc3E,KAAnB,CAKA,IAAM4E,EAAiBC,KACvB1D,EAAK2D,iBAAiBH,GAEpB7E,EAAQ6E,KAAmB7E,EAAQqB,EAAKqD,KAAKO,MAAM3C,QAChC,OAAnBwC,GACAA,EAAe7J,KAAOoG,EAAKqD,KAAKO,MAAMhK,IAEtCiK,GAAgBC,KAAK,WAXrB9D,EAAK+D,YAAYL,OAxDiB5H,KAoG9BiI,YAAc,SAACC,GACjBhE,EAAKqD,KAAKY,MAAM/B,WACf8B,EAGCA,EAAKpK,KAAOoG,EAAKqD,KAAKO,MAAMhK,GAC9BoG,EAAKqD,KAAKa,SAAS,CACjBhD,WAAYiD,EACVnE,EAAKqD,KAAKO,MAAMQ,cAAeJ,EAAKpK,IACpCoK,EAAKI,cAAcpE,EAAKqD,KAAKO,MAAMhK,KAErCuH,aAAckD,EACZrE,EAAKqD,KAAKO,MAAMU,cAAeN,EAAKpK,IACpCoK,EAAKM,cAActE,EAAKqD,KAAKO,MAAMhK,OAKvCoG,EAAKqD,KAAKa,SAAS,CACjBhD,WAAY,EACZC,aAAc,IAjBlBnB,EAAKuE,qBAtGPzI,KAAKuH,KAAOA,EAJhB,OAAAlJ,OAAA4B,EAAA,EAAA5B,CAAAiJ,EAAA,EAAApH,IAAA,kBAAAC,MAAA,SAmBI2H,EACAK,GAEA,IAAMR,EAAiBC,KACvB,IAAIO,EAAM/B,SACV,OAAuB,OAAnBuB,GAA2BA,EAAe7J,KAAOgK,EAAMhK,GAClDuJ,EAAc5G,QAEhBqH,EAAMrD,WAAa0D,EAAM/B,cAC5BjH,EACAa,KAAKuH,KAAKY,MAAMO,YAAYC,gBAAgB3I,KAAKuH,KAAKY,SA7B9D,CAAAjI,IAAA,YAAAC,MAAA,WAgCqB,IAAAyE,EAAA5E,KACXwH,EAAuB,GAC7BA,EAAK9C,KACHqD,GAAgBa,UAAU,CACxBZ,KAAMhI,KAAKiI,eAGfT,EAAK9C,KACHmE,GAAeD,UAAU,CACvBZ,KAAMhI,KAAKyH,sBAGfD,EAAK9C,KACHoE,GAAaF,UAAU,CACrBZ,KAAM,SAACU,GAAD,OAAiB9D,EAAK2C,KAAKa,SAAS,CAAEM,oBAGhD1I,KAAKwH,KAAOA,IAjDhB,CAAAtH,IAAA,cAAAC,MAAA,WAqDIH,KAAKwH,KAAKjD,QAAQ,SAACwE,GAAD,OAASA,EAAIC,kBArDnC,CAAA9I,IAAA,mBAAAC,MAAA,SA4E2BuH,GACvB,IAAMI,EAAQ9H,KAAKuH,KAAKO,MAClBmB,EAAgB,CACpB7C,SAAUvD,EAAQ6E,KAAmB7E,EAAQiF,EAAM3C,QAE/C/C,EAAI8G,EAAarG,EAAQiF,EAAM3C,QAKrC,GAJA8D,EAAS1F,QAAU4F,IAAEvC,OAAOkB,EAAMvE,QAASnB,GAC3C6G,EAASzF,WAAa2F,IAAEvC,OAAOkB,EAAMtE,WAAYpB,GACjD6G,EAASvF,eAAiByF,IAAEvC,OAAOkB,EAAMpE,eAAgBtB,GACzD6G,EAAStF,aAAewF,IAAEvC,OAAOkB,EAAMnE,aAAcvB,IAChDwF,KAAqB,CACxB,IAAMtE,EAAIwE,EAAM3C,MAAQ2C,EAAM3C,MAAMpG,KAAO,EAC3CkK,EAAS7D,WAAahC,EAAoB/E,OAAA+K,EAAA,EAAA/K,CAAA,GAAK4K,GAAY3F,GAC3D2F,EAAS5D,aAAe5B,EAAsBpF,OAAA+K,EAAA,EAAA/K,CAAA,GAAK4K,GAAY3F,GAEjEtD,KAAKuH,KAAKa,SAASa,KA3FvB,CAAA/I,IAAA,mBAAAC,MAAA,WA+FQH,KAAKuH,KAAKY,MAAM/B,WAChBvD,EAAQgG,GAAe1I,OACzBH,KAAK6H,iBAAiBgB,GAAe1I,OAErCH,KAAKuH,KAAKa,SAASpI,KAAKqJ,iBAnG9B,CAAAnJ,IAAA,eAAAyE,IAAA,WAOI,MAAO,CACLS,WAAYpF,KAAKuH,KAAKO,MAAM1C,WAC5BsD,YAAaI,GAAa3I,MAC1BkF,aAAcrF,KAAKuH,KAAKO,MAAMzC,aAC9Be,WAAYpG,KAAKuH,KAAKO,MAAM1B,SAC5B7C,QAASvD,KAAKuH,KAAKO,MAAMvE,QACzBC,WAAYxD,KAAKuH,KAAKO,MAAMtE,WAC5BE,eAAgB1D,KAAKuH,KAAKO,MAAMpE,eAChCC,aAAc3D,KAAKuH,KAAKO,MAAMnE,kBAfpC2D,EAAA,GAmIA,SAASiB,EAAgBvD,EAAamB,GACpC,MAAoB,kBAATnB,EACFA,EACqB,kBAAZmB,EACTA,GAEI,IAATnB,EAAsB,GACb,IAATA,EAAuB,OAA3B,EAIF,SAASqD,EAAcrD,EAAamB,GAClC,IAAImD,4BAAkBtE,KAASsE,4BAAkBnD,GAAjD,CAEA,GAAoB,kBAATnB,EACT,OAAOA,EACF,GAAuB,kBAAZmB,EAChB,OAAOA,EAGT,IAAMoD,EAAmBjH,EAAqB,EAAG,EAAG0C,EAAMmB,GAC1D,OAAO5E,EAA6BgI,IAQtC,IAAML,EAAe,SAAC/D,GACpB,OAAO,SAACqE,GACN,OAAOrE,IAAUqE,EAAE3G,4uCCjLvB,IAAM4G,GAAWC,IAAOC,MAAVC,MAKRC,GAAqBH,IAAOI,IAAVC,KAGlB,SAAAC,GAAA,OAAAA,EAAGC,MAAyCC,iBAa5CC,GAAUT,YAAOG,GAAPH,CAAHU,MAMPC,GAAOX,YAAOG,GAAPH,CAAHY,KAOJC,GAASb,IAAOc,IAAVC,KAQNC,GAAYhB,YAAOa,GAAPb,CAAHiB,KAITC,GAAQlB,YAAOa,GAAPb,CAAHmB,KAmCEC,GAAb,SAAAC,GAME,SAAAD,EAAmBhD,GAAsB,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAA8K,IACvC5G,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAAyM,GAAAI,KAAAlL,KAAM8H,KAHAqD,gBAEiC,EAEvCjH,EAAKiH,WAAa,IAAI7D,EAAJjJ,OAAA+M,EAAA,EAAA/M,QAAA+M,EAAA,EAAA/M,CAAA6F,KAClBA,EAAKiE,MAAQjE,EAAKiH,WAAW9B,aAHUnF,EAN3C,OAAA7F,OAAAgN,EAAA,EAAAhN,CAAAyM,EAAAC,GAAA1M,OAAA4B,EAAA,EAAA5B,CAAAyM,EAAA,EAAA5K,IAAA,oBAAAC,MAAA,WAaQmJ,4BAAkBtJ,KAAK8H,MAAMhK,KAGjCkC,KAAKmL,WAAWvC,cAhBpB,CAAA1I,IAAA,uBAAAC,MAAA,WAoBIH,KAAKmL,WAAWnC,gBApBpB,CAAA9I,IAAA,UAAAC,MAAA,WAwBI,IACEmJ,4BAAkBtJ,KAAK8H,MAAMhK,KAC5BkC,KAAK8H,MAAMQ,gBACZtI,KAAKmI,MAAM/B,WACXpG,KAAK8H,MAAMrD,UAJb,CAQA,IClHyB6G,EDkHnBpD,EAAO,CACXpK,GAAIkC,KAAK8H,MAAMhK,GACfwK,cAAetI,KAAK8H,MAAMQ,cAC1B7D,YAAazE,KAAK8H,MAAMrD,UACxBW,WAAYpF,KAAK8H,MAAM1C,YAAc,EACrCmG,UAAWvL,KAAK8H,MAAMyD,UACtB/C,cAAexI,KAAK8H,MAAMU,iBCxHH8C,ED0HZpD,ICvHZN,MAAuBA,KAAqB9J,KAAOwN,EAAOxN,GAE3DiK,GAAgBC,KAAK,MAErBD,GAAgBC,KAAKsD,MD2EzB,CAAApL,IAAA,SAAAC,MAAA,WA2CkB,IAIVqL,EAJU5G,EAAA5E,KACR8H,EAAQ9H,KAAK8H,MACbK,EAAQnI,KAAKmI,MACbsD,EA+BV,SAAuB3D,EAAsBK,GAC3C,IAAIuD,EAAa5D,EAAMrD,UAAYiG,GAAYH,GAE/C,OADAmB,EAAavD,EAAM/B,SAAWwE,GAAQc,EAjCxBC,CAAc7D,EAAOK,GAEjCqD,EAAWxL,KAAKmI,MAAMO,YAAYkD,iBAChC9D,EACAK,IACEL,EAAM+D,UAGV,IAAIC,EAAWjC,GAMf,OALI1B,EAAM/B,SACR0F,EAAWzB,GACFvC,EAAMrD,YACfqH,EAAW3B,IAGX4B,EAAA1J,EAAA2J,cAACF,EAAD,CACEG,QAAS,kBAAMrH,EAAKqH,WACpBC,MAAO,CACLvD,gBAAiB3I,KAAKmL,WAAWxC,gBAAgBb,EAAO9H,KAAKmI,SAG/D4D,EAAA1J,EAAA2J,cAACP,EAAD,CAAKU,IAAKrE,EAAMsE,SAAUF,MAAO,CAAEG,OAAQ,OAC3CN,EAAA1J,EAAA2J,cAAA,WACClE,EAAM/E,KACPgJ,EAAA1J,EAAA2J,cAAA,WACAD,EAAA1J,EAAA2J,cAACvC,GAAD,KAAW+B,QAvEnBV,EAAA,CAAwCwB,IAAMC,kaE1F9C,IAAMC,GAAY9C,IAAOI,IAAV2C,KACC,SAAAzC,GAAA,MACG,UADHA,EAAGC,MACTlH,KACF,mEACA,IAOQ,SAAA2J,GAAA,OAAAA,EAAGzC,MAAyC0C,UAGtDC,GAAYlD,IAAOI,IAAV+C,KAIC,SAAAC,GAAA,OAAAA,EAAG7C,MAAyC8C,WAGrD,SAASC,GAAWlF,GACzB,OACEiE,EAAA1J,EAAA2J,cAACQ,GAAD,CAAWS,UAAWnF,EAAMmF,WAAa,GAAIf,MAAOpE,EAAMoE,OAAS,IAChEpE,EAAMoF,UAKN,SAASC,GAAIrF,GAClB,OACEiE,EAAA1J,EAAA2J,cAACY,GAAD,CAAWV,MAAOpE,EAAMoE,MAAOe,UAAS,OAAA7M,OAAS0H,EAAMmF,WAAa,KACjEnF,EAAMoF,UCjCN,SAASE,GAAqBC,EAA+BnN,GAChE,OAAO6L,EAAA1J,EAAA2J,cAACsB,GAADjP,OAAAkP,OAAA,GAAwBF,EAAxB,CAAoCnN,IAAKA,EAAK2L,UAAU,qPCAnE,IAAM2B,GAAO9D,IAAOjL,EAAVgP,MAkBGC,GAAb,SAAA3C,GACI,SAAA2C,EAAY5F,GAAqB,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAA0N,IAC7BxJ,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAAqP,GAAAxC,KAAAlL,KAAM8H,KACDK,MAAQ,CAAEwF,SAAS,GAFKzJ,EADrC,OAAA7F,OAAAgN,EAAA,EAAAhN,CAAAqP,EAAA3C,GAAA1M,OAAA4B,EAAA,EAAA5B,CAAAqP,EAAA,EAAAxN,IAAA,SAAAC,MAAA,WAMoB,IAAAyE,EAAA5E,KACZ,OACI+L,EAAA1J,EAAA2J,cAAC4B,GAAAvL,EAAD,CACIwL,SAAU,CAAC,MAAO,UAClBC,OAAQ9N,KAAKmI,MAAMwF,QACnBI,QAAShC,EAAA1J,EAAA2J,cAACwB,GAAD,KAAOxN,KAAK8H,MAAMkG,OAE3BjC,EAAA1J,EAAA2J,cAAA,OACIiC,aAAc,kBAAMrJ,EAAKwD,SAAS,CAAEuF,SAAS,KAC7CO,aAAc,kBAAMtJ,EAAKwD,SAAS,CAAEuF,SAAS,MAE5C3N,KAAK8H,MAAMoF,eAjBhCQ,EAAA,CAA6BpB,IAAMC,WCjB/BrM,IAAO,EA2BJ,SAASiO,GAAUrG,GAKtB,IAAMsG,EAAsB,GAC5B,OAAKtG,EAAM7D,aAA4C,IAA7B6D,EAAM7D,YAAYzE,QAG5CsI,EAAM7D,YAAYM,QAAQ,SAAC8I,GACvB,IAAIpO,EAEAA,EADA6I,EAAM+D,SFpCX,SAA4BwB,EAA+BnN,GAC9D,OAAO6L,EAAA1J,EAAA2J,cAACsB,GAADjP,OAAAkP,OAAA,GAAwBF,EAAxB,CAAoCnN,IAAKA,EAAK2L,UAAU,KEoC9CwC,CAAmBhB,EAAYnN,MAE/BkN,GAAqBC,EAAYnN,MAE1CmN,EAAWiB,UACXrP,EAAS8M,EAAA1J,EAAA2J,cAACuC,GAAD,CAASP,KAAMX,EAAWiB,SAAUrP,IAEjDmP,EAAK1J,KAAKzF,KAGV8M,EAAA1J,EAAA2J,cAAA,OAAKiB,UAAS,6CAAA7M,OAA+C0H,EAAM0G,UAAY,gBAC1EJ,IAhBErC,EAAA1J,EAAA2J,cAAA,2KCnBR,IAAMyC,GAAb,SAAA1D,GAME,SAAA0D,EAAmB3G,GAA4B,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAyO,IAC7CvK,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAAoQ,GAAAvD,KAAAlL,KAAM8H,KAHAN,KAAuB,GAEgBtD,EAmCvCwK,aAAe,SAAC1L,GACtB,IAAM2L,EAAM,8BAAAvO,OAAiC4C,EAAjC,KACN4L,EAAM,qBAAAxO,OAAwB4C,EAAxB,aAAA5C,OZ1BT,SAAmByO,GACxB,IAAI7L,EAAyB,MAAjB6L,EAAGC,OAAO,GAAaD,EAAGE,UAAU,EAAG,GAAKF,EAKpDxP,EADW,CAHP2P,SAAShM,EAAM+L,UAAU,EAAG,GAAI,IAGpB,IAFZC,SAAShM,EAAM+L,UAAU,EAAG,GAAI,IAEX,IADrBC,SAAShM,EAAM+L,UAAU,EAAG,GAAI,IACF,KACrBzS,IAAI,SAAC2S,GACpB,OAAIA,GAAO,OACFA,EAAM,MAERrQ,KAAKsQ,KAAKD,EAAM,MAAS,MAAO,OAGzC,MADQ,MAAS5P,EAAE,GAAK,MAASA,EAAE,GAAK,MAASA,EAAE,GACxC,KAAQ,UAAY,UYawB8P,CAAUnM,GAAnD,KACNoM,EAAWlL,EAAKiE,MAAMiH,SAC5B,OAAO1F,IAAO5J,EAAduP,KAEMD,EAAWR,EAASD,EAGpBC,IA1CN1K,EAAKiE,MAAQ,CAAEiH,UAAU,GAFoBlL,EANjD,OAAA7F,OAAAgN,EAAA,EAAAhN,CAAAoQ,EAAA1D,GAAA1M,OAAA4B,EAAA,EAAA5B,CAAAoQ,EAAA,EAAAvO,IAAA,oBAAAC,MAAA,WAU6B,IAAAyE,EAAA5E,KACzBA,KAAKwH,KAAK9C,KACRmE,GAAeD,UAAU,SAACwG,GACxBxK,EAAKwD,SAAS,CACZgH,SAAUvM,EAAQuM,KAAcvM,EAAQ+B,EAAKkD,MAAM3C,cAd7D,CAAAjF,IAAA,uBAAAC,MAAA,WAqBIH,KAAKwH,KAAKjD,QAAQ,SAACwE,GAAD,OAASA,EAAIC,kBArBnC,CAAA9I,IAAA,SAAAC,MAAA,WCjBO,IAAqB2C,EACtBD,EADsBC,EDyCZ9C,KAAK8H,MAAM3C,SCxCNtC,EAAQgG,GAAe1I,OACxC0I,GAAeb,KAAK/E,GACf4F,GAAeb,KAAKlF,KDc7B,CAAA5C,IAAA,SAAAC,MAAA,WA4BI,IAAMmP,EAAYtP,KAAK0O,aAAa1O,KAAK8H,MAAM3C,MAAMnC,OAC/CuM,EAAYvP,KAAK8H,MAAM3C,MAAMpC,KACnC,OACEgJ,EAAA1J,EAAA2J,cAACgB,GAAD,CAAY9M,IAAKqP,EAAWrD,MAAO,CAAEsD,UAAW,WAC/B,cAAdD,GACCxD,EAAA1J,EAAA2J,cAAA,SACED,EAAA1J,EAAA2J,cAACsD,EAAD,CAAWrD,QAASjM,KAAKyP,OAAOC,KAAK1P,OAAQuP,IAGjDxD,EAAA1J,EAAA2J,cAACmC,GAAD,CAAWlK,YAAajE,KAAK8H,MAAM6H,IAAKnB,UAAU,SArC1DC,EAAA,CAAoCnC,IAAMC,WEcnC,SAASqD,GAAW9H,GACzB,IAAM7D,EAAc6D,EAAM7D,YAC1B,IAAKA,GAAsC,IAAvBA,EAAYzE,OAC9B,OAAOuM,EAAA1J,EAAA2J,cAAA,YAET,IAAM6D,EAAqB1G,IAAE2G,QAAQ7L,EAAa,SAACZ,GAAD,YACnClE,IAAbkE,EAAG8B,MAAsB9B,EAAG8B,MAAQ9B,EAAG8B,MAAMpC,OAEzCgN,EAAwB,GAQ9B,OAPA5G,IAAE5E,QAAQsL,EAAoB,SAACF,EAAK5M,GAClC,KAAa,cAATA,GAAwBoG,IAAEpK,KAAK8Q,GAAsB,GAAzD,CAGA,IAAM1K,EAAewK,EAAI,GAAGxK,MAAQwK,EAAI,GAAGxK,MAAQlC,EACnD8M,EAAOrL,KAAKqH,EAAA1J,EAAA2J,cAACgE,GAAD3R,OAAAkP,OAAA,CAAgBrN,IAAK2C,EAAQsC,IAAY,CAAEA,QAAOwK,aAG9D5D,EAAA1J,EAAA2J,cAAA,OACEE,MAAO,CACL+D,OAAQ,OACRC,UAAW,IAGZH,uLCtDA,IAAMI,GAAUzG,IAAOI,IAAVsG,KACP,SAAApG,GAAA,OAAAA,EAAGC,MAAyC+D,OAGpCtE,IAAO2G,MAAVC,KACL,SAAA5D,GAAA,OAAAA,EAAGzC,MAAyC+D,OCYzD,SAASuC,KACP,MAAO,CAACxE,EAAA1J,EAAA2J,cAAA,MAAI9L,IAAK,IAAO6L,EAAA1J,EAAA2J,cAAA,MAAI9L,IAAK,KA2GnC,SAASsQ,GAAaxL,EAAqBwG,EAAiBtL,GAM1D,OALIuQ,GAASzL,GACXwG,EAAS9G,KAAKqH,EAAA1J,EAAA2J,cAAA,OAAK9L,IAAKA,KAAV,GAAAE,OAAqBqQ,GAASzL,MAE5CwG,EAAS9G,KAAKqH,EAAA1J,EAAA2J,cAAA,MAAI9L,IAAKA,IAAOgM,MAAO,CAAEwE,WAAY,MAE9CxQ,EAiBT,SAASuQ,GAASpD,GAChB,SAAAjN,OAAUiN,EAAWsD,QAAX,UAAAvQ,OAA0BiN,EAAWsD,SAAY,IAA3DvQ,OACEiN,EAAWuD,SAAWvD,EAAWsD,QAAjC,iBAAAvQ,OACWiN,EAAWuD,SAClBvD,EAAWuD,QAAX,gBAAAxQ,OACMiN,EAAWuD,SACjB,IALNxQ,QAOGiN,EAAWsD,SAAWtD,EAAWuD,UAAYvD,EAAWwD,YACrD,IACA,IATNzQ,OAUGiN,EAAWwD,YAAX,UAAAzQ,OAA8BiN,EAAWwD,aAAgB,IAG9D,SAASC,GACP9L,EACAmB,GAEA,IAAM4K,EAAmB,GACnBtO,EAAiDuC,EAAKsD,cAC1DnC,EAAQrI,IAEJ4E,EACJyD,EAAQmC,cAActD,EAAKlH,IAW7B,OAVAiT,EAAOrM,KACLhE,EACE4B,EACE0C,EAAKI,YAAc,EACnBe,EAAQf,WACR3C,EACAC,KAICqO,EAGT,SAASC,GAAsBhM,GAC7B,IAAM+L,EAAmB,GACnBE,EAAQ,CACZ9J,QAASjE,EAAO8B,EAAKtB,gBACrBwN,QAAShO,EAAO8B,EAAKrB,eAEjBwN,EACJF,EAAM9J,QAAU,EAAhB,GAAA/G,OACO6Q,EAAM9J,QADb,KAAA/G,OACwBgB,EAAoB1B,EAAY0R,SACpD,GAEAC,EACJJ,EAAMC,QAAU,EAAhB,GAAA9Q,OACO6Q,EAAMC,QADb,KAAA9Q,OACwBgB,EAAoB1B,EAAY4R,OACpD,GAON,OALAP,EAAOrM,KAAP,GAAAtE,OACK+Q,GADL/Q,OAEI+Q,GAAmBE,GAAkB,OAFzCjR,OAGKiR,IAEEN,EAGT,SAASQ,GAAsBvM,GAC7B,IAAM+L,EAAmB,GACnBE,EAAQ,CACZ9J,QAASjE,EAAO8B,EAAKzB,SACrB2N,QAAShO,EAAO8B,EAAKxB,aAEjB2N,EACJF,EAAM9J,QAAU,EAAhB,GAAA/G,OACO6Q,EAAM9J,QADb,KAAA/G,OACwBM,EAAyB8Q,EAAa9P,SAC1D,GAEA2P,EACJJ,EAAMC,QAAU,EAAhB,GAAA9Q,OACO6Q,EAAMC,QADb,KAAA9Q,OACwBM,EAAyB8Q,EAAazP,QAC1D,GAON,OALAgP,EAAOrM,KAAP,GAAAtE,OACK+Q,GADL/Q,OAEI+Q,GAAmBE,GAAkB,OAFzCjR,OAGKiR,IAEEN,ECtNT,IAAMU,GAAqB,IAAI9R,EAAI,IAAK,IAAK,KACvC+R,GAAqB,IAAI/R,EAAI,IAAK,IAAK,KAEhCgS,GAAsC,CACjDC,SAAUH,GACVI,SAAUH,GACV/I,gBAAiB,SAACR,GAChB,IAAM/C,EAAa+C,EAAM/C,WACzB,QAAmBjG,IAAfiG,EACF,MAAO,qBAGT,IAAM0M,EnBPH,SAAuBtI,GAC1B,IAAKA,EACD,OAAO,EAEX,IAAMuI,EAAWvI,EAAIA,EACrB,OAAIA,GAAK,EACc,EAAIA,EAAfuI,EAEDA,EAAW,EAAIvI,EmBDAwI,CAAc5M,GAExC,OAAO/E,EAAiBoR,GAAoBC,IAD3BI,EAAoB,GAAK,IAG5ClG,iBDiBK,SACL5G,EACAmD,GAGA,GADO8J,UAAAzS,OAAA,QAAAL,IAAA8S,UAAA,IAAAA,UAAA,GACH9J,EAAM/B,SAAU,OAAOmK,KAE3B,IAAIrQ,EAAM,EACNsL,EAAkB,GAJf0G,EAsBT,SACElN,EACAmD,EACAqD,EACAtL,EACAiS,EACAC,GAEA,GAAKpN,EAAKP,UAcR+G,EAAS9G,KAAKqH,EAAA1J,EAAA2J,cAAA,MAAI9L,IAAKA,IAAOgM,MAAO,CAAEwE,WAAY,UAdhC,CACnB,IAAMxI,EAAON,KACb,GAAIM,GAAQA,EAAKpK,KAAOkH,EAAKlH,GAAI,CAC/B,IAAMiT,EAASoB,EAAcnN,EAAMkD,GACnCsD,EAAWA,EAASpL,OAClB2Q,EAAOzU,IAAI,SAAC+V,GAAD,OAAStG,EAAA1J,EAAA2J,cAAA,OAAK9L,IAAKA,KAAQmS,UAEnC,CACL,IAAMtB,EAASqB,EAAWjK,GAC1BqD,EAAWA,EAASpL,OAClB2Q,EAAOzU,IAAI,SAAC+V,GAAD,OAAStG,EAAA1J,EAAA2J,cAAA,OAAK9L,IAAKA,KAAQmS,OAM5C,MAAO,CAAE7G,WAAUtL,OApCEoS,CACnBtN,EACAmD,EACAqD,EALFtL,EAAMsQ,GAAaxL,EAAMwG,EAAUtL,GAOjC4Q,GACAS,IAGF,OATG/F,EAVI0G,EAUJ1G,SAAUtL,EAVNgS,EAUMhS,IASNsL,ICrCH+G,GAAgB,IAAI5S,EAAI,IAAK,IAAK,KAClC6S,GAAgB,IAAI7S,EAAI,IAAK,IAAK,IAO3B8S,GAAiC,CAC5Cb,SAAUW,GACVV,SAAUW,GACV7J,gBAAiB,SAACR,GAChB,IAAM9C,EAAe8C,EAAM9C,aAC3B,YAAqBlG,IAAjBkG,EAAmC,qBAChChF,EAAiBkS,GAAeC,GAAenN,IAExDuG,iBD9BK,SACL5G,EACAmD,EACAgB,GAEA,GAAIhB,EAAM/B,SAAU,OAAOmK,KAC3B,IAhBqBlO,EAgBjBnC,EAAM,EACNsL,EAAkB,GAGtB,GAFAtL,EAyEF,SACEiI,EACAnD,EACA6G,EACAL,EACAtL,GAEA,IA0BAmN,EACAqF,EA3BItN,EAAa+C,EAAM/C,WAIvB,GAHIA,IAAeA,EAAa,GAAKA,GAAc,KACjDA,EAAaJ,EAAKI,YAEhBA,IAAeJ,EAAKP,UAAW,CACX,GAAArE,OAAM1B,EAAe0G,GAArB,KAAtB,IACMuN,GAqBRD,EArB4CtN,EAwB1C1G,GAJF2O,EApBsCrI,GAwBVI,cAAgB1G,EAAegU,GAElD,EAEFrF,EAAWuF,gBACdlU,EAAe2O,EAAWuF,iBAC1B,GA7BF,GAAI/G,GAAyB,IAAb8G,EAAgB,CAC9B,IAAME,EAAQF,EAAW,EAAI,YAAS,YACpB,GAAAvS,OAAOyS,EAAP,KAAAzS,OAAgBuS,EAAhB,KAEpBnH,EAAS9G,KAAKqH,EAAA1J,EAAA2J,cAAA,OAAK9L,IAAKA,KAAQ,KAElC,OAAOA,EA7FD4S,CAAkB3K,EAAOnD,IAAQmE,EAAGqC,EAAUtL,GACpDA,EAAMsQ,GAAaxL,EAAMwG,EAAUtL,GAC9B8E,EAAKP,UAaR+G,EAAS9G,KAAKqH,EAAA1J,EAAA2J,cAAA,MAAI9L,IAAKA,IAAOgM,MAAO,CAAEwE,WAAY,UAbhC,CACnB,IAAMxI,EAAON,KACTM,GAAQA,EAAKpK,KAAOkH,EAAKlH,GAC3B0N,EAAS9G,KACPqH,EAAA1J,EAAA2J,cAAA,OAAK9L,IAAKA,KAAV,GAAAE,YAvBIjB,KADWkD,EAwBoB2C,EAAKwD,cAAcN,EAAKpK,KAvBrC,IACxBuE,EAAU,sBACP,uBAuBM6F,GAAQA,EAAKpK,KAAOkH,EAAKlH,IAClC0N,EAAS9G,KAAKqH,EAAA1J,EAAA2J,cAAA,OAAK9L,IAAKA,KAAV,gBACdsL,EAAS9G,KAAKqH,EAAA1J,EAAA2J,cAAA,OAAK9L,IAAKA,KAAQ8Q,GAAsB7I,MAEtDqD,EAAS9G,KAAKqH,EAAA1J,EAAA2J,cAAA,OAAK9L,IAAKA,KAAQ8Q,GAAsB7I,KAK1D,OAAOqD,IElCF,IAAMuH,GAAb,SAAAhI,GAGI,SAAAgI,EAAmBjL,GAAwB,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAA+S,IACvC7O,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAA0U,GAAA7H,KAAAlL,KAAM8H,KAHFiB,IAA2B,KAI/B7E,EAAKiE,MAAQ,CAAEiH,SAAUtH,EAAMkL,OAASlK,GAAa3I,OAFd+D,EAH/C,OAAA7F,OAAAgN,EAAA,EAAAhN,CAAA0U,EAAAhI,GAAA1M,OAAA4B,EAAA,EAAA5B,CAAA0U,EAAA,EAAA7S,IAAA,oBAAAC,MAAA,WAQ+B,IAAAyE,EAAA5E,KACvBA,KAAK+I,IAAMD,GAAaF,UAAU,CAC9BZ,KAAM,SAACgL,GACCA,IAASpO,EAAKkD,MAAMkL,MACpBpO,EAAKwD,SAAS,CAAEgH,UAAU,SAZ9C,CAAAlP,IAAA,uBAAAC,MAAA,WAmBYH,KAAK+I,KAAK/I,KAAK+I,IAAIC,gBAnB/B,CAAA9I,IAAA,SAAAC,MAAA,WAsBoB,IAsBF2H,EAJCkG,EAlBC1I,EAAAtF,KAENkM,GAoBIpE,EApBa9H,KAAK8H,OAqBnB1B,SACP,GACA,CACI6M,WAAU,0BAAA7S,OAA4B0H,EAAMkL,KAAKpB,SAASsB,SAAhD,SAAA9S,OAAgE0H,EAAMkL,KAAKnB,SAASqB,SAApF,UACVC,OAAQ,WAxBd,OACIpH,EAAA1J,EAAA2J,cAAA,QACIiB,UAJK,oCAKLf,MAAOA,EACPD,QAAS,WAvCzB,IAAwBxN,GAwCH6G,EAAKwC,MAAM1B,WAxCR3H,EAwCmC6G,EAAKwC,MAAMkL,KAvClElK,GAAad,KAAKvJ,KAwCD6G,EAAKwC,MAAM1B,UAAYd,EAAK8C,SAAS,CAAEgH,UAAU,OASnDpB,EANQhO,KAAK8H,MAAMkG,KAAMhO,KAAKmI,MAAMiH,SAOjCrD,EAAA1J,EAAA2J,cAAA,SAAIgC,GAAYjC,EAAA1J,EAAA2J,cAAA,SAAIgC,SAzC1C+E,EAAA,CAAgCzG,IAAMC,wGCRtC,IAAM6G,GAAW1J,YAAOyD,GAAPzD,CAAH2J,KACE,SAAArJ,GAAA,OAAAA,EAAGC,MAAyC0C,UAGrD,SAAS2G,KACd,OACEvH,EAAA1J,EAAA2J,cAACoH,GAAD,CAAUnG,UAAU,kBAAkB/M,IAAI,YACxC6L,EAAA1J,EAAA2J,cAACuH,GAAD,CAAYP,KAAMrB,GAAgB3D,KAAM,kBACxCjC,EAAA1J,EAAA2J,cAACuH,GAAD,CAAYP,KAAMP,GAAWzE,KAAM,kBCHlC,IAAMwF,GAAb,SAAAzI,GAEE,SAAAyI,EAAmB1L,GAAc,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAwT,IAC/BtP,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAAmV,GAAAtI,KAAAlL,KAAM8H,KAFAN,KAAuB,GAG7BtD,EAAKiE,MAAQ,CAAEsL,KAAMC,GAASvT,OAFC+D,EAFnC,OAAA7F,OAAAgN,EAAA,EAAAhN,CAAAmV,EAAAzI,GAAA1M,OAAA4B,EAAA,EAAA5B,CAAAmV,EAAA,EAAAtT,IAAA,oBAAAC,MAAA,WAO6B,IAAAyE,EAAA5E,KACzBA,KAAKwH,KAAK9C,KACRgP,GAAS9K,UAAU,SAAC6K,GAClB7O,EAAKwD,SAAS,CAAEqL,cAVxB,CAAAvT,IAAA,uBAAAC,MAAA,WAgBIH,KAAKwH,KAAKjD,QAAQ,SAACwE,GAAD,OAASA,EAAIC,kBAhBnC,CAAA9I,IAAA,SAAAC,MAAA,WAoBI,OAA+B,IAA3BH,KAAKmI,MAAMsL,KAAKjU,OACXuM,EAAA1J,EAAA2J,cAACmE,GAAD,uBAGPpE,EAAA1J,EAAA2J,cAACmE,GAAD,KACEpE,EAAA1J,EAAA2J,cAACsH,GAAD,MACAvH,EAAA1J,EAAA2J,cAAC4D,GAAD,CAAY3L,YAAajE,KAAKmI,MAAMsL,YA1B5CD,EAAA,CAAsClH,IAAMC,WCE/BoH,GAAqB,IAAIC,IAAgB7H,EAAA1J,EAAA2J,cAAC6H,GAAD,OAEzCC,GAAY,IAAIF,IAAgC,MAEhDG,GAAiB,IAAIC,IAI3B,SAASC,GAAoB3Q,GAClCyQ,GAAe/L,KAAK1E,GAGf,IAAMuF,GAAiB,IAAI+K,IAAuB3Q,GAE5CyQ,GAAW,IAAIE,IAAqC,IAGpDM,GAAQ,IAAIN,IAAiC,IAG7C7L,GAAkB,IAAI6L,IACjC,MAEK,SAAShM,KACd,OAAOG,GAAgB5H,MAIlB,IAAM2I,GAAe,IAAI8K,IAC9BjC,IAIWwC,GAAgB,IAAIP,KAAyB,GAC7CQ,GAAS,IAAIJ,IC3CbK,GAAb,WAyBE,SAAAA,EAAmBC,GAAejW,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAqU,GAAArU,KAxB1BuU,SAwByB,EAC/BvU,KAAKuU,IAAMC,IAAMC,gBAAgBH,GA1BrC,OAAAjW,OAAA4B,EAAA,EAAA5B,CAAAgW,EAAA,EAAAnU,IAAA,cAAAC,MAAA,WAII,IAAIlB,EADuByV,EAEN1U,KAAKuU,IAAIvM,OAFH2M,EAAAtW,OAAAuW,EAAA,EAAAvW,CAAAqW,EAAA,GAG3B,OADCzV,EAF0B0V,EAAA,GAElB3U,KAAKuU,IAFaI,EAAA,GAGpB1V,EAAS,aANpB,CAAAiB,IAAA,YAAAC,MAAA,SASmBkC,EAAWvC,GAC1B,IAAIb,EADyC4V,EAExBL,IAAMM,uBAAuBzS,EAAGvC,EAAGE,KAAKuU,KAFhBQ,EAAA1W,OAAAuW,EAAA,EAAAvW,CAAAwW,EAAA,GAG7C,OADC5V,EAF4C8V,EAAA,GAEpC/U,KAAKuU,IAF+BQ,EAAA,GAGtC9V,IAZX,CAAAiB,IAAA,WAAAC,MAAA,WAgBI,IAAIlB,EADqB+V,EAEJhV,KAAKuU,IAAIvM,OAFLiN,EAAA5W,OAAAuW,EAAA,EAAAvW,CAAA2W,EAAA,GAGzB,OADC/V,EAFwBgW,EAAA,GAEhBjV,KAAKuU,IAFWU,EAAA,GAGlBhW,EAAS,IAAM,IAlB1B,CAAAiB,IAAA,OAAAC,MAAA,SAqBcmU,GACVtU,KAAKuU,IAAMC,IAAMC,gBAAgBH,OAtBrCD,EAAA,GAkCa,IAAIT,IAAgB,IAAIS,GAAkB,IAIvCH,GAAMtL,UAAU,CAC9BZ,KAAM,eCrCD,SAASkN,GAAQC,EAAsBrX,GAC5C,OAAOqX,EAAUC,gBAAgBtX,GAuB5B,SAAS0I,GAAsB2O,GACpC,OAAOA,EAAUlR,YAAY2C,OAAO,SAACvD,GAAD,OAASA,EAAGoB,YAuB3C,IAgCM4Q,GAAb,WAWE,SAAAA,EAAmBC,GAAqCjX,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAqV,GAAArV,KAVjDiE,YAA4B,GAUoBjE,KAThDoV,gBAAgD,GASApV,KARhDuV,iBAA2B,EAQqBvV,KAPhDwV,MAAgB,EAOgCxV,KANhDyV,iBAMgD,EAAAzV,KALhD0V,IAAoB,GAMzB,IAAMC,EAAOxM,IAAEyM,UAAUN,GACzBjX,OAAOkP,OAAOvN,KAAM2V,GAbxB,OAAAtX,OAAA4B,EAAA,EAAA5B,CAAAgX,EAAA,EAAAnV,IAAA,aAAAyE,IAAA,WAQI,OAAO3E,KAAK0V,IAAI1V,KAAKwV,WARzBH,EAAA,GCrFaQ,GAAb,SAAAA,IAAAxX,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAA6V,GAAA7V,KACW8V,mBAA+B,GAD1C9V,KAEW+V,gBAFX,EAAA/V,KAGWgW,YAHX,EAAAhW,KAIWiW,cAJX,EAAAjW,KAKWkW,oBAAgC,GAL3ClW,KAMWmW,SAAmB,EAN9BnW,KAOWoW,MAAoC,GAP/CpW,KAQWqW,iBAA2B,EARtCrW,KASWsW,OAAiB,EAT5BtW,KAUWuW,eAVX,GCOaC,GAAb,oBAAAA,IAAAnY,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAwW,GAAA,OAAAnY,OAAA4B,EAAA,EAAA5B,CAAAmY,EAAA,EAAAtW,IAAA,cAAAC,MAAA,SACqBgV,EAAsBsB,GACvC,IAAIxN,EAAW,IAAIoM,GAAiBF,GAKpC,MAJAlM,EAASuM,QACLhP,GAAsB2O,GAAW3V,OAAS,IAC5CyJ,EAASyM,IAAIzM,EAASuM,OAAS,IAAIK,IAE/B,IAAI3X,MAAM,qCAPpBsY,EAAA,GCIaE,GAAiC,CAC5CC,YAAa,SAACrT,GACZ,OAAOA,EAAI,GAEbsT,WAAY,EACZC,eAAe,EACfC,aAAa,GCZR,IAAMC,GAAgC,CAC3CJ,YAAa,SAACrT,GAAD,OAAqB,IAANA,GAC5BsT,WAAY,EACZC,eAAe,EACfC,aAAa,iOCAEpN,IAAOI,IAAVkN,KAEH,SAAAhN,GAAA,OAAAA,EAAGC,MAAyC+D,OAExCtE,IAAOjL,EAAVwY,KAED,SAAAvK,GAAA,OAAAA,EAAGzC,MAAyC+D,wKCbhCtE,IAAOc,IAAV0M,2jCCSb,IAAMC,GAAmBzN,IAAO0N,GAAVC,KAGvB,SAAArN,GAAA,OAAAA,EAAGC,MAAyCqN,kBAG7B5N,IAAO6N,MAAVC,KAEZ,SAAA9K,GAAA,OAAAA,EAAGzC,MAAyCqN,kBAIrC5N,YAAOyN,GAAPzN,CAAH+N,KACY,SAAA3K,GAAA,OAAAA,EAAG7C,MAAyCyN,WAGpDhO,YAAOyN,GAAPzN,CAAHiO,KACW,SAAAC,GAAA,OAAAA,EAAG3N,MACf4N,gBAGMnO,YAAOyN,GAAPzN,CAAHoO,KACS,SAAAC,GAAA,OAAAA,EAAG9N,MAAyC+N,cAGxCtO,YAAOyN,GAAPzN,CAAHuO,KACD,SAAAC,GAAA,OAAAA,EAAGjO,MAAyCkO,aAGtCzO,YAAOyN,GAAPzN,CAAH0O,KACH,SAAAC,GAAA,OAAAA,EAAGpO,MAAyCqO,eAGvC5O,YAAOyN,GAAPzN,CAAH6O,KACF,SAAAC,GAAA,OAAAA,EAAGvO,MAAyCwO,cAG3C/O,YAAOyN,GAAPzN,CAAHgP,KACE,SAAAC,GAAA,OAAAA,EAAG1O,MAAyC2O,UAGjDlP,IAAOmP,GAAVC,MChDP,IAAMC,GAAwB,CACjCpC,YAAa,SAACrT,GAAD,OAAqB,IAANA,GAC5BsT,WAAY,EACZC,eAAe,EACfC,aAAa,GCOV,IAAMkC,GAAb,WAGE,SAAAA,IAAsB3a,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAgZ,GAAAhZ,KAFdiZ,aAEa,EACnBjZ,KAAKiZ,QAAU,IAAIzC,GAJvB,OAAAnY,OAAA4B,EAAA,EAAA5B,CAAA2a,EAAA,EAAA9Y,IAAA,gBAAAC,MAAA,SAUuBgV,EAAsB+D,GACzC,OAAOlZ,KAAKiZ,QAAQE,YAAYhE,EAAW+D,KAX/C,CAAAhZ,IAAA,mBAAAC,MAAA,SAc0BiZ,GACtB,OAAgB,IAAZA,EACKrC,GAEO,IAAZqC,EACKL,GAEFrC,OArBXsC,EAAA,GCMaK,GAAb,WAOE,SAAAA,EAAmB9R,GAAe,IAAArD,EAAAlE,KAAA3B,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAqZ,GAAArZ,KAN1BuH,UAM0B,EAAAvH,KAL1BsZ,cAAgC,GAKNtZ,KAJ1BuZ,OAAiB,IAAIP,GAIKhZ,KAH1BwZ,OAAyB,GAGCxZ,KAF1ByZ,gBAA0B,EAEAzZ,KAkC1BiU,oBAAsB,SAACyF,GAC7B,IAAMC,EAAgBzV,EAAKqD,KAAKY,MAAMwR,cAChCC,EAAiB1V,EAAKsV,OAAOha,OAC7Bqa,EAAcF,EAAgBD,EACpC,KAAIG,EAAc,GAAlB,CAGA,IZpDuBC,EYoDjBC,EAAc7V,EAAKqD,KAAKY,MAAM6R,SAClC9V,EAAKqD,KAAKY,MAAM6R,SAASxa,OAAS,GAEpC,GAAIqa,EAAcD,EAEhB1V,EAAK+V,cAAcJ,QACd,GAAIA,IAAgBD,EAAgB,CAEzC,IAAMM,EAAmBH,EAAY5E,UAC/BgF,EAAiB3T,GAAsBuT,EAAY5E,WACtD3V,OACG4a,EAAkBlW,EAAKqV,OAAOc,iBAAiBF,GACjDA,EAAiB,IZhEAL,EYkEjB5V,EAAKqV,OAAOe,cAAcJ,EAAkBE,GZjEpDtG,GAAU9L,KAAK8R,GYmET5V,EAAK+P,oBAAoB,OAxD7BjU,KAAKuH,KAAOA,EACZvH,KAAKsZ,cAAc5U,KACjBoP,GAAUlL,UAAU,CAClBZ,KAAM,SAAC8R,GAAD,OAAa5V,EAAKqW,aAAaT,OAGzC9Z,KAAKsZ,cAAc5U,KACjBqP,GAAenL,UAAU,CACvBZ,KAAM,SAAC7H,GACL+D,EAAK+P,oBAAoB9T,OAjBnC,OAAA9B,OAAA4B,EAAA,EAAA5B,CAAAgb,EAAA,EAAAnZ,IAAA,qBAAAC,MAAA,WAwBI,OAAOH,KAAKyZ,kBAxBhB,CAAAvZ,IAAA,gBAAAC,MAAA,eAAAqa,EAAAnc,OAAAoc,EAAA,EAAApc,CAAAqc,EAAArY,EAAAsY,KAAA,SAAAC,EA2B6B9c,GA3B7B,OAAA4c,EAAArY,EAAAwY,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAA9S,MAAA,cA4BI2L,GAAmB3L,KAAKhI,KAAKwZ,OAAO1b,GAAIkd,MAAMC,QAC9Cjb,KAAKyZ,gBAAkBzZ,KAAKwZ,OAAO1b,GAAIod,MA7B3CJ,EAAA9S,KAAA,EA8BUhI,KAAKuH,KAAKa,SAAS,CAAEuR,cAAe7b,IA9B9C,OA+BgC,OAAxB8J,MACFG,GAAgBC,KACdkN,GACElV,KAAKwZ,OAAOxZ,KAAKuH,KAAKY,MAAMwR,eAAeqB,MAAM7F,UACjDvN,KAAqB9J,KAnC/B,wBAAAgd,EAAAK,SAAAP,EAAA5a,SAAA,gBAAAob,GAAA,OAAAZ,EAAAa,MAAArb,KAAAiS,YAAA,KAAA/R,IAAA,iBAAAC,MAAA,SAyEyBmb,GACrB,IAAMnT,EAAQnI,KAAKuH,KAAKY,WAGmBhJ,IAAzCgJ,EAAM6R,SAASha,KAAKyZ,kBACnBtR,EAAM6R,SAASha,KAAKyZ,iBAAiBP,KAAKrC,gBAjFpC,KAqFLyE,EAAMC,QACRtH,IAAqB,GArFb,KAsFCqH,EAAMC,SACftH,GAAoB,MArF1B,CAAA/T,IAAA,eAAAC,MAAA,SAyFuB2Z,GAAyB,IAAAlV,EAAA5E,KAC5C,GAAK8Z,EAGE,CACL,IAAM7Q,EAAQ5K,OAAA+K,EAAA,EAAA/K,CAAA,GAAQ2B,KAAKuH,KAAKY,OAM1B+S,GAHmB,IAAvBlb,KAAKwZ,OAAOha,QACP,EACDQ,KAAKwZ,OAAOxZ,KAAKwZ,OAAOha,OAAS,GAAG0b,OACd,EAC5Blb,KAAKwZ,OAAO9U,KAAK,CAAEsW,MAAOlB,EAASoB,UACnCpB,EAAQN,OAAOjV,QAAQ,SAACyW,GAAD,OAAWpW,EAAK4U,OAAO9U,KAAK,CAAEsW,QAAOE,YAC5DjS,EAAS+Q,SAAStV,KAAKoV,GACvB9Z,KAAKuH,KAAKa,SAASa,QAbnBjJ,KAAKuH,KAAKa,SAAS,CAAE4R,SAAU,GAAIL,cAAe,IAClD3Z,KAAKwZ,OAAS,KA5FpB,CAAAtZ,IAAA,UAAAC,MAAA,WA6GIH,KAAKsZ,cAAc/U,QAAQ,SAACwE,GAAD,OAASA,EAAIC,kBA7G5C,CAAA9I,IAAA,gBAAAyE,IAAA,WAsEI,OAAO3E,KAAKwb,eAAe9L,KAAK1P,UAtEpCqZ,EAAA,GCXaoC,GAAb,SAAA1Q,GAEE,SAAA0Q,EAAmB3T,GAAW,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAyb,IAC5BvX,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAAod,GAAAvQ,KAAAlL,KAAM8H,KAFAqD,gBACsB,EAE5BjH,EAAKiH,WAAa,IAAIkO,GAAJhb,OAAA+M,EAAA,EAAA/M,QAAA+M,EAAA,EAAA/M,CAAA6F,KAClBA,EAAKiE,MAAQ,CAAE6R,SAAU,GAAIL,cAAe,GAHhBzV,EAFhC,OAAA7F,OAAAgN,EAAA,EAAAhN,CAAAod,EAAA1Q,GAAA1M,OAAA4B,EAAA,EAAA5B,CAAAod,EAAA,EAAAvb,IAAA,oBAAAC,MAAA,WASIub,SAASC,iBAAiB,UAAW3b,KAAKmL,WAAWyQ,iBATzD,CAAA1b,IAAA,uBAAAC,MAAA,WAaIH,KAAKmL,WAAW0Q,YAbpB,CAAA3b,IAAA,SAAAC,MAAA,WAiBI,OACE4L,EAAA1J,EAAA2J,cAACmB,GAAD,CAAKjB,MAAO,CAAE4P,SAAU,IAAKC,QAAS,SACpChQ,EAAA1J,EAAA2J,cAACmE,GAAD,KAAUnQ,KAAKgc,kBAnBvB,CAAA9b,IAAA,eAAAC,MAAA,SAwBuB8b,EAAe/b,GAClC,OAAIA,IAAQF,KAAKmI,MAAMwR,cACd5N,EAAA1J,EAAA2J,cAAA,YAAOiQ,GAETA,IA5BX,CAAA/b,IAAA,cAAAC,MAAA,WA+BwB,IAAAyE,EAAA5E,KACdf,EAAwB,GAE1Bid,GAAc,EACdC,EAAW,EA0Bf,OAzBAnc,KAAKmI,MAAM6R,SAASzV,QAAQ,SAACuV,GAC3B,IAAMhc,IAAOoe,EACbjd,EAAOyF,KACLqH,EAAA1J,EAAA2J,cAAA,KACE9L,IAAKpC,EACLmO,QAAS,WACPrH,EAAKuG,WAAW8O,cAAcnc,KAG/B8G,EAAKwX,aAAatC,EAAQmC,MAAOne,KAGtCmB,EAAOyF,KAAKqH,EAAA1J,EAAA2J,cAAA,MAAI9L,MAAOic,KACvBrC,EAAQN,OAAOjV,QAAQ,SAACyW,GACtB,IAAMld,IAAOoe,EACTtX,EAAKuG,WAAWkR,uBAAyBvC,EAAQ3E,UAAUK,QAC7DvW,EAAOyF,KACLqH,EAAA1J,EAAA2J,cAAA,KAAG9L,IAAKpC,EAAImO,QAAS,kBAAMrH,EAAKuG,WAAW8O,cAAcnc,KACtD8G,EAAKwX,aAAapB,EAAMiB,MAAOne,KAGpCmB,EAAOyF,KAAKqH,EAAA1J,EAAA2J,cAAA,MAAI9L,MAAOic,UAItBld,MA7DXwc,EAAA,CAA6BnP,IAAMC,WCZtB+P,GAAU,WAKrB,IAJA,IAEIC,EADF,mEACqBC,MAAM,IACzBC,EAAiC,IAAIC,IAChCxd,EAAI,EAAGA,EAAIqd,EAAO/c,OAAQN,IACjCud,EAAUE,IAAIJ,EAAOrd,GAAIA,GAE3B,MAAO,CACL0d,QAAS,SAAUC,GAEjB,IADA,IAAI5d,EAAS,GAEXA,EAASsd,EAAe,GAARM,GAAgB5d,EAElB,KADd4d,KAAW,KAGb,OAAO5d,GAET6d,MAAO,SAAUC,GAGf,IAFA,IAAI9d,EAAS,EACTsd,EAASQ,EAAUP,MAAM,IACpBtd,EAAI,EAAGA,EAAIqd,EAAO/c,OAAQN,IAAK,CACtC,IAAM8d,EAAIP,EAAU9X,IAAI4X,EAAOrd,IAC/B,QAAUC,IAAN6d,EACF,MAAM,IAAI9e,MAAM,yCAClBe,GAAUA,GAAU,GAAK+d,EAE3B,OAAO/d,IA3BU,GCQhB,SAASge,GACdD,EACAE,GAEA,IAAMtd,EAAI,IAAIoE,EAAmBmF,IAAEyM,UAAUoH,EAAE/Y,cAC/CrE,EAAEud,QACF,IAAM9d,EAAI6d,EAAGE,OACb,IACE,GAA4B,IAAxB/d,EAAEmd,MAAM,KAAKhd,OAAc,MAAM,IAAItB,MAAJ,cADnC,IAAAmf,EAEuDhe,EAAEmd,MAAM,KAF/Dc,EAAAjf,OAAAuW,EAAA,EAAAvW,CAAAgf,EAAA,GAEKtN,EAFLuN,EAAA,GAEaC,EAFbD,EAAA,GAEuBhV,EAFvBgV,EAAA,GAEsC9U,EAFtC8U,EAAA,GAGF,GACEhV,EAAc9I,OAAS,EAAI,GAC3B+d,EAAS/d,OAAS,EAAI,GACtBgJ,EAAchJ,OAAS,EAAI,EAE3B,MAAM,IAAItB,MAAJ,sBAAAkC,OACkBmd,EAAS/d,OAD3B,MAAAY,OACsCkI,EAAc9I,OADpD,MAAAY,OAC+DoI,EAAchJ,UAgEzF,SAAwBwd,EAAuB3d,GAC7C,IAAIH,EAAI,EACR,UAAoBC,IAAbE,EAAE,EAAIH,IACX8d,EAAElY,MAAM0Y,GAAiBR,EAAD,GAAA5c,OAAOf,EAAE,EAAIH,IAAbkB,OAAkBf,EAAE,EAAIH,EAAI,IAAM,YAAY6D,MACtE7D,IAlEAue,CAAe7d,EAAG2d,GA2BtB,SAAsBP,EAAuB3d,GAClBA,EAAEmd,MAAM,KAC1BjY,QAAQ,SAACzB,GACd,IAAM4a,EAAO5a,EAAE2C,QAAQ,KACvB,IAAc,IAAViY,EAAa,MAAM,IAAIxf,MAAM,wCACjC,IAAMqR,EAAYzM,EAAE6a,MAAM,EAAGD,GACvB1a,EAAQF,EAAE6a,MAAMD,EAAO,EAAGA,EAAO,GACjChX,EAAU5D,EAAE6a,MAAMD,EAAO,GAC/B,IAAKE,GAAKC,KAAK7a,GAAQ,MAAM,IAAI9E,MAAJ,kBAAAkC,OAA4B4C,IAGzD,IAFA,IAAM8a,EAAuB,GACzB5e,EAAI,OACkBC,IAAnBuH,EAAQ,EAAIxH,IACjB4e,EAAWpZ,KACT8Y,GAAiBR,EAAD,GAAA5c,OAAOsG,EAAQ,EAAIxH,IAAnBkB,OAAwBsG,EAAQ,EAAIxH,EAAI,IAAM,UAC3D6D,MAEL7D,IAEF8d,EAAE7X,MAAM,CAAEnC,MAAK,IAAA5C,OAAM4C,GAASD,KAAMwM,GAAauO,KA5CjDC,CAAane,EAAGmQ,GAqEpB,SAA6BiN,EAAuB3d,GAClD,IAAI2e,EAAW,GACXC,EAAW,GACXre,EAAY,EACZnB,EAAY,EAJyDuL,EAKlC,CAAC3K,EAAEiJ,cAAejJ,EAAEmJ,eAApDF,EALkE0B,EAAA,GAKnDxB,EALmDwB,EAAA,GAMzEgT,EAAE/Y,YAAYM,QAAQ,SAAClB,GACjBA,EAAGoB,WAAapB,EAAG+C,UACvB4W,EAAE1Y,cAAcC,QAAQ,SAACzG,GACnBuF,EAAGvF,KAAOA,IAEU,IAApBkgB,EAASxe,SACXwe,EAAWE,GAAM,GAAA9d,OAAIkI,EAAc1I,IAAlBQ,OAAuBkI,EAAc1I,EAAI,KAC1DA,GAAK,GAEPod,EAAEhW,gBACA3D,EAAGN,KACHia,EAAE/Y,YAAYnG,GAAIiF,KAClBob,GAAYH,EAAS,IACrB,UACA,aACA,iBAEFA,EAAWA,EAASL,MAAM,GAEF,IAApBM,EAASze,SACXye,EAAWC,GAAM,GAAA9d,OAAIoI,EAAc/J,IAAlB2B,OAAuBoI,EAAc/J,EAAI,KAC1DA,GAAK,GAEPue,EAAEhW,gBACA3D,EAAGN,KACHia,EAAE/Y,YAAYnG,GAAIiF,KAClBob,GAAYF,EAAS,IACrB,iBACA,eACA,iBAEFA,EAAWA,EAASN,MAAM,QAzG5BS,CAAoBxe,EAAG,CAAE0I,gBAAeE,kBACxC,MAAOvK,GAEP,OADAogB,MAAMpgB,GACC,KAET,OAAO2B,EAGT,IAAMse,GAAS,SAACI,GAAD,OAAehC,GAAOQ,MAAMwB,GAAG/e,SAAS,GAAGgf,SAAS,EAAG,MAEhEC,GAAwB,IAAI9B,IAChCre,OAAOogB,QAAQ,CACbC,GAAK,EACLC,GAAK,EACLC,OAAKzf,KAGT,SAASgf,GAAY7a,GACnB,IAAMrE,EAASuf,GAAsB7Z,IAAIrB,GACzC,QAAenE,IAAXF,GAA8B,MAANqE,EAC1B,MAAM,IAAIpF,MAAJ,GAAAkC,OAAakD,EAAb,4BACR,OAAOrE,EAET,IAAM2e,GAAO,gBAwBb,SAASJ,GACPR,EACA3d,EACApB,GAEA,IAAM4gB,EAAmBvC,GAAOQ,MAAMzd,GACtC,GAAIwf,GAAY7B,EAAE/Y,YAAYzE,OAC5B,MAAM,IAAItB,MAAJ,GAAAkC,OACDye,EADC,MAAAze,OACYf,EADZ,8BAAAe,OAC0C4c,EAAE/Y,YAAYzE,OADxD,QAAAY,OACqEnC,IAE7E,OAAO+e,EAAE/Y,YAAY4a,GC3EhB,IAAMC,GAEX,SAAAA,EAAmBvX,GAAc,IAAArD,EAAAlE,KAAA3B,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAA8e,GAAA9e,KADzBuH,UACyB,EAAAvH,KAG1B+e,SAAW,WAChB,GAAK7a,EAAKqD,KAAKY,MAAM6W,UAArB,CACA,IAAMC,EAAoChC,GACxC/Y,EAAKqD,KAAKY,MAAM+W,QAChBhb,EAAKqD,KAAKY,MAAM6W,WAElB9a,EAAKqD,KAAKa,SAAS,CAAE4W,UAAW,KACjB,OAAXC,IAEJ/a,EAAKqD,KAAKa,SAAS,CAAE8W,QAASD,IAC9BvL,GAAS1L,KAAKiX,EAAOhb,aACrB8D,GAAgBC,KAAK,MACrBa,GAAeb,KAAK/E,MAdpBjD,KAAKuH,KAAOA,GCgCT,IAAM4X,GAtCb,SACEC,GAEA,IAAMC,EAAqC,GA8B3C,OASF,SACED,EACAC,EACAC,EACAC,GAEAH,EAAQhhB,OAAO9B,IAAI,SAACkjB,EAActgB,GAChC,IAAM6D,EAAOyc,EAAKC,QAAQ,OAAQ,IAAIA,QAAQ,KAAM,IACpDJ,EAAS3a,KAAK,CACZ3B,OACAqJ,SAAUgT,EAAQI,GAClB1hB,GAAIoB,EACJuF,UAAW6a,EAAmBxY,IAAI/D,EAAK2c,eACvCtZ,SAAUmZ,EAAOzY,IAAI/D,EAAK2c,eAC1BpX,cAAexJ,EAA2BsgB,EAAQ5f,OAAS,EAAGN,GAC9DsJ,cAAe1J,EAA2BsgB,EAAQ5f,OAAS,EAAGN,GAC9DqE,QAAS,GACTC,WAAY,GACZE,eAAgB,GAChBC,aAAc,OAzDlBgc,CAAcP,EAASC,EAAU,IAAIhb,IAAe,IAAIA,KAC1B,IAAIL,EAAmBqb,GAiCxBO,CAC7BC,OC/BK,IAAMC,GAAb,SAAA/U,GAGE,SAAA+U,EAAmBhY,GAAoB,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAA8f,IACrC5b,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAAyhB,GAAA5U,KAAAlL,KAAM8H,KAHAqD,gBAE+B,EAAAjH,EAS/B6b,aAAgB,SAACzE,GACvBpX,EAAKkE,SAAS,CAAE4W,UAAW1D,EAAM0E,OAAO7f,SACvCuP,KAFqBrR,OAAA+M,EAAA,EAAA/M,CAACA,OAAA+M,EAAA,EAAA/M,CAAA6F,KAPvBA,EAAKiH,WAAa,IAAI2T,GAAJzgB,OAAA+M,EAAA,EAAA/M,QAAA+M,EAAA,EAAA/M,CAAA6F,KAClBA,EAAKiE,MAAQ,CAAE6W,UAAW,GAAIE,QAASC,IAHFjb,EAHzC,OAAA7F,OAAAgN,EAAA,EAAAhN,CAAAyhB,EAAA/U,GAAA1M,OAAA4B,EAAA,EAAA5B,CAAAyhB,EAAA,EAAA5f,IAAA,oBAAAC,MAAA,WAUIuT,GAAS1L,KAAKhI,KAAKmI,MAAM+W,QAAQjb,eAVrC,CAAA/D,IAAA,SAAAC,MAAA,WAiBI,IAAM+L,EAAK7N,OAAA+K,EAAA,EAAA/K,CAAA,GAAQ,CAAE4hB,UAAW,IAAUjgB,KAAK8H,MAAMoE,OAAS,IAC9D,OACEH,EAAA1J,EAAA2J,cAACmB,GAAD,CAAKF,UAAU,kBAAkBf,MAAOA,GACtCH,EAAA1J,EAAA2J,cAACmE,GAAD,CAASlD,UAAU,cAAnB,cAEElB,EAAA1J,EAAA2J,cAAA,SACEiB,UAAU,QACV9M,MAAOH,KAAKmI,MAAM6W,UAClBkB,SAAUlgB,KAAK+f,eAEjBhU,EAAA1J,EAAA2J,cAAA,UACE5F,UAAapG,KAAKmI,MAAM6W,UACxB/R,UAAS,kBACThB,QAASjM,KAAKmL,WAAW4T,UAH3B,gBA3BVe,EAAA,CAA4BxT,IAAMC,2GCVlC,IAAM4T,GAAyBzW,YAAOyD,GAAPzD,CAAH0W,MAIfC,GAAb,SAAAtV,GAKI,SAAAsV,EAAmBvY,GAAY,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAqgB,IAC3Bnc,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAAgiB,GAAAnV,KAAAlL,KAAM8H,KAHFwY,mBAEuB,EAE3Bpc,EAAKiE,MAAQ,CAAE4F,QAAS,MAFG7J,EALnC,OAAA7F,OAAAgN,EAAA,EAAAhN,CAAAgiB,EAAAtV,GAAA1M,OAAA4B,EAAA,EAAA5B,CAAAgiB,EAAA,EAAAngB,IAAA,oBAAAC,MAAA,WAU+B,IAAAyE,EAAA5E,KACvBA,KAAKsgB,cAAgB3M,GAAmB/K,UAAU,SAACmF,GAC/CnJ,EAAKwD,SAAS,CAAE2F,gBAZ5B,CAAA7N,IAAA,qBAAAC,MAAA,SAgB8BogB,EAAkBC,GACpCA,EAAUzS,UAAY/N,KAAKmI,MAAM4F,SACjC0S,OAAOC,SAAS,EAAG,KAlB/B,CAAAxgB,IAAA,uBAAAC,MAAA,WAuBQH,KAAKsgB,cAActX,gBAvB3B,CAAA9I,IAAA,SAAAC,MAAA,WA2BQ,OAAO4L,EAAA1J,EAAA2J,cAACmU,GAAD,KAAyBngB,KAAKmI,MAAM4F,aA3BnDsS,EAAA,CAAqC/T,IAAMC,WCM9BoU,GAAb,SAAA5V,GACE,SAAA4V,EAAmB7Y,GAAsB,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAA2gB,IACvCzc,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAAsiB,GAAAzV,KAAAlL,KAAM8H,KACDK,MAAQ,CAAEyY,YAAY,GAC3B9Y,EAAMqD,WAAW0V,OAAjBxiB,OAAA+M,EAAA,EAAA/M,QAAA+M,EAAA,EAAA/M,CAAA6F,KAHuCA,EAD3C,OAAA7F,OAAAgN,EAAA,EAAAhN,CAAAsiB,EAAA5V,GAAA1M,OAAA4B,EAAA,EAAA5B,CAAAsiB,EAAA,EAAAzgB,IAAA,oBAAAC,MAAA,WAOIH,KAAK8H,MAAMqD,WAAWvC,cAP1B,CAAA1I,IAAA,uBAAAC,MAAA,WAUIH,KAAK8H,MAAMqD,WAAWnC,gBAV1B,CAAA9I,IAAA,SAAAC,MAAA,WAcI,IAAMygB,EAAa5gB,KAAKmI,MAAMyY,WACxBE,EAAmB,CAAE/E,QAAS6E,EAAa,OAAS,IACpDG,EAAeH,EACjB,CAAE3Q,OAAQ,QACV,CAAEA,OAAQ,OAAQC,SAAU,KAAM8Q,SAAU,UAChD,OACEjV,EAAA1J,EAAA2J,cAAA,OAAKE,MAAO6U,GACVhV,EAAA1J,EAAA2J,cAACiV,GAAD,MACAlV,EAAA1J,EAAA2J,cAACkV,GAAD,CAAQhV,MAAO4U,IACf/U,EAAA1J,EAAA2J,cAAA,OAAKiB,UAAU,WACblB,EAAA1J,EAAA2J,cAAA,OAAKiB,UAAU,SAASf,MAAO,CAAEiV,UAAW,WAC1CpV,EAAA1J,EAAA2J,cAACoV,GAAD,aAzBZT,EAAA,CAA8BrU,IAAMC,WCXvB8U,GAAb,oBAAAA,IAAAhjB,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAAqhB,GAAArhB,KACYuH,KAAiB,IAAIoZ,GAAS,CAAExV,WAAYnL,OADxDA,KAEYsZ,cAAgC,GAF5C,OAAAjb,OAAA4B,EAAA,EAAA5B,CAAAgjB,EAAA,EAAAnhB,IAAA,SAAAC,MAAA,SAGkBmhB,GACVthB,KAAKuH,KAAO+Z,IAJpB,CAAAphB,IAAA,YAAAC,MAAA,WAO6B,IAAA+D,EAAAlE,KACrBA,KAAKgJ,cACLhJ,KAAKsZ,cAAc5U,KACfyP,GAAcvL,UAAU,SAACgY,GACrB1c,EAAKqD,KAAKa,SAAS,CAAEwY,oBAXrC,CAAA1gB,IAAA,cAAAC,MAAA,WAiBQH,KAAKsZ,cAAc/U,QAAQ,SAAAwE,GAAG,OAAIA,EAAIC,oBAjB9CqY,EAAA,GCsCaE,GAAwB,CACjCxe,KAAM,OACN8L,GAAI,UACJb,KAAM,UACNjB,SAAU,UACVyU,aAAc,UACdC,SAAU,oCACVC,KAAM,YACN/G,KAAM,UACNhO,QAAS,UACTqL,YAAa,UACbN,SAAU,UACVG,cAAe,UACfS,aAAc,YACdG,YAAa,UACbN,WAAY,UACZS,QAAS,UACT1O,eAAgB,UAChBoN,gBAAiB,qSCzDd,IAAMqK,GAAeC,YAAHC,KAWP,SAAA7X,GAAA,OAAAA,EAAGC,MAAyC4E,IACjD,SAAAnC,GAAA,OAAAA,EAAGzC,MAAyC+D,OCyB1C8T,eA7Bb,SAAAA,EAAmBha,GAAY,IAAA5D,EAAA,OAAA7F,OAAA0B,EAAA,EAAA1B,CAAA2B,KAAA8hB,IAC7B5d,EAAA7F,OAAA2M,EAAA,EAAA3M,CAAA2B,KAAA3B,OAAA4M,EAAA,EAAA5M,CAAAyjB,GAAA5W,KAAAlL,KAAM8H,KAFAiB,IAA2B,KAGjC7E,EAAKiE,MAAQ,CACX8B,MAAOsX,IAHoBrd,mFAOJ,IAAAU,EAAA5E,KACzBA,KAAK+I,IAAMqL,GAAOxL,UAAU,SAACqB,GAC3BrF,EAAKwD,SAAS,CAAE6B,2DAKdjK,KAAK+I,KAAK/I,KAAK+I,IAAIC,+CAIvB,OACE+C,EAAA1J,EAAA2J,cAAC+V,EAAA,EAAD,CAAe9X,MAAOjK,KAAKmI,MAAM8B,OAC/B8B,EAAA1J,EAAA2J,cAAAD,EAAA1J,EAAA2f,SAAA,KACEjW,EAAA1J,EAAA2J,cAAC2V,GAAD,MACA5V,EAAA1J,EAAA2J,cAACiW,GAAD,CAAU9W,WAAY,IAAIkW,cAxBlB/U,IAAMC,WCGJ2V,QACW,cAA7BzB,OAAO0B,SAASC,UAEe,UAA7B3B,OAAO0B,SAASC,UAEhB3B,OAAO0B,SAASC,SAASC,MACvB,2DCbNC,IAASrH,OAAOlP,EAAA1J,EAAA2J,cAACuW,GAAD,MAAS7G,SAAS8G,eAAe,SDgH3C,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMC,KAAK,SAAAC,GACjCA,EAAaC","file":"static/js/main.df5e7227.chunk.js","sourcesContent":["var map = {\n\t\"./Archbishop Geofri.png\": 51,\n\t\"./Atziri.png\": 52,\n\t\"./Avarius.png\": 53,\n\t\"./Baran.png\": 54,\n\t\"./Brutus.png\": 55,\n\t\"./Doedre.png\": 56,\n\t\"./Dominus.png\": 57,\n\t\"./Eleron.png\": 58,\n\t\"./Hillock.png\": 59,\n\t\"./Izaro.png\": 60,\n\t\"./Kitava.png\": 61,\n\t\"./Kuduku.png\": 62,\n\t\"./Lunaris.png\": 63,\n\t\"./Malachai.png\": 64,\n\t\"./Piety.png\": 65,\n\t\"./Rhys.png\": 66,\n\t\"./Shavronne.png\": 67,\n\t\"./Solaris.png\": 68,\n\t\"./The Elder.png\": 69,\n\t\"./The Shaper.png\": 70,\n\t\"./Veritania.png\": 71\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 50;","module.exports = __webpack_public_path__ + \"static/media/Archbishop Geofri.6e0351ba.png\";","module.exports = __webpack_public_path__ + \"static/media/Atziri.e1aff68e.png\";","module.exports = __webpack_public_path__ + \"static/media/Avarius.bb0beb40.png\";","module.exports = __webpack_public_path__ + \"static/media/Baran.c2cc7940.png\";","module.exports = __webpack_public_path__ + \"static/media/Brutus.b2bc13c6.png\";","module.exports = __webpack_public_path__ + \"static/media/Doedre.57e7d4e8.png\";","module.exports = __webpack_public_path__ + \"static/media/Dominus.fabc0820.png\";","module.exports = __webpack_public_path__ + \"static/media/Eleron.a938a8e5.png\";","module.exports = __webpack_public_path__ + \"static/media/Hillock.4f59f957.png\";","module.exports = __webpack_public_path__ + \"static/media/Izaro.eb3f6068.png\";","module.exports = __webpack_public_path__ + \"static/media/Kitava.cb87a5dd.png\";","module.exports = __webpack_public_path__ + \"static/media/Kuduku.8c3ddd80.png\";","module.exports = __webpack_public_path__ + \"static/media/Lunaris.85e8ae6c.png\";","module.exports = __webpack_public_path__ + \"static/media/Malachai.4b573964.png\";","module.exports = __webpack_public_path__ + \"static/media/Piety.a55b7f84.png\";","module.exports = __webpack_public_path__ + \"static/media/Rhys.dce28a7e.png\";","module.exports = __webpack_public_path__ + \"static/media/Shavronne.bef48886.png\";","module.exports = __webpack_public_path__ + \"static/media/Solaris.e8e6af49.png\";","module.exports = __webpack_public_path__ + \"static/media/The Elder.ea02a95d.png\";","module.exports = __webpack_public_path__ + \"static/media/The Shaper.cda64217.png\";","module.exports = __webpack_public_path__ + \"static/media/Veritania.3cbf82c9.png\";","export function hashcode(string: string): number {\n    let hash = 0,\n        i,\n        chr;\n    if (string.length === 0) return hash;\n    for (i = 0; i < string.length; i++) {\n        chr = string.charCodeAt(i);\n        hash = (hash << 5) - hash + chr;\n        hash |= 0;\n    }\n    return hash;\n}\n\nexport function roundTwoDigits(number: number | undefined) {\n    if (!number) {\n        return 0;\n    }\n    return Math.round(number * 100);\n}\n\nexport function max(a: number, b: number) {\n    return a > b ? a : b;\n}\n\nexport function extremeValues(x: number | undefined): number {\n    if (!x) {\n        return 0;\n    }\n    const xSquared = x * x;\n    if (x >= 0) {\n        return -xSquared + 2 * x;\n    } else {\n        return xSquared + 2 * x;\n    }\n}\n","export interface RelationshipMap {\n  [id: number]: number;\n}\n\nexport interface DiscreteRelationshipMap {\n  [id: number]: boolean | undefined;\n}\n\nexport function newRelationshipMap(\n  size: number,\n  exclude: number\n): RelationshipMap {\n  const result: RelationshipMap = {};\n  for (let i = 0; i < size; i++) {\n    if (i !== exclude) result[i] = 0;\n  }\n  return result;\n}\n\nexport function newDiscreteRelationshipMap(\n  size: number,\n  exclude: number\n): DiscreteRelationshipMap {\n  const result: DiscreteRelationshipMap = {};\n  for (let i = 0; i < size; i++) {\n    if (i !== exclude) result[i] = undefined;\n  }\n  return result;\n}\n","function componentToHex(c: any) {\n  var hex = Math.round(c).toString(16);\n  return hex.length == 1 ? \"0\" + hex : hex;\n}\n\nexport class Rgb {\n  public r: number;\n  public g: number;\n  public b: number;\n  public toHex() {\n    return (\n      \"#\" +\n      componentToHex(this.r) +\n      componentToHex(this.g) +\n      componentToHex(this.b)\n    );\n  }\n  public toRgba(): string {\n    return `rgba(${this.r}, ${this.g}, ${this.b}, 1)`;\n  }\n  constructor(r: number, g: number, b: number) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n  }\n}\nfunction hexToRgb(hex: string) {\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result\n    ? {\n        r: parseInt(result[1], 16),\n        g: parseInt(result[2], 16),\n        b: parseInt(result[3], 16),\n      }\n    : null;\n}\n\nexport function textColor(bg: string) {\n  var color = bg.charAt(0) === \"#\" ? bg.substring(1, 7) : bg;\n  var r = parseInt(color.substring(0, 2), 16); // hexToR\n  var g = parseInt(color.substring(2, 4), 16); // hexToG\n  var b = parseInt(color.substring(4, 6), 16); // hexToB\n  var uicolors = [r / 255, g / 255, b / 255];\n  var c = uicolors.map((col) => {\n    if (col <= 0.03928) {\n      return col / 12.92;\n    }\n    return Math.pow((col + 0.055) / 1.055, 2.4);\n  });\n  var L = 0.2126 * c[0] + 0.7152 * c[1] + 0.0722 * c[2];\n  return L > 0.179 ? \"#000000\" : \"#ffffff\";\n}\n\nexport function interpolateColor(min: Rgb, max: Rgb, percent: number): string {\n  return new Rgb(\n    min.r + percent * (max.r - min.r),\n    min.g + percent * (max.g - min.g),\n    min.b + percent * (max.b - min.b)\n  ).toHex();\n}\n","export enum RelationshipType {\n  Neutral = \"NEUTRAL\",\n  Friend = \"FRIEND\",\n  Enemy = \"ENEMY\",\n  Pawn = \"PAWN\",\n  Queen = \"QUEEN\",\n  Hunter = \"HUNTER\",\n  Target = \"TARGET\",\n  Dupe = \"DUPE\",\n  Deceiver = \"DECEIVER\",\n}\n\nexport enum ThreatLevel {\n  Threat = \"THREAT\",\n  Weak = \"WEAK\",\n  Neutral = \"NEUTRAL\",\n}\n\nexport const RelationshipTypeToSymbol = {\n  NEUTRAL: \"-\",\n  FRIEND: \"♥\",\n  ENEMY: \"💔\",\n  PAWN: \"THEY ♥ ME\",\n  QUEEN: \"I ♥ THEM\",\n  HUNTER: \"THEY 💔 ME\",\n  TARGET: \"I 💔 THEM\",\n  DUPE: \"I 💔 THEM THEY ♥ ME\",\n  DECEIVER: \"I ♥ THEM THEY 💔 ME\",\n};\n\nexport const ThreatLevelToSymbol = {\n  THREAT: \"💢\",\n  WEAK: \"💤\",\n  NEUTRAL: \"-\",\n};\n\nexport const RelationshipTypeToPopularity = {\n  NEUTRAL: 0,\n  FRIEND: 1,\n  ENEMY: -1,\n  PAWN: 0.66,\n  QUEEN: 0.33,\n  HUNTER: -0.66,\n  TARGET: -0.33,\n  DUPE: 0.25,\n  DECEIVER: -0.25,\n};\n\nexport const ClassifyDiscreteRelationship: {\n  [id: string]: { [id: string]: RelationshipType };\n} = {\n  true: {\n    true: RelationshipType.Friend,\n    false: RelationshipType.Dupe,\n    undefined: RelationshipType.Pawn,\n  },\n  false: {\n    true: RelationshipType.Deceiver,\n    false: RelationshipType.Enemy,\n    undefined: RelationshipType.Hunter,\n  },\n  undefined: {\n    true: RelationshipType.Queen,\n    false: RelationshipType.Target,\n    undefined: RelationshipType.Neutral,\n  },\n};\n\nfunction f(a: boolean | undefined): \"true\" | \"false\" | \"undefined\" {\n  if (a === true) return \"true\";\n  else if (a === false) return \"false\";\n  else return \"undefined\";\n}\n\nexport function classifyRelationship(\n  heroPopularity: number,\n  villainPopularity: number,\n  heroRelationship: number | boolean | undefined,\n  villainRelationship: number | boolean | undefined\n): RelationshipType {\n  if (\n    typeof heroRelationship !== \"number\" &&\n    typeof villainRelationship !== \"number\"\n  ) {\n    return ClassifyDiscreteRelationship[f(heroRelationship)][\n      f(villainRelationship)\n    ];\n  }\n\n  const benefitsHero = heroRelationship! > heroPopularity;\n  const benefitsVillain = heroRelationship! > villainPopularity;\n  if (benefitsHero && benefitsVillain) {\n    return RelationshipType.Friend;\n  } else if (benefitsHero && !benefitsVillain) {\n    return RelationshipType.Pawn;\n  } else if (!benefitsHero && benefitsVillain) {\n    return RelationshipType.Queen;\n  }\n  return RelationshipType.Enemy;\n}\n","export interface Tribe {\n  name: string;\n  color: string;\n  size: number;\n}\n\nexport function tribeId(t: Tribe | undefined): string {\n  if (t === undefined) return \"\";\n  return `${t.name}${t.color}`;\n}\n\nexport const nullTribe: Tribe = { name: \"\", color: \"\", size: 0 };\n","export interface Likemap {\n  [id: number]: {\n    tribeId: string;\n    groups: Set<number>;\n  };\n}\n\nexport function sizeOf(l: Likemap) {\n  return Object.keys(l).length;\n}\n","import { ProfileHouseguest } from \"../components/memoryWall\";\nimport { Tribe, tribeId } from \"./tribe\";\nimport { PlayerProfile } from \"../model\";\nimport { DiscreteRelationshipMap } from \"../utils\";\nimport { Likemap, sizeOf } from \"../utils/likeMap\";\n\ntype Map = \"relationships\" | \"powerRankings\";\ntype LikeKey = \"likedBy\" | \"thinksImThreat\";\ntype DislikeKey = \"dislikedBy\" | \"thinksImWeak\";\n\nfunction calcPowerRank(threats: number, weaks: number, n: number) {\n  if (n === 0) return 0;\n  const twoN = 2 * n;\n  return 0.5 + threats / twoN - weaks / twoN;\n}\n\nexport function calculatePopularity(\n  hg: { likedBy: Likemap; dislikedBy: Likemap },\n  n: number\n): number | undefined {\n  if (n < 1) return undefined;\n  const likedBy = sizeOf(hg.likedBy);\n  const dislikedBy = sizeOf(hg.dislikedBy);\n  let result: number | undefined = 0;\n  result = (likedBy - dislikedBy) / n;\n  likedBy === 0 && dislikedBy === 0 && (result = undefined);\n  return result;\n}\n\nexport function calculatePowerRanking(\n  hg: { thinksImThreat: Likemap; thinksImWeak: Likemap },\n  n: number\n): number | undefined {\n  if (n < 1) return undefined;\n  const thinksImThreat = sizeOf(hg.thinksImThreat);\n  const thinksImWeak = sizeOf(hg.thinksImWeak);\n  let result: number | undefined = 0;\n  result = calcPowerRank(thinksImThreat, thinksImWeak, n);\n  thinksImThreat === 0 && thinksImWeak === 0 && (result = undefined);\n  return result;\n}\n\nexport interface RelationshipHouseguest extends PlayerProfile {\n  id: number;\n  isEvicted?: boolean;\n  disabled?: boolean;\n  tribe?: Tribe;\n  //\n  relationships: DiscreteRelationshipMap;\n  popularity?: number;\n  likedBy: Likemap;\n  dislikedBy: Likemap;\n  //\n  powerRankings: DiscreteRelationshipMap;\n  powerRanking?: number;\n  thinksImWeak: Likemap;\n  thinksImThreat: Likemap;\n  //\n  tooltip?: string;\n}\nexport class RelationshipMapper {\n  public houseguests: RelationshipHouseguest[] = [];\n  private cache: {\n    [id: string]: RelationshipHouseguest;\n  } = {};\n  private tribeIDs: Set<string> = new Set<string>();\n  get nonEvictedHouseguests(): number {\n    return this.nonEvictedIDs.length;\n  }\n  nonEvictedIDs: number[] = []; // this must be an ordered type to guarentee encoding/decoding works. don't use a set\n  public constructor(houseguests: RelationshipHouseguest[]) {\n    this.houseguests = houseguests;\n    if (houseguests.length > 4096) {\n      throw new Error(\"The max number of players is 4096.\");\n    }\n    houseguests.forEach((hg) => {\n      this.cache[hg.name.toUpperCase()] = hg;\n      !hg.isEvicted && this.nonEvictedIDs.push(hg.id);\n    });\n  }\n\n  public getById(id: number): RelationshipHouseguest {\n    if (this.houseguests[id] === undefined) throw Error(\"invalid id\");\n    return this.houseguests[id];\n  }\n\n  public reset() {\n    this.dropYourBuffs();\n    this.houseguests.forEach((hg) => {\n      this.evict(hg.name);\n      this.unevict(hg.name);\n    });\n  }\n\n  private get(hero: string) {\n    return this.cache[hero.toUpperCase()];\n  }\n  private getRelationship(h: string, v: string, map: Map) {\n    return this.get(h)[map][this.get(v).id];\n  }\n\n  public dropYourBuffs() {\n    this.tribeIDs = new Set<string>();\n    this.houseguests.forEach((hg) => {\n      hg.tribe = undefined;\n    });\n  }\n\n  private updatePopularities(hg: ProfileHouseguest, n: number) {\n    hg.popularity = calculatePopularity(hg, n);\n    hg.powerRanking = calculatePowerRanking(hg, n);\n  }\n\n  public evict(h: string) {\n    const hero = this.get(h);\n    const myTribeId = tribeId(hero.tribe);\n    const toDelete = this.nonEvictedIDs.indexOf(hero.id);\n    if (hero.isEvicted) return;\n    hero.isEvicted = true;\n    this.nonEvictedIDs.forEach((id) => {\n      this.neutral(h, this.houseguests[id].name);\n      this.neutral(this.houseguests[id].name, h);\n      this.utr(h, this.houseguests[id].name);\n      this.utr(this.houseguests[id].name, h);\n      const tribe = this.houseguests[id].tribe;\n      tribe && tribeId(tribe) === myTribeId && tribe.size--;\n    });\n    this.nonEvictedIDs.splice(toDelete, 1);\n  }\n\n  public unevict(h: string) {\n    const hero = this.get(h);\n    if (!hero.isEvicted) return;\n    hero.isEvicted = false;\n    this.nonEvictedIDs.push(hero.id);\n  }\n\n  private addToLikeMap(l: Likemap, h: RelationshipHouseguest) {\n    l[h.id] = { tribeId: tribeId(h.tribe), groups: new Set<number>() };\n  }\n\n  private deleteFromLikeMap(l: Likemap, h: RelationshipHouseguest) {\n    delete l[h.id];\n  }\n\n  public setRelationship(\n    h: string,\n    v: string,\n    newR: boolean | undefined,\n    likeKey: LikeKey,\n    dislikeKey: DislikeKey,\n    map: Map\n  ) {\n    const hToV = this.getRelationship(h, v, map);\n    const hero = this.get(h);\n    const villain = this.get(v);\n    if (\n      hToV === newR ||\n      ((hero.isEvicted ||\n        hero.disabled ||\n        villain.disabled ||\n        villain.isEvicted) &&\n        newR !== undefined)\n    ) {\n      return;\n    }\n    if (hToV === undefined) {\n      this.addToLikeMap(villain[newR ? likeKey : dislikeKey], hero);\n    } else if (newR === undefined) {\n      this.deleteFromLikeMap(villain[hToV ? likeKey : dislikeKey], hero);\n    } else {\n      this.addToLikeMap(villain[newR ? likeKey : dislikeKey], hero);\n      this.deleteFromLikeMap(villain[newR ? dislikeKey : likeKey], hero);\n    }\n    // actually set it\n    hero[map][villain.id] = newR;\n    this.updatePopularities(villain, this.nonEvictedHouseguests - 1);\n  }\n  public tribe(skeleton: { name: string; color: string }, members: string[]) {\n    const tribe = {\n      size: members.filter((hg) => !this.get(hg).isEvicted).length, // only count non-evicted members\n      name: skeleton.name,\n      color: skeleton.color,\n    };\n    if (tribe.name.includes(\"#\") || tribe.name.includes(\"=\")) {\n      throw new Error(\"Tribe names cannot contain # or =\");\n    }\n    if (this.tribeIDs.has(tribeId(tribe))) {\n      throw new Error(`Tribe ${tribeId(tribe)} declared twice`);\n    }\n    this.tribeIDs.add(tribeId(tribe));\n    members.forEach((hg) => {\n      this.get(hg).tribe = tribe;\n    });\n  }\n  public like(hero: string, villain: string) {\n    this.setRelationship(\n      hero,\n      villain,\n      true,\n      \"likedBy\",\n      \"dislikedBy\",\n      \"relationships\"\n    );\n  }\n  public dislike(hero: string, villain: string) {\n    this.setRelationship(\n      hero,\n      villain,\n      false,\n      \"likedBy\",\n      \"dislikedBy\",\n      \"relationships\"\n    );\n  }\n  public neutral(hero: string, villain: string) {\n    this.setRelationship(\n      hero,\n      villain,\n      undefined,\n      \"likedBy\",\n      \"dislikedBy\",\n      \"relationships\"\n    );\n  }\n  public friends(hero: string, villain: string) {\n    this.like(hero, villain);\n    this.like(villain, hero);\n  }\n  public threat(h: string, v: string) {\n    this.setRelationship(\n      h,\n      v,\n      true,\n      \"thinksImThreat\",\n      \"thinksImWeak\",\n      \"powerRankings\"\n    );\n  }\n  public weak(h: string, v: string) {\n    this.setRelationship(\n      h,\n      v,\n      false,\n      \"thinksImThreat\",\n      \"thinksImWeak\",\n      \"powerRankings\"\n    );\n  }\n  public utr(h: string, v: string) {\n    this.setRelationship(\n      h,\n      v,\n      undefined,\n      \"thinksImThreat\",\n      \"thinksImWeak\",\n      \"powerRankings\"\n    );\n  }\n  public alliance(members: string[]) {\n    for (let i = 0; i < members.length; i++) {\n      for (let j = i + 1; j < members.length; j++) {\n        this.friends(members[i], members[j]);\n      }\n    }\n  }\n  public enemies(hero: string, villain: string) {\n    this.dislike(hero, villain);\n    this.dislike(villain, hero);\n  }\n}\n","import {\n  PortraitProps,\n  HouseguestPortrait,\n  PortraitState,\n} from \"../memoryWall\";\nimport { Subscription } from \"rxjs\";\nimport {\n  selectedPlayer$,\n  displayMode$,\n  getSelectedPlayer,\n  selectedTribe$,\n} from \"../../subjects/subjects\";\nimport { SelectedPlayerData } from \"./selectedPortrait\";\nimport { Rgb } from \"../../model/color\";\nimport { isNullOrUndefined } from \"util\";\nimport {\n  classifyRelationship,\n  RelationshipTypeToPopularity,\n} from \"../../utils/ai/classifyRelationship\";\nimport { tribeId, Tribe } from \"../../images/tribe\";\nimport _ from \"lodash\";\nimport {\n  calculatePopularity,\n  calculatePowerRanking,\n} from \"../../images/RelationshipMapper\";\n\nconst selectedColor = new Rgb(51, 255, 249);\n\nexport class HouseguestPortraitController {\n  private subs: Subscription[] = [];\n  private view: HouseguestPortrait;\n  constructor(view: HouseguestPortrait) {\n    this.view = view;\n  }\n  get defaultState(): PortraitState {\n    return {\n      popularity: this.view.props.popularity,\n      displayMode: displayMode$.value,\n      powerRanking: this.view.props.powerRanking,\n      disabled: !!this.view.props.disabled,\n      likedBy: this.view.props.likedBy,\n      dislikedBy: this.view.props.dislikedBy,\n      thinksImThreat: this.view.props.thinksImThreat,\n      thinksImWeak: this.view.props.thinksImWeak,\n    };\n  }\n  public backgroundColor(\n    props: PortraitProps,\n    state: PortraitState\n  ): undefined | string {\n    const selectedPlayer = getSelectedPlayer();\n    if (state.disabled) return undefined;\n    if (selectedPlayer !== null && selectedPlayer.id === props.id) {\n      return selectedColor.toHex();\n    }\n    return props.isEvicted || state.disabled\n      ? undefined\n      : this.view.state.displayMode.backgroundColor(this.view.state);\n  }\n\n  public subscribe() {\n    const subs: Subscription[] = [];\n    subs.push(\n      selectedPlayer$.subscribe({\n        next: this.refreshData,\n      })\n    );\n    subs.push(\n      selectedTribe$.subscribe({\n        next: this.refreshTribeFilter,\n      })\n    );\n    subs.push(\n      displayMode$.subscribe({\n        next: (displayMode) => this.view.setState({ displayMode }),\n      })\n    );\n    this.subs = subs;\n  }\n\n  public unsubscribe() {\n    this.subs.forEach((sub) => sub.unsubscribe());\n  }\n\n  private refreshTribeFilter = (selectedTribe: Tribe) => {\n    // un-disable all\n    if (!selectedTribe.name) {\n      this.refreshData(getSelectedPlayer());\n      return;\n    }\n    // o/w, disable if nessecary\n    const selectedPlayer = getSelectedPlayer();\n    this.updateLikeCounts(selectedTribe);\n    if (\n      tribeId(selectedTribe) !== tribeId(this.view.props.tribe) &&\n      selectedPlayer !== null &&\n      selectedPlayer.id === this.view.props.id\n    ) {\n      selectedPlayer$.next(null);\n    }\n  };\n\n  // this effectively restricts likeCounts to [people on the same tribe as me]\n  // this function can later be repurposed into accepting a more generic filter, such as a group in general\n  private updateLikeCounts(selectedTribe: Tribe) {\n    const props = this.view.props;\n    const newState: any = {\n      disabled: tribeId(selectedTribe) !== tribeId(props.tribe),\n    };\n    const f = hasSameTribe(tribeId(props.tribe));\n    newState.likedBy = _.filter(props.likedBy, f);\n    newState.dislikedBy = _.filter(props.dislikedBy, f);\n    newState.thinksImThreat = _.filter(props.thinksImThreat, f);\n    newState.thinksImWeak = _.filter(props.thinksImWeak, f);\n    if (!getSelectedPlayer()) {\n      const n = props.tribe ? props.tribe.size : 0;\n      newState.popularity = calculatePopularity({ ...newState }, n);\n      newState.powerRanking = calculatePowerRanking({ ...newState }, n);\n    }\n    this.view.setState(newState);\n  }\n\n  private goToDefaultState() {\n    if (this.view.state.disabled) return;\n    if (tribeId(selectedTribe$.value)) {\n      this.updateLikeCounts(selectedTribe$.value);\n    } else {\n      this.view.setState(this.defaultState);\n    }\n  }\n\n  private refreshData = (data: SelectedPlayerData | null) => {\n    if (this.view.state.disabled) return;\n    if (!data) {\n      this.goToDefaultState();\n    } else {\n      if (data.id !== this.view.props.id) {\n        this.view.setState({\n          popularity: getPopularity(\n            this.view.props.relationships![data.id],\n            data.relationships[this.view.props.id!]\n          ),\n          powerRanking: getPowerRanking(\n            this.view.props.powerRankings![data.id],\n            data.powerRankings[this.view.props.id!]\n          ),\n        });\n      } else {\n        // note; popularity = 2 means the player is currently selected.\n        this.view.setState({\n          popularity: 2,\n          powerRanking: 2,\n        });\n      }\n    }\n  };\n}\ntype Rship = number | boolean | undefined;\n\nfunction getPowerRanking(hero: Rship, villain: Rship): number | undefined {\n  if (typeof hero === \"number\") {\n    return hero;\n  } else if (typeof villain === \"number\") {\n    return villain;\n  }\n  if (hero === true) return 1;\n  if (hero === false) return 0;\n  return undefined;\n}\n\nfunction getPopularity(hero: Rship, villain: Rship): number | undefined {\n  if (isNullOrUndefined(hero) && isNullOrUndefined(villain)) return undefined;\n\n  if (typeof hero === \"number\") {\n    return hero;\n  } else if (typeof villain === \"number\") {\n    return villain;\n  }\n\n  const relationshipType = classifyRelationship(0, 0, hero, villain);\n  return RelationshipTypeToPopularity[relationshipType];\n}\n\ninterface Like {\n  tribeId: string;\n  groups: Set<number>;\n}\n\nconst hasSameTribe = (tribe: string): ((l: Like) => boolean) => {\n  return (x: { tribeId: string; groups: Set<number> }): boolean => {\n    return tribe === x.tribeId;\n  };\n};\n","import React from \"react\";\nimport { selectPlayer } from \"./selectedPortrait\";\nimport { isNullOrUndefined } from \"util\";\nimport { RelationshipMap, DiscreteRelationshipMap } from \"../../utils\";\nimport _ from \"lodash\";\nimport { HouseguestPortraitController } from \"./houseguestPortraitController\";\nimport { PortraitDisplayMode } from \"../../model/portraitDisplayMode\";\nimport styled from \"styled-components\";\nimport { ColorTheme } from \"../../theme/theme\";\nimport { Tribe } from \"../../images/tribe\";\nimport { displayMode$ } from \"../../subjects/subjects\";\nimport { Likemap } from \"../../utils/likeMap\";\n\nconst Subtitle = styled.small`\n  font-weight: 100;\n  font-size: small;\n`;\n\nconst MemoryWallPortrait = styled.div`\n  margin: 5px;\n  border: 1px solid\n    ${({ theme }: { theme: ColorTheme }) => theme.portraitBorder};\n  color: black;\n  border-radius: 5px;\n  text-align: center;\n  font-weight: 600;\n  max-width: 7rem;\n  word-wrap: break-word;\n  -webkit-transition-property: none;\n  -moz-transition-property: none;\n  -o-transition-property: none;\n  transition-property: none;\n`;\n\nconst Evicted = styled(MemoryWallPortrait)`\n  font-weight: 100;\n  color: grey;\n  background-color: #111111;\n`;\n\nconst Jury = styled(MemoryWallPortrait)`\n  font-weight: 100;\n  color: #c3ae88;\n  background-color: #5d5340;\n  filter: brightness(0.6);\n`;\n\nconst Normal = styled.img`\n  min-width: 100px;\n  width: 100%;\n  width: -moz-available; /* For Mozzila */\n  width: -webkit-fill-available; /* For Chrome */\n  width: stretch; /* Unprefixed */\n`;\n\nconst Grayscale = styled(Normal)`\n  filter: grayscale(100%);\n`;\n\nconst Sepia = styled(Normal)`\n  filter: sepia(100%);\n`;\n\nexport interface PortraitProps {\n  imageURL: string;\n  name: string;\n  id?: number;\n  relationships?: RelationshipMap | DiscreteRelationshipMap;\n  popularity?: number;\n  powerRankings: DiscreteRelationshipMap;\n  powerRanking?: number;\n  isEvicted?: boolean;\n  disabled?: boolean;\n  deltaPopularity?: number;\n  detailed?: boolean;\n  superiors?: Set<number>;\n  //\n  likedBy: Likemap;\n  dislikedBy: Likemap;\n  thinksImWeak: Likemap;\n  thinksImThreat: Likemap;\n  tribe?: Tribe;\n}\n\nexport interface PortraitState {\n  popularity?: number;\n  powerRanking?: number;\n  displayMode: PortraitDisplayMode;\n  disabled: boolean;\n  likedBy: Likemap;\n  dislikedBy: Likemap;\n  thinksImWeak: Likemap;\n  thinksImThreat: Likemap;\n}\nexport class HouseguestPortrait extends React.Component<\n  PortraitProps,\n  PortraitState\n> {\n  private controller: HouseguestPortraitController;\n\n  public constructor(props: PortraitProps) {\n    super(props);\n    this.controller = new HouseguestPortraitController(this);\n    this.state = this.controller.defaultState;\n  }\n\n  public componentDidMount() {\n    if (isNullOrUndefined(this.props.id)) {\n      return;\n    }\n    this.controller.subscribe();\n  }\n\n  public componentWillUnmount() {\n    this.controller.unsubscribe();\n  }\n\n  private onClick(): void {\n    if (\n      isNullOrUndefined(this.props.id) ||\n      !this.props.relationships ||\n      this.state.disabled ||\n      this.props.isEvicted\n    ) {\n      return;\n    }\n    const data = {\n      id: this.props.id,\n      relationships: this.props.relationships,\n      isEvicted: !!this.props.isEvicted,\n      popularity: this.props.popularity || 0,\n      superiors: this.props.superiors,\n      powerRankings: this.props.powerRankings,\n    };\n    selectPlayer(data);\n  }\n\n  public render() {\n    const props = this.props;\n    const state = this.state;\n    const Img = getImageClass(props, state);\n    let subtitle: any[] = [];\n    subtitle = this.state.displayMode.generateSubtitle(\n      props,\n      state,\n      !!props.detailed\n    );\n\n    let Portrait = MemoryWallPortrait;\n    if (state.disabled) {\n      Portrait = Jury;\n    } else if (props.isEvicted) {\n      Portrait = Evicted;\n    }\n    return (\n      <Portrait\n        onClick={() => this.onClick()}\n        style={{\n          backgroundColor: this.controller.backgroundColor(props, this.state),\n        }}\n      >\n        <Img src={props.imageURL} style={{ height: 100 }} />\n        <br />\n        {props.name}\n        <br />\n        <Subtitle>{subtitle}</Subtitle>\n      </Portrait>\n    );\n  }\n}\n\nfunction getImageClass(props: PortraitProps, state: PortraitState) {\n  let imageClass = props.isEvicted ? Grayscale : Normal;\n  imageClass = state.disabled ? Sepia : imageClass;\n  return imageClass;\n}\n","import { RelationshipMap, DiscreteRelationshipMap } from \"../../utils\";\nimport { getSelectedPlayer, selectedPlayer$ } from \"../../subjects/subjects\";\n\nexport interface SelectedPlayerData {\n  id: number;\n  popularity: number;\n  relationships: RelationshipMap | DiscreteRelationshipMap;\n  powerRankings: DiscreteRelationshipMap;\n  isEvicted: boolean;\n  superiors?: Set<number>;\n}\n\nexport function selectPlayer(player: SelectedPlayerData | null) {\n  if (\n    !player ||\n    (getSelectedPlayer() && getSelectedPlayer()!.id === player.id)\n  ) {\n    selectedPlayer$.next(null);\n  } else {\n    selectedPlayer$.next(player);\n  }\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ColorTheme } from \"../../theme/theme\";\n\nconst ShadowBox = styled.div`\n  box-shadow: ${({ theme }: { theme: ColorTheme }) =>\n    theme.name === \"light\"\n      ? \"0 2px 3px rgba(10, 10, 10, 0.1), 0 0 0 1px rgba(10, 10, 10, 0.1)\"\n      : \"\"};\n  border-radius: 6px;\n  margin-left: 3px;\n  margin-right: 3px;\n  margin-bottom: 5px;\n  padding-bottom: 10px;\n  padding-top: 1px;\n  background: ${({ theme }: { theme: ColorTheme }) => theme.overlay};\n`;\n\nconst StyledBox = styled.div`\n  margin-left: 3px;\n  margin-right: 3px;\n  margin-bottom: 3px;\n  background: ${({ theme }: { theme: ColorTheme }) => theme.bodyArea};\n`;\n\nexport function DividerBox(props: any): JSX.Element {\n  return (\n    <ShadowBox className={props.className || \"\"} style={props.style || {}}>\n      {props.children}\n    </ShadowBox>\n  );\n}\n\nexport function Box(props: any): JSX.Element {\n  return (\n    <StyledBox style={props.style} className={`box ${props.className || \"\"}`}>\n      {props.children}\n    </StyledBox>\n  );\n}\n","import { ProfileHouseguest, HouseguestPortrait } from \"../memoryWall\";\nimport React from \"react\";\n\nexport function houseguestToPortrait(houseguest: ProfileHouseguest, key?: any): JSX.Element {\n    return <HouseguestPortrait {...houseguest} key={key} detailed={false} />;\n}\n\nexport function memoryWallPortrait(houseguest: ProfileHouseguest, key?: any): JSX.Element {\n    return <HouseguestPortrait {...houseguest} key={key} detailed={true} />;\n}\n","import React from \"react\";\nimport Popover from \"react-tiny-popover\";\nimport styled from \"styled-components\";\n\nconst Text = styled.p`\n    max-width: 200px;\n    padding: 3px 8px;\n    color: #fff;\n    text-align: center;\n    background-color: #000;\n    border-radius: 4px;\n`;\n\ninterface TooltipProps {\n    text: string;\n    children: any;\n}\n\ninterface ToolTipState {\n    visible: boolean;\n}\n\nexport class Tooltip extends React.Component<TooltipProps, ToolTipState> {\n    constructor(props: TooltipProps) {\n        super(props);\n        this.state = { visible: false };\n    }\n\n    public render() {\n        return (\n            <Popover\n                position={[\"top\", \"bottom\"]}\n                isOpen={this.state.visible}\n                content={<Text>{this.props.text}</Text>}\n            >\n                <div\n                    onMouseEnter={() => this.setState({ visible: true })}\n                    onMouseLeave={() => this.setState({ visible: false })}\n                >\n                    {this.props.children}\n                </div>\n            </Popover>\n        );\n    }\n}\n","import React from \"react\";\nimport { ProfileHouseguest } from \"../memoryWall\";\nimport { houseguestToPortrait, memoryWallPortrait } from \"./houseguestToPortrait\";\nimport { Tooltip } from \"../tooltip/tooltip\";\n\nlet key = -1;\n\nfunction PortraitWrapper(props: { centered?: boolean; children: any }): JSX.Element {\n    return (\n        <div\n            key={key++}\n            className={`columns is-gapless is-mobile is-multiline ${props.centered ? \"is-centered\" : \"\"}`}\n        >\n            {props.children}\n        </div>\n    );\n}\n\nexport function Portrait(props: { houseguest: ProfileHouseguest; centered?: boolean }): JSX.Element {\n    const result = (\n        <PortraitWrapper centered={props.centered}>{houseguestToPortrait(props.houseguest)}</PortraitWrapper>\n    );\n    if (props.houseguest.tooltip) {\n        return (\n            <PortraitWrapper centered={props.centered}>\n                <Tooltip text={props.houseguest.tooltip}>{houseguestToPortrait(props.houseguest)}</Tooltip>\n            </PortraitWrapper>\n        );\n    }\n    return result;\n}\n\nexport function Portraits(props: {\n    houseguests: ProfileHouseguest[];\n    centered?: boolean;\n    detailed?: boolean;\n}): JSX.Element {\n    const rows: JSX.Element[] = [];\n    if (!props.houseguests || props.houseguests.length === 0) {\n        return <div />;\n    }\n    props.houseguests.forEach((houseguest: ProfileHouseguest) => {\n        let result;\n        if (props.detailed) {\n            result = memoryWallPortrait(houseguest, key++);\n        } else {\n            result = houseguestToPortrait(houseguest, key++);\n        }\n        if (houseguest.tooltip) {\n            result = <Tooltip text={houseguest.tooltip}>{result}</Tooltip>;\n        }\n        rows.push(result);\n    });\n    return (\n        <div className={`columns is-gapless is-mobile is-multiline ${props.centered && \"is-centered\"}`}>\n            {rows}\n        </div>\n    );\n}\n","import React from \"react\";\nimport { DividerBox } from \"../layout/box\";\nimport { Portraits } from \"../playerPortrait/portraits\";\nimport { ProfileHouseguest } from \".\";\nimport styled from \"styled-components\";\nimport { textColor } from \"../../model/color\";\nimport { selectTribe } from \"./selectedTribe\";\nimport { Subscription } from \"rxjs\";\nimport { selectedTribe$ } from \"../../subjects/subjects\";\nimport { Tribe, tribeId } from \"../../images/tribe\";\n\ninterface TribeContainerProps {\n  hgs: ProfileHouseguest[];\n  tribe: Tribe;\n}\n\ninterface TribeContainerState {\n  selected: boolean;\n}\n\nexport class TribeContainer extends React.Component<\n  TribeContainerProps,\n  TribeContainerState\n> {\n  private subs: Subscription[] = [];\n\n  public constructor(props: TribeContainerProps) {\n    super(props);\n    this.state = { selected: false };\n  }\n  public componentDidMount() {\n    this.subs.push(\n      selectedTribe$.subscribe((selected) => {\n        this.setState({\n          selected: tribeId(selected) === tribeId(this.props.tribe),\n        });\n      })\n    );\n  }\n\n  public componentWillUnmount() {\n    this.subs.forEach((sub) => sub.unsubscribe());\n  }\n  private select() {\n    selectTribe(this.props.tribe);\n  }\n\n  public render() {\n    const Hoverable = this.getHoverable(this.props.tribe.color);\n    const tribeName = this.props.tribe.name;\n    return (\n      <DividerBox key={tribeName} style={{ textAlign: \"center\" }}>\n        {tribeName !== \"undefined\" && (\n          <p>\n            <Hoverable onClick={this.select.bind(this)}>{tribeName}</Hoverable>\n          </p>\n        )}\n        <Portraits houseguests={this.props.hgs} centered={true}></Portraits>\n      </DividerBox>\n    );\n  }\n  private getHoverable = (color: string) => {\n    const normal = `background-color: ; color: ${color};`;\n    const hilite = `background-color: ${color}; color: ${textColor(color)};`;\n    const selected = this.state.selected;\n    return styled.b`\n      :not(:hover) {\n        ${selected ? hilite : normal}\n      }\n      :hover {\n        ${hilite}\n      }\n    `;\n  };\n}\n","import { Tribe, tribeId, nullTribe } from \"../../images/tribe\";\nimport { selectedTribe$ } from \"../../subjects/subjects\";\n\nexport function selectTribe(t: Tribe) {\n  if (tribeId(t) === tribeId(selectedTribe$.value)) {\n    selectedTribe$.next(nullTribe);\n  } else selectedTribe$.next(t);\n}\n","import React from \"react\";\nimport { PlayerProfile } from \"../../model\";\nimport { RelationshipMap, DiscreteRelationshipMap } from \"../../utils\";\nimport { Tribe, tribeId, nullTribe } from \"../../images/tribe\";\nimport _ from \"lodash\";\nimport { TribeContainer } from \"./tribeContainer\";\nimport { Likemap } from \"../../utils/likeMap\";\nexport interface IMemoryWallProps {\n  readonly houseguests: ProfileHouseguest[];\n}\n\nexport interface ProfileHouseguest extends PlayerProfile {\n  id?: number;\n  isEvicted?: boolean;\n  disabled?: boolean;\n  tribe?: Tribe;\n  //\n  relationships?: RelationshipMap | DiscreteRelationshipMap;\n  popularity?: number;\n  deltaPopularity?: number;\n  likedBy: Likemap;\n  dislikedBy: Likemap;\n  //\n  powerRankings: DiscreteRelationshipMap;\n  powerRanking?: number;\n  thinksImWeak: Likemap;\n  thinksImThreat: Likemap;\n  //\n  hohWins?: number;\n  povWins?: number;\n  nominations?: number;\n  tooltip?: string;\n}\n\nexport function MemoryWall(props: IMemoryWallProps): JSX.Element {\n  const houseguests = props.houseguests;\n  if (!houseguests || houseguests.length === 0) {\n    return <div />;\n  }\n  const houseguestsByTribe = _.groupBy(houseguests, (hg) =>\n    hg.tribe === undefined ? hg.tribe : hg.tribe.name\n  );\n  const tribes: JSX.Element[] = [];\n  _.forEach(houseguestsByTribe, (hgs, name) => {\n    if (name === \"undefined\" && _.size(houseguestsByTribe) > 1) {\n      return;\n    }\n    const tribe: Tribe = hgs[0].tribe ? hgs[0].tribe : nullTribe;\n    tribes.push(<TribeContainer key={tribeId(tribe)} {...{ tribe, hgs }} />);\n  });\n  return (\n    <div\n      style={{\n        margin: \"auto\",\n        maxWidth: -1,\n      }}\n    >\n      {tribes}\n    </div>\n  );\n}\n","import styled from \"styled-components\";\nimport { ColorTheme } from \"../../theme/theme\";\n\nexport const HasText = styled.div`\n    color: ${({ theme }: { theme: ColorTheme }) => theme.text};\n`;\n\nexport const Input = styled.input`\n    color: ${({ theme }: { theme: ColorTheme }) => theme.text};\n`;\n","import React from \"react\";\nimport { roundTwoDigits } from \"../../utils\";\nimport { ProfileHouseguest, PortraitProps, PortraitState } from \"../memoryWall\";\nimport { SelectedPlayerData } from \"./selectedPortrait\";\nimport {\n  RelationshipTypeToSymbol,\n  RelationshipType as Relationship,\n  classifyRelationship,\n  ThreatLevelToSymbol,\n  ThreatLevel,\n} from \"../../utils/ai/classifyRelationship\";\nimport { getSelectedPlayer } from \"../../subjects/subjects\";\nimport { sizeOf } from \"../../utils/likeMap\";\n\nfunction threatLevelOf(a: boolean | undefined): string {\n  if (a === undefined) return \"-\";\n  if (a) return \"💢 THREAT\";\n  return \"💤 WEAK\";\n}\n\nfunction emptySubtitle(): JSX.Element[] {\n  return [<br key={1} />, <br key={2} />];\n}\n\nexport function generatePowerSubtitle(\n  hero: PortraitProps,\n  state: PortraitState,\n  _: boolean | undefined\n): any[] {\n  if (state.disabled) return emptySubtitle();\n  let key = 0;\n  let subtitle: any[] = [];\n  key = addPopularityLine(state, hero, !!_, subtitle, key);\n  key = addCompsLine(hero, subtitle, key);\n  if (!hero.isEvicted) {\n    const data = getSelectedPlayer() as SelectedPlayerData | null;\n    if (data && data.id !== hero.id) {\n      subtitle.push(\n        <div key={key++}>{`${threatLevelOf(hero.powerRankings[data.id])}`}</div>\n      );\n    } else if (data && data.id === hero.id) {\n      subtitle.push(<div key={key++}>I'M SEEN AS</div>);\n      subtitle.push(<div key={key++}>{threatLevelCountTitle(state)}</div>);\n    } else {\n      subtitle.push(<div key={key++}>{threatLevelCountTitle(state)}</div>);\n    }\n  } else {\n    subtitle.push(<br key={key++} style={{ lineHeight: 1 }} />);\n  }\n  return subtitle;\n}\n\nexport function generatePopularitySubtitle(\n  hero: PortraitProps,\n  state: PortraitState,\n  detailed: boolean = false\n): any[] {\n  if (state.disabled) return emptySubtitle();\n  // const data = getSelectedPlayer() as SelectedPlayerData | null;\n  let key = 0;\n  let subtitle: any[] = [];\n  // popularity\n  // key = addPopularityLine(state, hero, detailed, subtitle, key);\n  // competition wins\n  key = addCompsLine(hero, subtitle, key);\n  // friendship count / relationship classification titles\n  ({ subtitle, key } = addCountTitle(\n    hero,\n    state,\n    subtitle,\n    key,\n    friendOrEnemyTitle,\n    friendEnemyCountTitle\n  ));\n  // if (!data) subtitle.push(<br key={key++} style={{ lineHeight: 1 }} />);\n  return subtitle;\n}\n\nfunction addCountTitle(\n  hero: PortraitProps,\n  state: PortraitState,\n  subtitle: any[],\n  key: number,\n  discreteTitle: (a: PortraitProps, b: SelectedPlayerData) => string[],\n  countTitle: (a: PortraitState) => string[]\n) {\n  if (!hero.isEvicted) {\n    const data = getSelectedPlayer() as SelectedPlayerData | null;\n    if (data && data.id !== hero.id) {\n      const titles = discreteTitle(hero, data);\n      subtitle = subtitle.concat(\n        titles.map((txt) => <div key={key++}>{txt}</div>)\n      );\n    } else {\n      const titles = countTitle(state);\n      subtitle = subtitle.concat(\n        titles.map((txt) => <div key={key++}>{txt}</div>)\n      );\n    }\n  } else {\n    subtitle.push(<br key={key++} style={{ lineHeight: 1 }} />);\n  }\n  return { subtitle, key };\n}\n\nfunction addPopularityLine(\n  state: { popularity?: number },\n  hero: PortraitProps,\n  detailed: boolean,\n  subtitle: any[],\n  key: number\n) {\n  let popularity = state.popularity;\n  if (popularity && (popularity > 1 || popularity < -1)) {\n    popularity = hero.popularity;\n  }\n  if (popularity && !hero.isEvicted) {\n    let popularitySubtitle = `${roundTwoDigits(popularity)}%`;\n    const deltaPop = getDeltaPopularity(hero, popularity);\n    if (detailed && deltaPop !== 0) {\n      const arrow = deltaPop > 0 ? \" | ↑\" : \" | ↓\";\n      popularitySubtitle += `${arrow} ${deltaPop}%`;\n    }\n    subtitle.push(<div key={key++}>{\"\"}</div>); // hardcoded to do nothing for the discrete case.\n  }\n  return key;\n}\n\nfunction addCompsLine(hero: PortraitProps, subtitle: any[], key: number) {\n  if (compWins(hero)) {\n    subtitle.push(<div key={key++}>{`${compWins(hero)}`}</div>);\n  } else {\n    subtitle.push(<br key={key++} style={{ lineHeight: 1 }} />);\n  }\n  return key;\n}\n\nfunction getDeltaPopularity(\n  houseguest: PortraitProps,\n  statePopularity: number\n) {\n  if (\n    roundTwoDigits(houseguest.popularity) !== roundTwoDigits(statePopularity)\n  ) {\n    return 0;\n  }\n  return houseguest.deltaPopularity\n    ? roundTwoDigits(houseguest.deltaPopularity)\n    : 0;\n}\n\nfunction compWins(houseguest: ProfileHouseguest): string {\n  return `${houseguest.hohWins ? `♔ ${houseguest.hohWins}` : \"\"}${\n    houseguest.povWins && houseguest.hohWins\n      ? `|🛇 ${houseguest.povWins}`\n      : houseguest.povWins\n      ? `🛇 ${houseguest.povWins}`\n      : \"\"\n  }${\n    (houseguest.hohWins || houseguest.povWins) && houseguest.nominations\n      ? \"|\"\n      : \"\"\n  }${houseguest.nominations ? `✘ ${houseguest.nominations}` : \"\"}`;\n}\n\nfunction friendOrEnemyTitle(\n  hero: PortraitProps,\n  villain: SelectedPlayerData\n): string[] {\n  const titles: string[] = [];\n  const heroRelationship: boolean | number | undefined = hero.relationships![\n    villain.id\n  ];\n  const villainRelationship: boolean | number | undefined =\n    villain.relationships[hero.id!];\n  titles.push(\n    RelationshipTypeToSymbol[\n      classifyRelationship(\n        hero.popularity || 0,\n        villain.popularity,\n        heroRelationship,\n        villainRelationship\n      )\n    ]\n  );\n  return titles;\n}\n\nfunction threatLevelCountTitle(hero: PortraitState): string[] {\n  const titles: string[] = [];\n  const count = {\n    friends: sizeOf(hero.thinksImThreat),\n    enemies: sizeOf(hero.thinksImWeak),\n  };\n  const friendCountText =\n    count.friends > 0\n      ? `${count.friends} ${ThreatLevelToSymbol[ThreatLevel.Threat]}`\n      : \"\";\n\n  const enemyCountText =\n    count.enemies > 0\n      ? `${count.enemies} ${ThreatLevelToSymbol[ThreatLevel.Weak]}`\n      : \"\";\n\n  titles.push(\n    `${friendCountText}${\n      friendCountText && enemyCountText && \" | \"\n    }${enemyCountText}`\n  );\n  return titles;\n}\n\nfunction friendEnemyCountTitle(hero: PortraitState): string[] {\n  const titles: string[] = [];\n  const count = {\n    friends: sizeOf(hero.likedBy),\n    enemies: sizeOf(hero.dislikedBy),\n  };\n  const friendCountText =\n    count.friends > 0\n      ? `${count.friends} ${RelationshipTypeToSymbol[Relationship.Friend]}`\n      : \"\";\n\n  const enemyCountText =\n    count.enemies > 0\n      ? `${count.enemies} ${RelationshipTypeToSymbol[Relationship.Enemy]}`\n      : \"\";\n\n  titles.push(\n    `${friendCountText}${\n      friendCountText && enemyCountText && \" | \"\n    }${enemyCountText}`\n  );\n  return titles;\n}\n","import { Rgb, interpolateColor } from \"./color\";\nimport { PortraitState, PortraitProps } from \"../components/memoryWall\";\nimport { extremeValues } from \"../utils\";\nimport {\n  generatePopularitySubtitle,\n  generatePowerSubtitle,\n} from \"../components/playerPortrait/subtitle\";\n\nexport interface PortraitDisplayMode {\n  minColor: Rgb;\n  maxColor: Rgb;\n  backgroundColor: (state: PortraitState) => string;\n  generateSubtitle: (\n    props: PortraitProps,\n    state: PortraitState,\n    detailed?: boolean\n  ) => any[];\n}\n\nconst popularityMinColor = new Rgb(252, 137, 137);\nconst popularityMaxColor = new Rgb(137, 252, 137);\n\nexport const popularityMode: PortraitDisplayMode = {\n  minColor: popularityMinColor,\n  maxColor: popularityMaxColor,\n  backgroundColor: (state: PortraitState) => {\n    const popularity = state.popularity;\n    if (popularity === undefined) {\n      return \"rgb(170, 170, 170)\";\n    }\n\n    const extremePopularity = extremeValues(popularity);\n    const percent = (extremePopularity + 1) / 2;\n    return interpolateColor(popularityMinColor, popularityMaxColor, percent);\n  },\n  generateSubtitle: generatePopularitySubtitle,\n};\n\nconst powerMinColor = new Rgb(192, 181, 255);\nconst powerMaxColor = new Rgb(255, 204, 94);\n/// originals ^^^^^\n// const powerMinColor = new Rgb(104, 128, 158); // blue\n\n// const powerMinColor = new Rgb(148, 16, 240);\n// const powerMaxColor = new Rgb(255, 143, 0);\n\nexport const powerMode: PortraitDisplayMode = {\n  minColor: powerMinColor,\n  maxColor: powerMaxColor,\n  backgroundColor: (state: PortraitState) => {\n    const powerRanking = state.powerRanking;\n    if (powerRanking === undefined) return \"rgb(170, 170, 170)\";\n    return interpolateColor(powerMinColor, powerMaxColor, powerRanking);\n  },\n  generateSubtitle: generatePowerSubtitle,\n};\n","import React from \"react\";\nimport { PortraitDisplayMode } from \"../../model/portraitDisplayMode\";\nimport { displayMode$ } from \"../../subjects/subjects\";\nimport { Subscription } from \"rxjs\";\n\nfunction setDisplayMode(p: PortraitDisplayMode) {\n    displayMode$.next(p);\n}\n\ninterface ViewBarTagProps {\n    mode: PortraitDisplayMode;\n    text: string;\n    disabled?: boolean;\n}\n\nexport class ViewBarTag extends React.Component<ViewBarTagProps, { selected: boolean }> {\n    private sub: Subscription | null = null;\n\n    public constructor(props: ViewBarTagProps) {\n        super(props);\n        this.state = { selected: props.mode === displayMode$.value };\n    }\n\n    public componentDidMount() {\n        this.sub = displayMode$.subscribe({\n            next: (mode) => {\n                if (mode !== this.props.mode) {\n                    this.setState({ selected: false });\n                }\n            },\n        });\n    }\n\n    public componentWillUnmount() {\n        if (this.sub) this.sub.unsubscribe();\n    }\n\n    public render() {\n        const name = \"level-item tag is-medium is-light\";\n        const style = getStyle(this.props);\n        return (\n            <span\n                className={name}\n                style={style}\n                onClick={() => {\n                    !this.props.disabled && setDisplayMode(this.props.mode);\n                    !this.props.disabled && this.setState({ selected: true });\n                }}\n            >\n                {styleText(this.props.text, this.state.selected)}\n            </span>\n        );\n    }\n}\n\nfunction styleText(text: string, selected: boolean): JSX.Element {\n    return selected ? <b>{text}</b> : <i>{text}</i>;\n}\n\nfunction getStyle(props: ViewBarTagProps) {\n    return props.disabled\n        ? {}\n        : {\n              background: `linear-gradient(90deg, ${props.mode.minColor.toRgba()} 0%, ${props.mode.maxColor.toRgba()} 100%)`,\n              cursor: \"pointer\",\n          };\n}\n","import React from \"react\";\nimport { popularityMode, powerMode } from \"../../model/portraitDisplayMode\";\nimport { ViewBarTag } from \"./viewBarTag\";\nimport { Box } from \"../layout/box\";\nimport styled from \"styled-components\";\nimport { ColorTheme } from \"../../theme/theme\";\n\nconst ViewsBox = styled(Box)`\n  background: ${({ theme }: { theme: ColorTheme }) => theme.overlay};\n`;\n\nexport function ViewsBar() {\n  return (\n    <ViewsBox className=\"level is-mobile\" key=\"viewsbar\">\n      <ViewBarTag mode={popularityMode} text={\"Relationships\"}></ViewBarTag>\n      <ViewBarTag mode={powerMode} text={\"Threat Level\"}></ViewBarTag>\n      {/* <ViewBarTag mode={powerMode} disabled={true} text={\"Cliques [Coming Soon™]\"}></ViewBarTag> */}\n    </ViewsBox>\n  );\n}\n","import React from \"react\";\nimport { MemoryWall } from \"../memoryWall\";\nimport { HasText } from \"../layout/text\";\nimport { ViewsBar } from \"../viewsBar/viewBar\";\nimport { ProfileHouseguest } from \"../memoryWall/memoryWall\";\nimport { Subscription } from \"rxjs\";\nimport { players$ } from \"../../subjects/subjects\";\n\ninterface PregameScreenState {\n  cast: ProfileHouseguest[];\n}\n\nexport class MemoryWallScreen extends React.Component<{}, PregameScreenState> {\n  private subs: Subscription[] = [];\n  public constructor(props: never) {\n    super(props);\n    this.state = { cast: players$.value };\n  }\n\n  public componentDidMount() {\n    this.subs.push(\n      players$.subscribe((cast) => {\n        this.setState({ cast });\n      })\n    );\n  }\n\n  public componentWillUnmount() {\n    this.subs.forEach((sub) => sub.unsubscribe());\n  }\n\n  public render() {\n    if (this.state.cast.length === 0) {\n      return <HasText>Cast is empty.</HasText>;\n    }\n    return (\n      <HasText>\n        <ViewsBar />\n        <MemoryWall houseguests={this.state.cast} />\n      </HasText>\n    );\n  }\n}\n","import { BehaviorSubject, Subject } from \"rxjs\";\nimport { MemoryWallScreen } from \"../components/memoryWallScreen/memoryWallScreen\";\nimport { Episode, PlayerProfile } from \"../model\";\nimport { SelectedPlayerData } from \"../components/playerPortrait/selectedPortrait\";\nimport React from \"react\";\nimport {\n  PortraitDisplayMode,\n  popularityMode,\n} from \"../model/portraitDisplayMode\";\nimport { ColorTheme } from \"../theme/theme\";\nimport { ProfileHouseguest } from \"../components/memoryWall\";\nimport { Tribe, nullTribe } from \"../images/tribe\";\n\n// What is currently being displayed.\nexport const mainContentStream$ = new BehaviorSubject(<MemoryWallScreen />);\n// Push episodes to this subject to add them to the sidebar. Null resets everything.\nexport const episodes$ = new BehaviorSubject<Episode | null>(null);\n// Forcibly switches to an episode. Used when adding a new episode.\nexport const switchEpisode$ = new Subject<number>();\nexport function newEpisode(episode: Episode | null) {\n  episodes$.next(episode);\n}\nexport function switchSceneRelative(n: number) {\n  switchEpisode$.next(n);\n}\n\nexport const selectedTribe$ = new BehaviorSubject<Tribe>(nullTribe);\n\nexport const players$ = new BehaviorSubject<ProfileHouseguest[]>([]);\n\n// this variable is unused but if you delete it it breaks some race condition or something and the code compiles, but doesn't work anymore.\nexport const cast$ = new BehaviorSubject<PlayerProfile[]>([]);\n\n// The player that the user has clicked on.\nexport const selectedPlayer$ = new BehaviorSubject<SelectedPlayerData | null>(\n  null\n);\nexport function getSelectedPlayer() {\n  return selectedPlayer$.value;\n}\n\n// The display mode selected by the viewsbar.\nexport const displayMode$ = new BehaviorSubject<PortraitDisplayMode>(\n  popularityMode\n);\n\n// If the screen is fullscreen or not.\nexport const isFullscreen$ = new BehaviorSubject<boolean>(false);\nexport const theme$ = new Subject<ColorTheme>();\n","import prand from \"pure-rand\";\nimport { BehaviorSubject } from \"rxjs\";\nimport { hashcode } from \"./utilities\";\nimport { cast$ } from \"../subjects/subjects\";\n\nexport class BbRandomGenerator {\n  private rng: prand.RandomGenerator;\n\n  public randomFloat(): number {\n    let result: number;\n    [result, this.rng] = this.rng.next();\n    return result / 2147483647.0;\n  }\n\n  public randomInt(a: number, b: number): number {\n    let result: number;\n    [result, this.rng] = prand.uniformIntDistribution(a, b, this.rng);\n    return result;\n  }\n\n  public flipCoin(): boolean {\n    let result: number;\n    [result, this.rng] = this.rng.next();\n    return result % 2 === 0;\n  }\n\n  public seed(seed: number) {\n    this.rng = prand.xorshift128plus(seed);\n  }\n\n  public constructor(seed: number) {\n    this.rng = prand.xorshift128plus(seed);\n  }\n}\n\nexport function rng() {\n  return rng$.value;\n}\n\nconst rng$ = new BehaviorSubject(new BbRandomGenerator(0));\n\n// theoretically this does nothing, but if you delete it the code stops working.\n// yay race conditions...?\nconst castSub = cast$.subscribe({\n  next: () => {},\n});\n","import { Houseguest } from \"./houseguest\";\nimport { PlayerProfile } from \"./playerProfile\";\nimport _ from \"lodash\";\nimport { newRelationshipMap, rng } from \"../utils\";\nimport { finalJurySize, getFinalists } from \"./season\";\nimport { EpisodeLog } from \"./logging/episodelog\";\n\nexport function getById(gameState: GameState, id: number): Houseguest {\n  return gameState.houseguestCache[id];\n}\n\nexport function exclude(inclusions: Houseguest[], exclusions: Houseguest[]) {\n  const excludedIds = exclusions.map((hg) => hg.id);\n  return inclusions.filter(\n    (hg) => !excludedIds.includes(hg.id) && !hg.isEvicted\n  );\n}\n\nexport function randomPlayer(\n  inclusions: Houseguest[],\n  exclusions: Houseguest[] = []\n): Houseguest {\n  if (inclusions.length === 0) {\n    throw new Error(\"Tried to get a random player from a list of 0 players.\");\n  }\n  const options = exclude(inclusions, exclusions);\n  const choice = rng().randomInt(0, options.length - 1);\n\n  return options[choice];\n}\n\nexport function nonEvictedHouseguests(gameState: GameState) {\n  return gameState.houseguests.filter((hg) => !hg.isEvicted);\n}\nexport function getJurors(gameState: GameState): Houseguest[] {\n  return gameState.houseguests.filter((hg) => hg.isJury);\n}\n\nexport function inJury(gameState: GameState): Boolean {\n  return gameState.remainingPlayers - getFinalists() <= finalJurySize();\n}\n\n// export function calculatePopularity(hero: Houseguest, house: Houseguest[]) {\n//     let sum = 0;\n//     let count = 0;\n//     const targetId = hero.id;\n//     house.forEach(houseguest => {\n//         if (houseguest.id !== targetId) {\n//             count++;\n//             sum += houseguest.relationships[targetId];\n//         }\n//     });\n//     return count === 0 ? 0 : sum / count;\n// }\n\nexport class GameState {\n  // Current state of the game after a phase.\n\n  readonly houseguestCache: { [id: number]: Houseguest } = {};\n  readonly houseguests: Houseguest[] = [];\n  readonly remainingPlayers: number = 0;\n  readonly phase: number = 0;\n  readonly previousHOH?: Houseguest;\n  readonly log: EpisodeLog[] = [];\n  get currentLog() {\n    return this.log[this.phase];\n  }\n\n  public constructor(init: PlayerProfile[] | GameState) {\n    if (!(init instanceof Array)) {\n      Object.assign(this, init);\n    } else {\n      const profiles = init as PlayerProfile[];\n      this.remainingPlayers = profiles.length;\n      profiles.forEach((profile, i) => {\n        const hg: Houseguest = new Houseguest({\n          ...profile,\n          id: i,\n          relationships: newRelationshipMap(profiles.length, i),\n        });\n        this.houseguestCache[i] = hg;\n        this.houseguests.push(hg);\n      });\n    }\n  }\n}\n\nexport class MutableGameState {\n  public houseguests: Houseguest[] = [];\n  public houseguestCache: { [id: number]: Houseguest } = {};\n  public remainingPlayers: number = 0;\n  public phase: number = 0;\n  public previousHOH?: Houseguest;\n  public log: EpisodeLog[] = [];\n  get currentLog() {\n    return this.log[this.phase];\n  }\n\n  public constructor(init: GameState | MutableGameState) {\n    const copy = _.cloneDeep(init);\n    Object.assign(this, copy);\n  }\n}\n","import { VoteType } from \"./voteType\";\n\nexport class EpisodeLog {\n    public nominationsPreVeto: string[] = [];\n    public vetoWinner?: string;\n    public winner?: number;\n    public runnerUp?: number;\n    public nominationsPostVeto: string[] = [];\n    public evicted: number = -1;\n    public votes: { [id: string]: VoteType } = {};\n    public votesInMajority: number = -1;\n    public outOf: number = -1;\n    public soleVoter?: string;\n}\n","import {\n  GameState,\n  MutableGameState,\n  nonEvictedHouseguests,\n} from \"../../model/gameState\";\nimport { Episode } from \"../../model\";\nimport { EpisodeType } from \"./episodes\";\nimport { EpisodeLog } from \"../../model/logging/episodelog\";\n\nexport class EpisodeFactory {\n  public nextEpisode(gameState: GameState, episodeType: EpisodeType): Episode {\n    let newState = new MutableGameState(gameState);\n    newState.phase++;\n    if (nonEvictedHouseguests(gameState).length > 2) {\n      newState.log[newState.phase] = new EpisodeLog();\n    }\n    throw new Error(\"You can't call this function.\");\n  }\n}\n","import {\n  MutableGameState,\n  getById,\n  inJury,\n  nonEvictedHouseguests,\n  GameState,\n  EpisodeType,\n  Episode,\n  InitEpisode,\n} from \"../../model\";\nimport { getFinalists, finalJurySize } from \"../../model/season\";\nimport { Scene } from \"./scene\";\n\nexport const BigBrotherVanilla: EpisodeType = {\n  canPlayWith: (n: number) => {\n    return n > 1;\n  },\n  eliminates: 1,\n  arrowsEnabled: true,\n  hasViewsbar: true,\n};\n\n// Refactoring ideas\n/**\n * Might be best to start passing ids instead of houseguests for HoH/nominees/veto winner\n */\n\nexport function evictHouseguest(gameState: MutableGameState, id: number) {\n  const evictee = getById(gameState, id);\n  if (gameState.currentLog) gameState.currentLog.evicted = evictee.id;\n  evictee.isEvicted = true;\n  if (gameState.remainingPlayers - getFinalists() <= finalJurySize()) {\n  }\n  if (inJury(gameState)) {\n    nonEvictedHouseguests(gameState).forEach((hg) => {\n      hg.superiors.delete(evictee.id);\n    });\n  }\n  gameState.remainingPlayers--;\n}\n\nexport function generateBbVanilla(initialGameState: GameState): null {\n  return null;\n}\nexport class BigBrotherVanillaEpisode extends Episode {\n  readonly title: string;\n  readonly scenes: Scene[];\n  readonly content: JSX.Element;\n  readonly gameState: GameState;\n  readonly type = BigBrotherVanilla;\n\n  public constructor(init: InitEpisode) {\n    super(init);\n    this.title = init.title;\n    this.scenes = init.scenes;\n    this.content = init.content;\n    this.gameState = init.gameState;\n  }\n}\n","import React from \"react\";\nimport { EpisodeType, Episode, InitEpisode } from \"./episodes\";\nimport { Scene } from \"./scene\";\nimport { GameState } from \"../../model\";\nimport { NextEpisodeButton } from \"../nextEpisodeButton/nextEpisodeButton\";\nimport { HasText } from \"../layout/text\";\n\nexport const BigBrotherFinale: EpisodeType = {\n  canPlayWith: (n: number) => n === 3,\n  eliminates: 2,\n  arrowsEnabled: true,\n  hasViewsbar: true,\n};\n\nexport function generateBbFinale(\n  initialGameState: GameState\n): BigBrotherFinaleEpisode {\n  const title = \"Finale\";\n  const content = (\n    <HasText>\n      Finale Night\n      <NextEpisodeButton />\n    </HasText>\n  );\n  const scenes: Scene[] = [];\n  return new BigBrotherFinaleEpisode({\n    gameState: initialGameState,\n    content,\n    title,\n    scenes,\n    type: BigBrotherFinale,\n  });\n}\n\nexport class BigBrotherFinaleEpisode extends Episode {\n  readonly title: string;\n  readonly scenes: Scene[];\n  readonly content: JSX.Element;\n  readonly gameState: GameState;\n  readonly type = BigBrotherFinale;\n\n  public constructor(init: InitEpisode) {\n    super(init);\n    this.title = init.title;\n    this.scenes = init.scenes;\n    this.content = init.content;\n    this.gameState = init.gameState;\n  }\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ColorTheme } from \"../../theme/theme\";\n\ninterface TextProps {\n  noMargin?: boolean;\n  children?: any;\n  style?: any;\n  noTheme?: boolean;\n}\n\nconst NoMargin = styled.div`\n  text-align: center;\n  color: ${({ theme }: { theme: ColorTheme }) => theme.text};\n`;\nconst Center = styled.p`\n  text-align: center;\n  color: ${({ theme }: { theme: ColorTheme }) => theme.text};\n`;\n\nexport function Centered(props: TextProps): JSX.Element {\n  if (props.noMargin) return <NoMargin>{props.children}</NoMargin>;\n  return <Center style={props.style}>{props.children} </Center>;\n}\n\nexport function CenteredBold(props: TextProps): JSX.Element {\n  return (\n    <Centered {...props}>\n      <b style={props.style || {}}>{props.children} </b>\n    </Centered>\n  );\n}\n\nexport function CenteredItallic(props: TextProps): JSX.Element {\n  return (\n    <Centered noMargin={props.noMargin}>\n      <i>{props.children} </i>\n    </Centered>\n  );\n}\n","import React from \"react\";\nimport { isFullscreen$ } from \"../../subjects/subjects\";\nimport styled from \"styled-components\";\n\nconst FullscreenIcon = styled.img`\n    position: -webkit-sticky;\n    position: sticky;\n    top: 20px;\n    right: 20px;\n`;\n\nexport function FullscreenButton(): JSX.Element {\n    return (\n        <FullscreenIcon\n            src={\n                \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAASElEQVRIiWNgGAUEACMa/z+R6ohWz0Sqi0gFLIRcQAAQDAGa+2DoWzAKRgH1wX8G3OULWfqHfkYbsNIUPR5IrQ/gYLQsGngAAEPgCRZjAdYSAAAAAElFTkSuQmCC\"\n            }\n            className=\"button is-rounded\"\n            onClick={() => {\n                isFullscreen$.next(!isFullscreen$.getValue());\n            }}\n        />\n    );\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { EpisodeLog } from \"../../../model/logging/episodelog\";\nimport { CenteredBold, Centered, CenteredItallic } from \"../../layout/centered\";\nimport { GameState, getById } from \"../../../model\";\nimport {\n  VoteType,\n  WinnerVote,\n  RunnerUpVote,\n} from \"../../../model/logging/voteType\";\nimport { FullscreenButton } from \"../../mainPage/fullscreenButton\";\nimport { ColorTheme } from \"../../../theme/theme\";\n\nexport const EndgameTableCell = styled.td`\n  padding: 0.1em 0.4em;\n  border: 1px solid\n    ${({ theme }: { theme: ColorTheme }) => theme.tableCellBorder};\n`;\n\nconst EndgameTable = styled.table`\n  border: 1px solid\n    ${({ theme }: { theme: ColorTheme }) => theme.tableCellBorder};\n  border-collapse: collapse;\n`;\n\nconst Gray = styled(EndgameTableCell)`\n  background-color: ${({ theme }: { theme: ColorTheme }) => theme.grayCell};\n`;\n\nconst White = styled(EndgameTableCell)`\n  background-color: ${({ theme }: { theme: ColorTheme }) =>\n    theme.lightGrayCell};\n`;\n\nconst Evicted = styled(EndgameTableCell)`\n  background-color: ${({ theme }: { theme: ColorTheme }) => theme.evictedCell};\n`;\n\nexport const WinnerCell = styled(EndgameTableCell)`\n  background-color: ${({ theme }: { theme: ColorTheme }) => theme.winnerCell};\n`;\n\nexport const RunnerUpCell = styled(EndgameTableCell)`\n  background-color: ${({ theme }: { theme: ColorTheme }) => theme.runnerUpCell};\n`;\n\nexport const NomineeCell = styled(EndgameTableCell)`\n  background-color: ${({ theme }: { theme: ColorTheme }) => theme.nomineeCell};\n`;\n\nexport const HohCell = styled(EndgameTableCell)`\n  background-color: ${({ theme }: { theme: ColorTheme }) => theme.hohCell};\n`;\n\nconst BlackRow = styled.tr`\n  height: 0.4em;\n  background-color: #000000;\n`;\n\nexport function generateVotingTable(gameState: GameState): JSX.Element {\n  const masterLog: EpisodeLog[] = gameState.log;\n  const houseguestCells: JSX.Element[][] = [];\n  gameState.houseguests.forEach((hg, i) => {\n    houseguestCells[hg.id] = [\n      <Gray key={`hg-name---${i}`}>\n        <CenteredBold noMargin={true}>{hg.name}</CenteredBold>\n      </Gray>,\n    ];\n  });\n  const evictionOrder: number[] = [];\n  const topRowCells: JSX.Element[] = [];\n  const preVetoCells: JSX.Element[] = [];\n  const vetoCells: JSX.Element[] = [];\n  const postVetoCells: JSX.Element[] = [];\n  const evictedCells: JSX.Element[] = [];\n  const winnerCells: JSX.Element[] = [];\n  masterLog.forEach((log, i) => {\n    generateTopRow(log, i, topRowCells, masterLog.length - 1);\n    generatePreVetoRow(log, i, preVetoCells);\n    generateVetoRow(log, i, vetoCells);\n    generatePostVetoRow(log, i, postVetoCells);\n    generateEvictedRow(log, i, evictedCells, gameState);\n    if (!log) return;\n    evictionOrder.push(log.evicted);\n    if (log.runnerUp !== undefined) evictionOrder.push(log.runnerUp);\n    if (log.winner !== undefined) evictionOrder.push(log.winner);\n    // add each of the votes to the houseguest cells\n    for (const [key, value] of Object.entries(log.votes)) {\n      // typescript for .. in loops kinda suck so i need to do a sketchy type conversion\n      const id: number = (key as unknown) as number;\n      const vote: VoteType = value;\n      houseguestCells[id].push(vote.render(gameState));\n    }\n    if (log.winner !== undefined && log.runnerUp !== undefined) {\n      houseguestCells[log.winner].push(new WinnerVote().render(gameState));\n      houseguestCells[log.runnerUp].push(new RunnerUpVote().render(gameState));\n      evictedCells.push(\n        <RunnerUpCell>\n          <CenteredBold noMargin={true}>\n            {getById(gameState, log.runnerUp).name}\n          </CenteredBold>\n          <Centered noMargin={true}>\n            <small>Finalist</small>\n          </Centered>\n        </RunnerUpCell>\n      );\n      winnerCells.push(\n        <WinnerCell>\n          <CenteredBold noMargin={true}>\n            {getById(gameState, log.winner).name}\n          </CenteredBold>\n          <Centered noMargin={true}>\n            <small>Winner</small>\n          </Centered>\n        </WinnerCell>\n      );\n    }\n  });\n  preVetoCells.push(\n    <White key={`preveto--finale`} rowSpan={3}>\n      <CenteredItallic noMargin={true}>(none)</CenteredItallic>\n    </White>\n  );\n  const winnerRow = <tr>{winnerCells}</tr>;\n  const topRow = <tr>{topRowCells}</tr>;\n  const preVetoRow = <tr>{preVetoCells}</tr>;\n  const vetoRow = <tr>{vetoCells}</tr>;\n  const postVetoRow = <tr>{postVetoCells}</tr>;\n  const blackRow = (\n    <BlackRow>\n      <td colSpan={gameState.houseguests.length} />\n    </BlackRow>\n  );\n  const houseguestRows: JSX.Element[] = [];\n  const evictedRow = <tr>{evictedCells}</tr>;\n  let evictionColSpan = -1;\n  const weeks = evictionOrder.length;\n  evictionOrder.reverse().forEach((id, i) => {\n    if (evictionColSpan > 0) {\n      const weekText = i === 2 ? \"(Finale)\" : `(Week ${weeks - i})`;\n      const isJury = getById(gameState, id).isJury;\n      const colSpan = isJury ? evictionColSpan - 1 : evictionColSpan;\n      const evicted = (\n        <Evicted colSpan={colSpan} key={`evicted-week-${weeks - i}`}>\n          <CenteredItallic noMargin={true}>Evicted</CenteredItallic>\n          <CenteredItallic noMargin={true}>\n            <small>{weekText}</small>\n          </CenteredItallic>\n        </Evicted>\n      );\n      if (!isJury) {\n        houseguestCells[id].push(evicted); // not jury, they dead\n      } else {\n        const tempList = houseguestCells[id].slice(0, -1);\n        tempList.push(evicted);\n        tempList.push(houseguestCells[id][houseguestCells[id].length - 1]);\n        houseguestCells[id] = tempList;\n      }\n    }\n    houseguestRows.push(<tr key={`hgrow--${id}`}>{houseguestCells[id]}</tr>);\n    evictionColSpan++;\n  });\n\n  return (\n    <div>\n      <FullscreenButton />\n      <EndgameTable>\n        <tbody>\n          {topRow}\n          {preVetoRow}\n          {vetoRow}\n          {postVetoRow}\n          {blackRow}\n          {houseguestRows}\n          {blackRow}\n          {evictedRow}\n          {winnerRow}\n        </tbody>\n      </EndgameTable>\n    </div>\n  );\n}\n\nfunction generateEvictedRow(\n  log: EpisodeLog | undefined,\n  i: number,\n  cells: JSX.Element[],\n  gameState: GameState\n) {\n  if (!log) {\n    cells.push(\n      <Gray key={i} rowSpan={2}>\n        <CenteredBold noMargin={true}>Evicted</CenteredBold>\n      </Gray>\n    );\n    return;\n  }\n\n  const voteTextLine1 =\n    log.soleVoter !== undefined ? `${log.soleVoter}'s choice` : \"\";\n\n  cells.push(\n    <Evicted key={i} rowSpan={2}>\n      <Centered noMargin={true}>\n        <b>{getById(gameState, log.evicted).name}</b>\n        <br />\n        <small>\n          {voteTextLine1} <br />\n          to evict\n        </small>\n      </Centered>\n    </Evicted>\n  );\n}\n\nfunction generatePostVetoRow(\n  log: EpisodeLog | undefined,\n  i: number,\n  cells: JSX.Element[]\n) {\n  if (!log) {\n    cells.push(\n      <Gray key={`postVeto--${i}`}>\n        <CenteredBold noMargin={true}>\n          Nominations\n          <br />\n          <small>(post-veto)</small>\n        </CenteredBold>\n      </Gray>\n    );\n    return;\n  }\n  cells.push(\n    <White key={`postVeto--${i}`}>\n      <Centered noMargin={true}>\n        {log.nominationsPostVeto[0]}\n        <br /> {log.nominationsPostVeto[1]}\n      </Centered>\n    </White>\n  );\n}\n\nfunction generateVetoRow(\n  log: EpisodeLog | undefined,\n  i: number,\n  cells: JSX.Element[]\n) {\n  if (!log) {\n    cells.push(\n      <Gray key={`veto--${i}`}>\n        <CenteredBold noMargin={true}>Veto Winner</CenteredBold>\n      </Gray>\n    );\n    return;\n  }\n  if (log.vetoWinner === undefined) return;\n\n  cells.push(\n    <White key={`veto--${i}`}>\n      <Centered noMargin={true}>{log.vetoWinner}</Centered>\n    </White>\n  );\n}\n\nfunction generatePreVetoRow(\n  log: EpisodeLog | undefined,\n  i: number,\n  cells: JSX.Element[]\n) {\n  if (!log) {\n    cells.push(\n      <Gray key={`preveto--${i}`}>\n        <CenteredBold noMargin={true}>\n          Nominations\n          <br />\n          <small>(pre-veto)</small>\n        </CenteredBold>\n      </Gray>\n    );\n    return;\n  }\n  if (log.nominationsPreVeto.length === 0) {\n    cells.push(\n      <White key={`preveto--${i}`} rowSpan={2}>\n        <CenteredItallic noMargin={true}>(none)</CenteredItallic>\n      </White>\n    );\n    return;\n  }\n  cells.push(\n    <White key={`preveto--${i}`}>\n      <Centered noMargin={true}>\n        {log.nominationsPreVeto[0]}\n        <br /> {log.nominationsPreVeto[1]}\n      </Centered>\n    </White>\n  );\n}\n\nfunction generateTopRow(\n  log: EpisodeLog | undefined,\n  i: number,\n  cells: JSX.Element[],\n  max: number\n) {\n  if (!log) {\n    cells.push(<Gray key={`toprow--${i}`} />);\n    return;\n  }\n  if (i === max) {\n    cells.push(\n      <Gray key={`toprow--${i}`} colSpan={2}>\n        <CenteredBold noMargin={true}>Finale</CenteredBold>\n      </Gray>\n    );\n    return;\n  }\n  cells.push(\n    <Gray key={`toprow--${i}`}>\n      <CenteredBold noMargin={true}>Week {i}</CenteredBold>\n    </Gray>\n  );\n}\n","import { Episode, InitEpisode, EpisodeType } from \"./episodes\";\nimport { Scene } from \"./scene\";\nimport { GameState } from \"../../model\";\nimport { evictHouseguest } from \"./bigBrotherEpisode\";\nimport { generateVotingTable } from \"./scenes/votingTable\";\n\nexport const GameOver: EpisodeType = {\n    canPlayWith: (n: number) => n === 1,\n    eliminates: 1,\n    arrowsEnabled: false,\n    hasViewsbar: false\n};\n\nexport function generateGameOver(gameState: GameState): GameOverEpisode {\n    const title = \"Game Over\";\n    const scenes: Scene[] = [];\n    const content = generateVotingTable(gameState);\n    gameState.houseguests.forEach(hg => {\n        evictHouseguest(gameState, hg.id);\n    });\n    return new GameOverEpisode({ gameState, content, title, scenes, type: GameOver });\n}\n\nexport class GameOverEpisode extends Episode {\n    readonly title: string;\n    readonly scenes: Scene[];\n    readonly content: JSX.Element;\n    readonly gameState: GameState;\n\n    public constructor(init: InitEpisode) {\n        super(init);\n        this.title = init.title;\n        this.scenes = init.scenes;\n        this.content = init.content;\n        this.gameState = init.gameState;\n    }\n}\n","import { BigBrotherVanilla } from \"../components/episode/bigBrotherEpisode\";\nimport { EpisodeFactory } from \"../components/episode/episodeFactory\";\nimport { GameState } from \"./gameState\";\nimport { EpisodeType, Episode } from \".\";\nimport { BigBrotherFinale } from \"../components/episode/bigBrotherFinale\";\nimport { GameOver } from \"../components/episode/gameOver\";\n\nexport function finalJurySize() {\n  return jurors;\n}\n\nlet jurors = 7;\n\nexport function getFinalists() {\n  return 2;\n}\n\nexport class Season {\n  private factory: EpisodeFactory;\n\n  public constructor() {\n    this.factory = new EpisodeFactory();\n  }\n\n  // In the future, this would all be customizable,\n  // and not just all big brother episodes by default.\n\n  public renderEpisode(gameState: GameState, type: EpisodeType): Episode {\n    return this.factory.nextEpisode(gameState, type);\n  }\n\n  public whichEpisodeType(players: number) {\n    if (players === 3) {\n      return BigBrotherFinale;\n    }\n    if (players === 2) {\n      return GameOver;\n    }\n    return BigBrotherVanilla;\n  }\n}\n","import { Subscription } from \"rxjs\";\nimport { Sidebar } from \"./sidebar\";\nimport { Season } from \"../../model/season\";\nimport { Episode, nonEvictedHouseguests, getById } from \"../../model\";\nimport { Scene } from \"../episode/scene\";\nimport {\n  mainContentStream$,\n  episodes$,\n  switchEpisode$,\n  newEpisode,\n  switchSceneRelative,\n  getSelectedPlayer,\n  selectedPlayer$,\n} from \"../../subjects/subjects\";\n\ninterface IndexedScene {\n  scene: Scene;\n  index: number;\n}\n\nconst LEFT = 37;\nconst RIGHT = 39;\n\nexport class SidebarController {\n  private view: Sidebar;\n  private subscriptions: Subscription[] = [];\n  private season: Season = new Season();\n  private scenes: IndexedScene[] = [];\n  private selectedEpisode: number = 0;\n\n  public constructor(view: Sidebar) {\n    this.view = view;\n    this.subscriptions.push(\n      episodes$.subscribe({\n        next: (episode) => this.onNewEpisode(episode),\n      })\n    );\n    this.subscriptions.push(\n      switchEpisode$.subscribe({\n        next: (value: number) => {\n          this.switchSceneRelative(value);\n        },\n      })\n    );\n  }\n\n  public getSelectedEpisode() {\n    return this.selectedEpisode;\n  }\n\n  public async switchToScene(id: number) {\n    mainContentStream$.next(this.scenes[id].scene.render);\n    this.selectedEpisode = this.scenes[id].index;\n    await this.view.setState({ selectedScene: id });\n    if (getSelectedPlayer() !== null) {\n      selectedPlayer$.next(\n        getById(\n          this.scenes[this.view.state.selectedScene].scene.gameState,\n          getSelectedPlayer()!.id\n        )\n      );\n    }\n  }\n\n  private switchSceneRelative = (delta: number) => {\n    const selectedScene = this.view.state.selectedScene;\n    const renderedScenes = this.scenes.length;\n    const targetScene = selectedScene + delta;\n    if (targetScene < 0) {\n      return;\n    }\n    const lastEpisode = this.view.state.episodes[\n      this.view.state.episodes.length - 1\n    ];\n    if (targetScene < renderedScenes) {\n      // Go back to an earlier scene\n      this.switchToScene(targetScene);\n    } else if (targetScene === renderedScenes) {\n      // Generate a new scene, then jump to it\n      const currentGameState = lastEpisode.gameState;\n      const newPlayerCount = nonEvictedHouseguests(lastEpisode.gameState)\n        .length;\n      const nextEpisodeType = this.season.whichEpisodeType(newPlayerCount);\n      if (newPlayerCount > 0) {\n        newEpisode(\n          this.season.renderEpisode(currentGameState, nextEpisodeType)\n        );\n        this.switchSceneRelative(1);\n      }\n    }\n  };\n\n  get handleKeyDown(): (e: any) => void {\n    return this._handleKeyDown.bind(this);\n  }\n\n  private _handleKeyDown(event: any) {\n    const state = this.view.state;\n\n    if (\n      state.episodes[this.selectedEpisode] === undefined ||\n      !state.episodes[this.selectedEpisode].type.arrowsEnabled\n    ) {\n      return;\n    }\n    if (event.keyCode === LEFT) {\n      switchSceneRelative(-1);\n    } else if (event.keyCode === RIGHT) {\n      switchSceneRelative(1);\n    }\n  }\n\n  private onNewEpisode(episode: Episode | null) {\n    if (!episode) {\n      this.view.setState({ episodes: [], selectedScene: 0 });\n      this.scenes = [];\n    } else {\n      const newState = { ...this.view.state };\n      // starts at -1: prevent OBOE\n      const latestIndex =\n        this.scenes.length === 0\n          ? -1\n          : this.scenes[this.scenes.length - 1].index;\n      const index = latestIndex + 1;\n      this.scenes.push({ scene: episode, index });\n      episode.scenes.forEach((scene) => this.scenes.push({ scene, index }));\n      newState.episodes.push(episode);\n      this.view.setState(newState);\n    }\n  }\n\n  public destroy() {\n    this.subscriptions.forEach((sub) => sub.unsubscribe());\n  }\n}\n","import React from \"react\";\nimport { SidebarController } from \"./sidebarController\";\nimport { Episode, GameState } from \"../../model\";\nimport { Scene } from \"../episode/scene\";\nimport { newEpisode } from \"../../subjects/subjects\";\nimport { Box } from \"../layout/box\";\nimport { HasText } from \"../layout/text\";\ninterface SidebarState {\n  episodes: Episode[];\n  selectedScene: number;\n}\n\nexport class Sidebar extends React.Component<{}, SidebarState> {\n  private controller: SidebarController;\n  public constructor(props: {}) {\n    super(props);\n    this.controller = new SidebarController(this);\n    this.state = { episodes: [], selectedScene: 0 };\n  }\n\n  public componentDidMount() {\n    document.addEventListener(\"keydown\", this.controller.handleKeyDown);\n  }\n\n  public componentWillUnmount() {\n    this.controller.destroy();\n  }\n\n  public render() {\n    return (\n      <Box style={{ minWidth: 180, display: \"none\" }}>\n        <HasText>{this.getEpisodes()}</HasText>\n      </Box>\n    );\n  }\n\n  private getHighlight(title: string, key: number) {\n    if (key === this.state.selectedScene) {\n      return <mark>{title}</mark>;\n    }\n    return title;\n  }\n\n  private getEpisodes() {\n    const result: JSX.Element[] = [];\n    // Weird OBOE to make keys start at 0\n    let episodeKey = -1;\n    let breakKey = 0;\n    this.state.episodes.forEach((episode: Episode) => {\n      const id = ++episodeKey;\n      result.push(\n        <b\n          key={id}\n          onClick={() => {\n            this.controller.switchToScene(id);\n          }}\n        >\n          {this.getHighlight(episode.title, id)}\n        </b>\n      );\n      result.push(<br key={--breakKey} />);\n      episode.scenes.forEach((scene: Scene) => {\n        const id = ++episodeKey;\n        if (this.controller.getSelectedEpisode() === episode.gameState.phase) {\n          result.push(\n            <a key={id} onClick={() => this.controller.switchToScene(id)}>\n              {this.getHighlight(scene.title, id)}\n            </a>\n          );\n          result.push(<br key={--breakKey} />);\n        }\n      });\n    });\n    return result;\n  }\n}\n","export const Base64 = (function () {\n  var digitsStr =\n    \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+-\";\n  var digits = digitsStr.split(\"\");\n  var digitsMap: Map<string, number> = new Map<string, number>();\n  for (var i = 0; i < digits.length; i++) {\n    digitsMap.set(digits[i], i);\n  }\n  return {\n    fromInt: function (int32: number) {\n      var result = \"\";\n      while (true) {\n        result = digits[int32 & 0x3f] + result;\n        int32 >>>= 6;\n        if (int32 === 0) break;\n      }\n      return result;\n    },\n    toInt: function (digitsStr: string) {\n      var result = 0;\n      var digits = digitsStr.split(\"\");\n      for (var i = 0; i < digits.length; i++) {\n        const m = digitsMap.get(digits[i]);\n        if (m === undefined)\n          throw new Error(\"Tried to decode an invalid B64 string\");\n        result = (result << 6) + m;\n      }\n      return result;\n    },\n  };\n})();\n","import {\n  RelationshipMapper,\n  RelationshipHouseguest,\n} from \"./RelationshipMapper\";\nimport { CodedRelationships } from \"./encoder\";\nimport { Base64 } from \"../utils/base64\";\nimport _ from \"lodash\";\n\nexport function decodeToRelationshipMapper(\n  m: RelationshipMapper,\n  c1: string\n): RelationshipMapper | null {\n  const r = new RelationshipMapper(_.cloneDeep(m.houseguests));\n  r.reset();\n  const c = c1.trim();\n  try {\n    if (c.split(\"|\").length !== 4) throw new Error(`Not a code`);\n    const [tribes, evictees, relationships, powerRankings] = c.split(\"|\");\n    if (\n      relationships.length % 2 > 0 ||\n      evictees.length % 2 > 0 ||\n      powerRankings.length % 2 > 0\n    )\n      throw new Error(\n        `Misaligned bytes: (${evictees.length}, ${relationships.length}, ${powerRankings.length}`\n      );\n    decodeEvictees(r, evictees);\n    decodeTribes(r, tribes);\n    decodeRelationships(r, { relationships, powerRankings });\n  } catch (e) {\n    alert(e);\n    return null;\n  }\n  return r;\n}\n\nconst decode = (s: string) => Base64.toInt(s).toString(3).padStart(7, \"0\"); // base64 --> ternary\n\nconst ternaryToRelationship = new Map<string, boolean | undefined>(\n  Object.entries({\n    \"0\": false,\n    \"1\": true,\n    \"2\": undefined,\n  })\n);\nfunction fromTernary(n: string): boolean | undefined {\n  const result = ternaryToRelationship.get(n);\n  if (result === undefined && n !== \"2\")\n    throw new Error(`${n} is not a ternary value`);\n  return result;\n}\nconst chex = /([a-f0-9]){6}/;\n\nfunction decodeTribes(m: RelationshipMapper, c: string) {\n  const tribes: string[] = c.split(\"=\");\n  tribes.forEach((t) => {\n    const hash = t.indexOf(\"#\");\n    if (hash === -1) throw new Error(\"Invalid tribe, does not have a color\");\n    const tribeName = t.slice(0, hash);\n    const color = t.slice(hash + 1, hash + 7);\n    const members = t.slice(hash + 7);\n    if (!chex.test(color)) throw new Error(`Invalid color: ${color}`);\n    const tribemates: string[] = [];\n    let i = 0;\n    while (members[2 * i] !== undefined) {\n      tribemates.push(\n        codeToHouseguest(m, `${members[2 * i]}${members[2 * i + 1]}`, \"tribes\")\n          .name\n      );\n      i++;\n    }\n    m.tribe({ color: `#${color}`, name: tribeName }, tribemates);\n  });\n}\n\nfunction codeToHouseguest(\n  m: RelationshipMapper,\n  c: string,\n  e?: string\n): RelationshipHouseguest {\n  const lookedUp: number = Base64.toInt(c);\n  if (lookedUp >= m.houseguests.length)\n    throw new Error(\n      `${lookedUp} (${c}) exceeds the maximum id: ${m.houseguests.length} in ${e}`\n    );\n  return m.houseguests[lookedUp];\n}\n\nfunction decodeEvictees(m: RelationshipMapper, c: string) {\n  let i = 0;\n  while (c[2 * i] !== undefined) {\n    m.evict(codeToHouseguest(m, `${c[2 * i]}${c[2 * i + 1]}`, \"evictees\").name);\n    i++;\n  }\n}\n\nfunction decodeRelationships(m: RelationshipMapper, c: CodedRelationships) {\n  let decodedR = \"\";\n  let decodedP = \"\";\n  let r: number = 0;\n  let p: number = 0;\n  const [relationships, powerRankings] = [c.relationships, c.powerRankings];\n  m.houseguests.forEach((hg) => {\n    if (hg.isEvicted || hg.disabled) return;\n    m.nonEvictedIDs.forEach((id) => {\n      if (hg.id === id) return;\n      //////////////////////////////////////////////// relationships\n      if (decodedR.length === 0) {\n        decodedR = decode(`${relationships[r]}${relationships[r + 1]}`);\n        r += 2;\n      }\n      m.setRelationship(\n        hg.name,\n        m.houseguests[id].name,\n        fromTernary(decodedR[0]),\n        \"likedBy\",\n        \"dislikedBy\",\n        \"relationships\"\n      );\n      decodedR = decodedR.slice(1);\n      //////////////////////////////////////////////// powerRankings\n      if (decodedP.length === 0) {\n        decodedP = decode(`${powerRankings[p]}${powerRankings[p + 1]}`);\n        p += 2;\n      }\n      m.setRelationship(\n        hg.name,\n        m.houseguests[id].name,\n        fromTernary(decodedP[0]),\n        \"thinksImThreat\",\n        \"thinksImWeak\",\n        \"powerRankings\"\n      );\n      decodedP = decodedP.slice(1);\n    });\n  });\n}\n","import { Topbar } from \"./topBar\";\nimport { decodeToRelationshipMapper } from \"../../images/decoder\";\nimport { RelationshipMapper } from \"../../images/RelationshipMapper\";\nimport {\n  players$,\n  selectedPlayer$,\n  selectedTribe$,\n} from \"../../subjects/subjects\";\nimport { nullTribe } from \"../../images/tribe\";\n\nexport class TopbarController {\n  private view: Topbar;\n  public constructor(view: Topbar) {\n    this.view = view;\n  }\n  public onSubmit = () => {\n    if (!this.view.state.inputCode) return;\n    const newMap: RelationshipMapper | null = decodeToRelationshipMapper(\n      this.view.state.rMapper,\n      this.view.state.inputCode\n    );\n    this.view.setState({ inputCode: \"\" });\n    if (newMap === null) return;\n\n    this.view.setState({ rMapper: newMap });\n    players$.next(newMap.houseguests);\n    selectedPlayer$.next(null);\n    selectedTribe$.next(nullTribe);\n  };\n}\n","import { newDiscreteRelationshipMap, hashcode } from \"../utils\";\nimport prand from \"pure-rand\";\nimport {\n  RelationshipMapper,\n  RelationshipHouseguest,\n} from \"./RelationshipMapper\";\n\nfunction importAll(\n  context: __WebpackModuleApi.RequireContext\n): RelationshipMapper {\n  const profiles: RelationshipHouseguest[] = [];\n  setupProfiles(context, profiles, new Set<string>(), new Set<string>());\n  const r: RelationshipMapper = new RelationshipMapper(profiles);\n  // r.tribe({ name: \"Dream Team\", color: \"#cacf64\" }, [\n  //   \"Lunaris\",\n  //   \"Archbishop Geofri\",\n  //   \"Solaris\",\n  //   \"baran\",\n  //   \"Eleron\",\n  //   \"Hillock\",\n  //   \"Piety\",\n  //   \"Brutus\",\n  //   \"Dominus\",\n  //   \"Avarius\",\n  // ]);\n  // r.tribe({ name: \"Scream Team\", color: \"#64cacf\" }, [\n  //   \"Veritania\",\n  //   \"The Elder\",\n  //   \"Rhys\",\n  //   \"Izaro\",\n  //   \"Shavronne\",\n  //   \"malachai\",\n  //   \"kitava\",\n  //   \"Atziri\",\n  //   \"doedre\",\n  //   \"The Shaper\",\n  // ]);\n  // randomRelationships(r);\n  // r.evict(\"kuduku\");\n  // console.log(encodeRelationshipMapper(r));\n  return r;\n}\n\n////////////////// safe space below here\n\nexport const initialProfiles = importAll(\n  require.context(\"./src\", false, /.png/)\n);\n\nfunction setupProfiles(\n  context: __WebpackModuleApi.RequireContext,\n  profiles: RelationshipHouseguest[],\n  evictedHouseguests: Set<string>,\n  jurors: Set<string>\n) {\n  context.keys().map((item: string, i: number) => {\n    const name = item.replace(\".png\", \"\").replace(\"./\", \"\");\n    profiles.push({\n      name,\n      imageURL: context(item),\n      id: i,\n      isEvicted: evictedHouseguests.has(name.toLowerCase()),\n      disabled: jurors.has(name.toLowerCase()),\n      relationships: newDiscreteRelationshipMap(context.length - 1, i),\n      powerRankings: newDiscreteRelationshipMap(context.length - 1, i),\n      likedBy: {},\n      dislikedBy: {},\n      thinksImThreat: {},\n      thinksImWeak: {},\n    });\n  });\n}\n\nfunction randomInt(\n  a: number,\n  b: number,\n  rng: prand.RandomGenerator\n): [number, prand.RandomGenerator] {\n  let result: number;\n  [result, rng] = prand.uniformIntDistribution(a, b, rng);\n  return [result, rng];\n}\nfunction randomChoice(\n  a: (number | boolean | undefined)[],\n  rng: prand.RandomGenerator\n): [number | boolean | undefined, prand.RandomGenerator] {\n  const [result, rng2] = randomInt(0, a.length - 1, rng);\n  return [a[result], rng2];\n}\n\nfunction randomRelationships(r: RelationshipMapper) {\n  let castNames = \"\";\n  r.houseguests.forEach((houseguest) => (castNames += houseguest.name));\n  let rng = prand.xorshift128plus(hashcode(castNames));\n  const hgs = r.houseguests;\n  for (let i = 0; i < hgs.length; i++) {\n    const hero = hgs[i].name;\n    for (let j = i + 1; j < hgs.length; j++) {\n      const villain = hgs[j].name;\n      let r1;\n      let r2;\n      [r1, rng] = randomChoice([true, false, undefined], rng);\n      [r2, rng] = randomChoice([true, false, undefined], rng);\n      r.setRelationship(\n        hero,\n        villain,\n        r1 as any,\n        \"likedBy\",\n        \"dislikedBy\",\n        \"relationships\"\n      );\n      r.setRelationship(\n        villain,\n        hero,\n        r2 as any,\n        \"likedBy\",\n        \"dislikedBy\",\n        \"relationships\"\n      );\n      [r1, rng] = randomChoice([true, false, undefined], rng);\n      [r2, rng] = randomChoice([true, false, undefined], rng);\n      r.setRelationship(\n        hero,\n        villain,\n        r1 as any,\n        \"thinksImThreat\",\n        \"thinksImWeak\",\n        \"powerRankings\"\n      );\n      r.setRelationship(\n        villain,\n        hero,\n        r2 as any,\n        \"thinksImThreat\",\n        \"thinksImWeak\",\n        \"powerRankings\"\n      );\n    }\n  }\n}\n","import React from \"react\";\nimport { Box } from \"../layout/box\";\nimport { HasText } from \"../layout/text\";\nimport { TopbarController } from \"./topBarController\";\nimport { RelationshipMapper } from \"../../images/RelationshipMapper\";\nimport { initialProfiles } from \"../../images/initialProfiles\";\nimport { players$ } from \"../../subjects/subjects\";\n\ninterface TopbarProps {\n  style?: any;\n}\ninterface TopbarState {\n  inputCode: string;\n  rMapper: RelationshipMapper;\n}\nexport class Topbar extends React.Component<TopbarProps, TopbarState> {\n  private controller: TopbarController;\n\n  public constructor(props: TopbarProps) {\n    super(props);\n    this.controller = new TopbarController(this);\n    this.state = { inputCode: \"\", rMapper: initialProfiles };\n  }\n\n  public componentDidMount() {\n    players$.next(this.state.rMapper.houseguests);\n  }\n  private handleChange = ((event: { target: { value: string } }) => {\n    this.setState({ inputCode: event.target.value });\n  }).bind(this);\n\n  public render(): JSX.Element {\n    const style = { ...{ marginTop: 30 }, ...(this.props.style || {}) };\n    return (\n      <Box className=\"level is-mobile\" style={style}>\n        <HasText className=\"level-item\">\n          Enter Code:\n          <input\n            className=\"input\"\n            value={this.state.inputCode}\n            onChange={this.handleChange}\n          />\n          <button\n            disabled={!!!this.state.inputCode}\n            className={`button is-light`}\n            onClick={this.controller.onSubmit}\n          >\n            Submit\n          </button>\n        </HasText>\n      </Box>\n    );\n  }\n}\n","import styled from \"styled-components\";\nimport React from \"react\";\nimport { mainContentStream$ } from \"../../subjects/subjects\";\nimport { Box } from \"../layout/box\";\n\nconst MainContentAreaWrapper = styled(Box)`\n    overflow-x: auto;\n`;\n\nexport class MainContentArea extends React.Component<{}, { content: any }> {\n    // a simple class that displays whatever it gets fed through the main content stream.\n\n    private contentStream: any;\n\n    public constructor(props: any) {\n        super(props);\n        this.state = { content: null };\n    }\n\n    public componentDidMount() {\n        this.contentStream = mainContentStream$.subscribe((content) => {\n            this.setState({ content });\n        });\n    }\n\n    public componentDidUpdate(prevProps: never, prevState: any) {\n        if (prevState.content !== this.state.content) {\n            window.scrollTo(0, 0);\n        }\n    }\n\n    public componentWillUnmount() {\n        this.contentStream.unsubscribe();\n    }\n\n    public render() {\n        return <MainContentAreaWrapper>{this.state.content}</MainContentAreaWrapper>;\n    }\n}\n","import \"./bulma.scss\";\nimport React from \"react\";\nimport { Sidebar } from \"../sidebar/sidebar\";\nimport { Topbar } from \"../topbar/topBar\";\nimport { MainContentArea } from \"./mainContentArea\";\nimport { MainPageController } from \"./mainPageController\";\n\ninterface MainPageProps {\n  controller: MainPageController;\n}\n\ninterface MainPageState {\n  fullscreen: boolean;\n}\n\nexport class MainPage extends React.Component<MainPageProps, MainPageState> {\n  public constructor(props: MainPageProps) {\n    super(props);\n    this.state = { fullscreen: false };\n    props.controller.inject(this);\n  }\n  public componentDidMount() {\n    this.props.controller.subscribe();\n  }\n  public componentWillUnmount() {\n    this.props.controller.unsubscribe();\n  }\n\n  public render() {\n    const fullscreen = this.state.fullscreen;\n    const hideOnFullscreen = { display: fullscreen ? \"none\" : \"\" };\n    const wrapperStyle = fullscreen\n      ? { margin: \"auto\" }\n      : { margin: \"auto\", maxWidth: 1380, overflow: \"hidden\" };\n    return (\n      <div style={wrapperStyle}>\n        <Sidebar />\n        <Topbar style={hideOnFullscreen} />\n        <div className=\"columns\">\n          <div className=\"column\" style={{ overflowX: \"hidden\" }}>\n            <MainContentArea />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import { MainPage } from \"./mainPage\";\nimport { Subscription } from \"rxjs\";\nimport { isFullscreen$ } from \"../../subjects/subjects\";\n\nexport class MainPageController {\n    private view: MainPage = new MainPage({ controller: this });\n    private subscriptions: Subscription[] = [];\n    public inject(page: MainPage) {\n        this.view = page;\n    }\n\n    public subscribe(): void {\n        this.unsubscribe();\n        this.subscriptions.push(\n            isFullscreen$.subscribe((fullscreen: boolean) => {\n                this.view.setState({ fullscreen });\n            })\n        );\n    }\n\n    public unsubscribe(): void {\n        this.subscriptions.forEach(sub => sub.unsubscribe());\n    }\n}\n","export interface ColorTheme {\n    name: string;\n    bg: string;\n    text: string;\n    toggleBorder: string;\n    gradient: string;\n    bodyArea: string;\n    link: string;\n    mark: string;\n    overlay: string;\n    evictedCell: string;\n    grayCell: string;\n    winnerCell: string;\n    lightGrayCell: string;\n    runnerUpCell: string;\n    nomineeCell: string;\n    hohCell: string;\n    portraitBorder: string;\n    tableCellBorder: string;\n}\n\nexport const lightTheme: ColorTheme = {\n    name: \"light\",\n    bg: \"#fff\",\n    text: \"#363537\",\n    toggleBorder: \"#FFF\",\n    gradient: \"linear-gradient(#39598A, #79D7ED)\",\n    bodyArea: \"#fff\",\n    link: \"blue\",\n    mark: \"yellow\",\n    overlay: \"fff\",\n    evictedCell: \"#fa8072\",\n    grayCell: \"#eaecf0\",\n    lightGrayCell: \"#f8f9fa\",\n    winnerCell: \"#73fb76\",\n    runnerUpCell: \"#d1e8ef\",\n    nomineeCell: \"#959ffd\",\n    hohCell: \"#CCFFCC\",\n    portraitBorder: \"gray\",\n    tableCellBorder: \"#a2a9b1\",\n};\n\nexport const darkTheme: ColorTheme = {\n    name: \"dark\",\n    bg: \"#121212\",\n    text: \"#FAFAFA\",\n    bodyArea: \"#363537\",\n    toggleBorder: \"#6B8096\",\n    gradient: \"linear-gradient(#091236, #1E215D)\",\n    link: \"lightblue\",\n    mark: \"#7e006d\",\n    overlay: \"#444346\",\n    evictedCell: \"#9d4c43\",\n    grayCell: \"#5e5e5e\",\n    lightGrayCell: \"#404040\",\n    runnerUpCell: \"#9fbec882\",\n    nomineeCell: \"#6c75d0\",\n    winnerCell: \"#00ac04\",\n    hohCell: \"#3f783f\",\n    portraitBorder: \"#484848\",\n    tableCellBorder: \"#53575b\",\n};\n","import { createGlobalStyle } from \"styled-components\";\nimport { ColorTheme } from \"./theme\";\n\nexport const GlobalStyles = createGlobalStyle`\n  *,\n  *::after,\n  *::before {\n    box-sizing: border-box;\n  }\n  div {\n    transition: all 0.25s linear;\n  }\n\n  body {\n    background: ${({ theme }: { theme: ColorTheme }) => theme.bg};\n    color: ${({ theme }: { theme: ColorTheme }) => theme.text};\n       transition: all 0.25s linear;\n  }`;\n","import React from \"react\";\nimport { MainPage } from \"./components/mainPage/mainPage\";\nimport { MainPageController } from \"./components/mainPage/mainPageController\";\nimport { ThemeProvider } from \"styled-components\";\nimport { ColorTheme, darkTheme } from \"./theme/theme\";\nimport { GlobalStyles } from \"./theme/globalTheme\";\nimport { theme$ } from \"./subjects/subjects\";\nimport { Subscription } from \"rxjs\";\n\nclass App extends React.Component<{}, { theme: ColorTheme }> {\n  private sub: Subscription | null = null;\n  public constructor(props: any) {\n    super(props);\n    this.state = {\n      theme: darkTheme,\n    };\n  }\n\n  public componentDidMount() {\n    this.sub = theme$.subscribe((theme) => {\n      this.setState({ theme });\n    });\n  }\n\n  public componentWillUnmount() {\n    if (this.sub) this.sub.unsubscribe();\n  }\n\n  render() {\n    return (\n      <ThemeProvider theme={this.state.theme}>\n        <>\n          <GlobalStyles />\n          <MainPage controller={new MainPageController()} />\n        </>\n      </ThemeProvider>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {});\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {});\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {});\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}